resources:
  mainApiGateway:
    type: http-api-gateway
    properties:
      cors:
        enabled: true

  redis:
    type: redis-cluster
    properties:
      defaultUserPassword: $Secret('redis.password')
      instanceSize: cache.t3.micro
      engineVersion: '7.1'

  storeKeyValuePair:
    type: function
    properties:
      packaging:
        type: stacktape-lambda-buildpack
        properties:
          entryfilePath: ./src/store-key-value-pair.ts
      joinDefaultVpc: true
      connectTo:
        - redis
      events:
        - type: http-api-gateway
          properties:
            httpApiGatewayName: mainApiGateway
            method: GET
            path: /save/{key}/{value}
