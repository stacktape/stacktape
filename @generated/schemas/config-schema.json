{"type":"object","properties":{"serviceName":{"description":"#### The name of this service.\n\n---\n\n> **Deprecated:** Use the `--projectName` option in the CLI instead.\n\nThe CloudFormation stack name will be in the format: `{serviceName}-{stage}`.\n\nMust be alphanumeric and can contain dashes. Must match the regex `[a-zA-Z][-a-zA-Z0-9]*`.","type":"string"},"providerConfig":{"description":"#### Credentials and settings for 3rd-party services (MongoDB Atlas, Upstash).\n\n---\n\nRequired only if you use `mongo-db-atlas-cluster` or `upstash-redis` resources in your stack.","type":"object","properties":{"mongoDbAtlas":{"$ref":"#/definitions/MongoDbAtlasProvider"},"upstash":{"$ref":"#/definitions/UpstashProvider"}},"additionalProperties":false},"variables":{"description":"#### Reusable values you can reference anywhere in the config with `$Var().variableName`.\n\n---\n\nUseful for avoiding repetition. For example, define a shared environment name\nand reference it in multiple resources.\n\n```yaml\nvariables:\n  appPort: 3000\n# Then use: $Var().appPort\n```","type":"object","additionalProperties":{}},"budgetControl":{"$ref":"#/definitions/BudgetControl","description":"#### Set a monthly spending limit and get email alerts when costs approach it.\n\n---\n\nThe budget resets at the start of each calendar month. You can configure alerts\nbased on actual spend or AWS-forecasted spend.\n\n> Not available in all regions (e.g., `ap-east-1`, `af-south-1`)."},"hooks":{"$ref":"#/definitions/Hooks","description":"#### Run scripts automatically before/after deploy, delete, or dev commands.\n\n---\n\nEach hook references a script defined in the `scripts` section.\nCommon uses: run database migrations after deploy, build frontend before deploy,\nclean up resources after delete."},"scripts":{"description":"#### Custom shell commands or code you can run manually or as lifecycle hooks.\n\n---\n\nUse `connectTo` in a script to auto-inject database URLs, API keys, etc. as environment variables.\nRun scripts with `stacktape script:run --scriptName myScript` or attach them to `hooks`.\n\n**Script types:**\n- **`local-script`**: Runs on your machine (or CI). Good for migrations, builds, seed scripts.\n- **`local-script-with-bastion-tunneling`**: Runs locally but tunnels connections to VPC-only\n  resources (e.g., private databases) through a bastion host.\n- **`bastion-script`**: Runs remotely on the bastion host inside your VPC.\n\nScripts can be shell commands or JS/TS/Python files.","type":"object","additionalProperties":{"anyOf":[{"$ref":"#/definitions/LocalScript"},{"$ref":"#/definitions/BastionScript"},{"$ref":"#/definitions/LocalScriptWithBastionTunneling"}]}},"directives":{"description":"#### Register custom functions that dynamically compute config values at deploy time.\n\n---\n\nDefine a directive by pointing to a JS/TS/Python file, then use it anywhere in the config\nlike a built-in directive (`$MyDirective()`). Useful for fetching external data,\ncomputing dynamic values, or conditional logic.","type":"array","items":{"$ref":"#/definitions/DirectiveDefinition"}},"deploymentConfig":{"$ref":"#/definitions/DeploymentConfig","description":"#### Advanced deployment settings: rollback behavior, termination protection, artifact retention.\n\n---\n\nMost projects don't need to change these. Useful for production stacks where you want\nextra safety (termination protection, rollback alarms) or cost control (artifact cleanup)."},"stackConfig":{"$ref":"#/definitions/StackConfig","description":"#### Stack-wide settings: custom outputs, tags, VPC configuration, and stack info saving."},"resources":{"description":"#### Your app's infrastructure: APIs, databases, containers, functions, buckets, and more.\n\n---\n\nEach entry is a named resource (e.g., `myApi`, `myDatabase`). Stacktape creates and manages\nthe underlying AWS resources for you. Use `stacktape stack-info --detailed` to inspect them.","type":"object","additionalProperties":{"$ref":"#/definitions/StacktapeResourceDefinition"}},"cloudformationResources":{"description":"#### Escape hatch: add raw AWS CloudFormation resources alongside Stacktape-managed ones.\n\n---\n\nFor advanced use cases where Stacktape doesn't have a built-in resource type.\nThese are merged into the CloudFormation template as-is. Use `stacktape stack-info --detailed`\nto check existing logical names and avoid conflicts.\n\nDoes not count towards your resource limit.","type":"object","additionalProperties":{"$ref":"#/definitions/default"}}},"additionalProperties":false,"required":["resources"],"definitions":{"MongoDbAtlasProvider":{"type":"object","properties":{"publicKey":{"description":"#### Your MongoDB Atlas public API key.\n\n---\n\nCreate API keys in the MongoDB Atlas console under Organization Settings > API Keys.","type":"string"},"privateKey":{"description":"#### Your MongoDB Atlas private API key. Store as `$Secret()` for security.\n\n---\n\nCreate API keys in the MongoDB Atlas console under Organization Settings > API Keys.","type":"string"},"organizationId":{"description":"#### Your MongoDB Atlas Organization ID.\n\n---\n\nFound in the MongoDB Atlas console under Organization Settings.","type":"string"},"accessibility":{"$ref":"#/definitions/MongoDbAtlasAccessibility","description":"#### Network connectivity settings for all MongoDB Atlas clusters in this stack.\n\n---\n\nStacktape auto-creates a MongoDB Atlas Project for your clusters. These accessibility settings\napply at the project level — all clusters in the stack share the same network config."}},"additionalProperties":false},"MongoDbAtlasAccessibility":{"type":"object","properties":{"accessibilityMode":{"description":"#### Network access mode.\n\n---\n\n- **`internet`**: Accessible from anywhere (credentials still required).\n- **`vpc`**: Only from resources in your VPC + any `whitelistedIps`.\n- **`scoping-workloads-in-vpc`**: Like `vpc`, but also requires security-group access via `connectTo`.\n- **`whitelisted-ips-only`**: Only from IP addresses listed in `whitelistedIps`.","default":"internet","enum":["internet","scoping-workloads-in-vpc","vpc","whitelisted-ips-only"],"type":"string"},"whitelistedIps":{"description":"#### IP addresses or CIDR ranges allowed to access the cluster (e.g., your office IP).\n\n---\n\nNo effect in `internet` mode. In `vpc`/`scoping-workloads-in-vpc`, adds access for IPs outside the VPC.\nIn `whitelisted-ips-only`, these are the only IPs that can connect.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["accessibilityMode"]},"UpstashProvider":{"type":"object","properties":{"accountEmail":{"description":"#### Email address of your Upstash account.","type":"string"},"apiKey":{"description":"#### API key for your Upstash account. Store as `$Secret()` for security.\n\n---\n\nCreate an API key in the Upstash console under Account > API Keys.","type":"string"}},"additionalProperties":false,"required":["accountEmail","apiKey"]},"BudgetControl":{"type":"object","properties":{"limit":{"description":"#### Monthly spending limit in USD.\n\n---\n\nNotification thresholds are calculated as a percentage of this amount.\nResets at the start of each calendar month.","type":"number"},"notifications":{"description":"#### Email alerts when spending approaches the limit.\n\n---\n\nEach notification fires at a percentage threshold of the `limit`, based on\nactual or forecasted spend. Max 5 notifications.","type":"array","items":{"$ref":"#/definitions/BudgetNotification"}}},"additionalProperties":false,"required":["limit"]},"BudgetNotification":{"type":"object","properties":{"budgetType":{"description":"#### Whether to alert on actual or forecasted spend.\n\n---\n\n- `ACTUAL` — fires when you've already spent past the threshold.\n- `FORECASTED` — fires when AWS predicts you'll exceed the threshold by month-end.\n\nForecasts need ~5 weeks of usage data before they work.","default":"ACTUAL","enum":["ACTUAL","FORECASTED"],"type":"string"},"thresholdPercentage":{"description":"#### Percentage of the budget limit that triggers this alert.\n\n---\n\nExample: limit = $200, threshold = 80 → alert fires at $160.","default":100,"type":"number"},"emails":{"description":"#### Email addresses that receive the alert. Max 10.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["emails"]},"Hooks":{"type":"object","properties":{"beforeDeploy":{"description":"#### Scripts to run before deploying. Common use: build frontend, lint code.","type":"array","items":{"$ref":"#/definitions/NamedScriptLifecycleHook"}},"afterDeploy":{"description":"#### Scripts to run after deploying. Common use: run database migrations, seed data.","type":"array","items":{"$ref":"#/definitions/NamedScriptLifecycleHook"}},"beforeDelete":{"description":"#### Scripts to run before deleting the stack. Common use: export data, clean up external resources.\n\n---\n\nOnly runs when `--configPath` and `--stage` are provided to the delete command.","type":"array","items":{"$ref":"#/definitions/NamedScriptLifecycleHook"}},"afterDelete":{"description":"#### Scripts to run after deleting the stack.\n\n---\n\nOnly runs when `--configPath` and `--stage` are provided to the delete command.","type":"array","items":{"$ref":"#/definitions/NamedScriptLifecycleHook"}},"beforeBucketSync":{"description":"#### Scripts to run before syncing bucket contents.","type":"array","items":{"$ref":"#/definitions/NamedScriptLifecycleHook"}},"afterBucketSync":{"description":"#### Scripts to run after syncing bucket contents.","type":"array","items":{"$ref":"#/definitions/NamedScriptLifecycleHook"}},"beforeDev":{"description":"#### Scripts to run before starting dev mode.","type":"array","items":{"$ref":"#/definitions/NamedScriptLifecycleHook"}},"afterDev":{"description":"#### Scripts to run after dev mode exits.","type":"array","items":{"$ref":"#/definitions/NamedScriptLifecycleHook"}}},"additionalProperties":false},"NamedScriptLifecycleHook":{"type":"object","properties":{"scriptName":{"description":"#### Script Name\n\n---\n\nThe name of the script to execute. The script must be defined in the `scripts` section of your configuration.","type":"string"},"skipOnCI":{"description":"#### Skip this hook in CI/CD environments (CodeBuild, GitHub Actions, GitLab CI).\n\n---\n\nUseful for hooks that only make sense locally (e.g., opening a browser, interactive prompts).","default":false,"type":"boolean"},"skipOnLocal":{"description":"#### Skip this hook when running locally; only run in CI/CD.\n\n---\n\nUseful for CI-only tasks (e.g., uploading test reports, notifying Slack).","default":false,"type":"boolean"}},"additionalProperties":false,"required":["scriptName"]},"LocalScript":{"description":"#### A script that runs on your local machine.\n\n---\n\nLocal scripts are executed on the same machine where the Stacktape command is run.\nThey are useful for tasks like building your application, running database migrations, or other automation.\n\nThe script must define one of the following: `executeCommand`, `executeScript`, `executeCommands`, or `executeScripts`.","type":"object","properties":{"type":{"type":"string","const":"local-script"},"properties":{"$ref":"#/definitions/LocalScriptProps"}},"additionalProperties":false,"required":["properties","type"]},"LocalScriptProps":{"type":"object","properties":{"executeScript":{"description":"#### Execute Script\n\n---\n\nThe path to a script file to execute. The script can be written in JavaScript, TypeScript, or Python and runs in a separate process.\n\nThe executable is determined by `defaults:configure` or the system default (`node` for JS/TS, `python` for Python). You can only use one of `executeScript`, `executeScripts`, `executeCommand`, or `executeCommands`.","type":"string"},"executeCommand":{"description":"#### Execute Command\n\n---\n\nA single terminal command to execute in a separate shell process.\n\nThe command runs on the machine executing the Stacktape command. Be aware of potential differences between local and CI environments (e.g., OS, shell). You can only use one of `executeScript`, `executeScripts`, `executeCommand`, or `executeCommands`.","type":"string"},"executeScripts":{"description":"#### Execute Scripts\n\n---\n\nA list of script files to execute sequentially. Each script runs in a separate process.\n\nThe script can be written in JavaScript, TypeScript, or Python. The executable is determined by `defaults:configure` or the system default. You can only use one of `executeScript`, `executeScripts`, `executeCommand`, or `executeCommands`.","type":"array","items":{"type":"string"}},"executeCommands":{"description":"#### Execute Commands\n\n---\n\nA list of terminal commands to execute sequentially. Each command runs in a separate shell process.\n\nThe commands run on the machine executing the Stacktape command. Be aware of potential differences between environments. You can only use one of `executeScript`, `executeScripts`, `executeCommand`, or `executeCommands`.","type":"array","items":{"type":"string"}},"cwd":{"description":"#### Working Directory\n\n---\n\nThe directory where the script or command will be executed.","default":"The directory where the Stacktape command was executed.","type":"string"},"pipeStdio":{"description":"#### Pipe Stdio\n\n---\n\nIf `true`, pipes the standard input/output (stdio) of the hook process to the main process. This allows you to see logs from your hook and interact with prompts.","default":true,"type":"boolean"},"connectTo":{"description":"#### Connect To\n\n---\n\nA list of resources the script needs to interact with. Stacktape automatically injects environment variables with connection details for each specified resource.\n\nEnvironment variable names are in the format `STP_[RESOURCE_NAME]_[VARIABLE_NAME]` (e.g., `STP_MY_DATABASE_CONNECTION_STRING`).\n\n**Injected Variables by Resource Type:**\n- **`Bucket`**: `NAME`, `ARN`\n- **`DynamoDbTable`**: `NAME`, `ARN`, `STREAM_ARN`\n- **`MongoDbAtlasCluster`**: `CONNECTION_STRING`\n- **`RelationalDatabase`**: `CONNECTION_STRING`, `JDBC_CONNECTION_STRING`, `HOST`, `PORT`. For Aurora clusters, `READER_CONNECTION_STRING`, `READER_JDBC_CONNECTION_STRING`, and `READER_HOST` are also included.\n- **`RedisCluster`**: `HOST`, `READER_HOST`, `PORT`\n- **`EventBus`**: `ARN`\n- **`Function`**: `ARN`\n- **`BatchJob`**: `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n- **`UserAuthPool`**: `ID`, `CLIENT_ID`, `ARN`\n- **`SnsTopic`**: `ARN`, `NAME`\n- **`SqsQueue`**: `ARN`, `NAME`, `URL`\n- **`UpstashKafkaTopic`**: `TOPIC_NAME`, `TOPIC_ID`, `USERNAME`, `PASSWORD`, `TCP_ENDPOINT`, `REST_URL`\n- **`UpstashRedis`**: `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n- **`PrivateService`**: `ADDRESS`\n- **`WebService`**: `URL`","type":"array","items":{"type":"string"}},"environment":{"description":"#### Environment Variables\n\n---\n\nA list of environment variables to pass to the script or command.\n\nValues can be:\n- A static string, number, or boolean.\n- The result of a [custom directive](https://docs.stacktape.com/configuration/directives/#custom-directives).\n- A reference to another resource's parameter using the [`$ResourceParam` directive](https://docs.stacktape.com/configuration/referencing-parameters/).\n- A value from a [secret](https://docs.stacktape.com/resources/secrets/) using the [`$Secret` directive](https://docs.stacktape.com/configuration/directives/#secret).","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"assumeRoleOfResource":{"description":"#### Assume Role of Resource\n\n---\n\nThe name of a deployed resource whose IAM role the script should assume. This grants the script the same permissions as the specified resource.\n\nThe resource must be deployed before the script is executed. Stacktape injects temporary AWS credentials as environment variables, which are automatically used by most AWS SDKs and CLIs.\n\n**Supported Resource Types:**\n- `function`\n- `batch-job`\n- `worker-service`\n- `web-service`\n- `private-service`\n- `multi-container-workload`\n- `nextjs-web`\n- `astro-web`\n- `nuxt-web`\n- `sveltekit-web`\n- `solidstart-web`\n- `tanstack-web`\n- `remix-web`","type":"string"}},"additionalProperties":false},"EnvironmentVar":{"type":"object","properties":{"name":{"description":"#### Environment variable name (e.g., `DATABASE_URL`, `API_KEY`).","type":"string"},"value":{"description":"#### Environment variable value. Numbers and booleans are converted to strings.","type":["string","number","boolean"]}},"additionalProperties":false,"required":["name","value"]},"BastionScript":{"description":"#### A script that runs remotely on a bastion server.\n\n---\n\nBastion scripts are executed on a bastion server within your VPC, not on your local machine.\nLogs from the script's execution are streamed in real-time to your terminal.\n\nThis is useful for running commands that need direct access to VPC resources\nor for ensuring consistent execution environments across different machines.","type":"object","properties":{"type":{"type":"string","const":"bastion-script"},"properties":{"$ref":"#/definitions/BastionScriptProps"}},"additionalProperties":false,"required":["properties","type"]},"BastionScriptProps":{"type":"object","properties":{"bastionResource":{"description":"#### Bastion Resource Name\n\n---\n\nThe name of the bastion resource on which the commands will be executed.","type":"string"},"executeCommand":{"description":"#### Execute Command\n\n---\n\nA single terminal command to execute on the bastion host. Logs from the execution are streamed to your terminal.\n\nYou can use either `executeCommand` or `executeCommands`, but not both.","type":"string"},"executeCommands":{"description":"#### Execute Commands\n\n---\n\nA list of terminal commands to execute sequentially as a script on the bastion host. Logs from the execution are streamed to your terminal.\n\nYou can use either `executeCommand` or `executeCommands`, but not both.","type":"array","items":{"type":"string"}},"cwd":{"description":"#### Working Directory\n\n---\n\nThe directory on the bastion host where the command will be executed.","default":"/","type":"string"},"connectTo":{"description":"#### Connect To\n\n---\n\nA list of resources the script needs to interact with. Stacktape automatically injects environment variables with connection details for each specified resource.\n\nEnvironment variable names are in the format `STP_[RESOURCE_NAME]_[VARIABLE_NAME]` (e.g., `STP_MY_DATABASE_CONNECTION_STRING`).\n\n**Injected Variables by Resource Type:**\n- **`Bucket`**: `NAME`, `ARN`\n- **`DynamoDbTable`**: `NAME`, `ARN`, `STREAM_ARN`\n- **`MongoDbAtlasCluster`**: `CONNECTION_STRING`\n- **`RelationalDatabase`**: `CONNECTION_STRING`, `JDBC_CONNECTION_STRING`, `HOST`, `PORT`. For Aurora clusters, `READER_CONNECTION_STRING`, `READER_JDBC_CONNECTION_STRING`, and `READER_HOST` are also included.\n- **`RedisCluster`**: `HOST`, `READER_HOST`, `PORT`\n- **`EventBus`**: `ARN`\n- **`Function`**: `ARN`\n- **`BatchJob`**: `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n- **`UserAuthPool`**: `ID`, `CLIENT_ID`, `ARN`\n- **`SnsTopic`**: `ARN`, `NAME`\n- **`SqsQueue`**: `ARN`, `NAME`, `URL`\n- **`UpstashKafkaTopic`**: `TOPIC_NAME`, `TOPIC_ID`, `USERNAME`, `PASSWORD`, `TCP_ENDPOINT`, `REST_URL`\n- **`UpstashRedis`**: `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n- **`PrivateService`**: `ADDRESS`\n- **`WebService`**: `URL`","type":"array","items":{"type":"string"}},"environment":{"description":"#### Environment Variables\n\n---\n\nA list of environment variables to pass to the script or command.\n\nValues can be:\n- A static string, number, or boolean.\n- The result of a [custom directive](https://docs.stacktape.com/configuration/directives/#custom-directives).\n- A reference to another resource's parameter using the [`$ResourceParam` directive](https://docs.stacktape.com/configuration/referencing-parameters/).\n- A value from a [secret](https://docs.stacktape.com/resources/secrets/) using the [`$Secret` directive](https://docs.stacktape.com/configuration/directives/#secret).","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"assumeRoleOfResource":{"description":"#### Assume Role of Resource\n\n---\n\nThe name of a deployed resource whose IAM role the script should assume. This grants the script the same permissions as the specified resource.\n\nThe resource must be deployed before the script is executed. Stacktape injects temporary AWS credentials as environment variables, which are automatically used by most AWS SDKs and CLIs.\n\n**Supported Resource Types:**\n- `function`\n- `batch-job`\n- `worker-service`\n- `web-service`\n- `private-service`\n- `multi-container-workload`\n- `nextjs-web`\n- `astro-web`\n- `nuxt-web`\n- `sveltekit-web`\n- `solidstart-web`\n- `tanstack-web`\n- `remix-web`","type":"string"}},"additionalProperties":false},"LocalScriptWithBastionTunneling":{"description":"#### A local script with secure tunneling through a bastion host.\n\n---\n\nThis script type runs locally but tunnels connections to resources through a bastion server.\nIt provides a secure, encrypted connection to resources that are only accessible within the VPC,\nsuch as private databases or Redis clusters.\n\nThe environment variables injected by `connectTo` are automatically adjusted to use the tunneled endpoints.","type":"object","properties":{"type":{"type":"string","const":"local-script-with-bastion-tunneling"},"properties":{"$ref":"#/definitions/LocalScriptWithBastionTunnelingProps"}},"additionalProperties":false,"required":["properties","type"]},"LocalScriptWithBastionTunnelingProps":{"type":"object","properties":{"bastionResource":{"description":"#### Bastion Resource Name\n\n---\n\nThe name of the bastion resource to use for tunneling to protected resources.","type":"string"},"executeScript":{"description":"#### Execute Script\n\n---\n\nThe path to a script file to execute. The script can be written in JavaScript, TypeScript, or Python and runs in a separate process.\n\nThe executable is determined by `defaults:configure` or the system default (`node` for JS/TS, `python` for Python). You can only use one of `executeScript`, `executeScripts`, `executeCommand`, or `executeCommands`.","type":"string"},"executeCommand":{"description":"#### Execute Command\n\n---\n\nA single terminal command to execute in a separate shell process.\n\nThe command runs on the machine executing the Stacktape command. Be aware of potential differences between local and CI environments (e.g., OS, shell). You can only use one of `executeScript`, `executeScripts`, `executeCommand`, or `executeCommands`.","type":"string"},"executeScripts":{"description":"#### Execute Scripts\n\n---\n\nA list of script files to execute sequentially. Each script runs in a separate process.\n\nThe script can be written in JavaScript, TypeScript, or Python. The executable is determined by `defaults:configure` or the system default. You can only use one of `executeScript`, `executeScripts`, `executeCommand`, or `executeCommands`.","type":"array","items":{"type":"string"}},"executeCommands":{"description":"#### Execute Commands\n\n---\n\nA list of terminal commands to execute sequentially. Each command runs in a separate shell process.\n\nThe commands run on the machine executing the Stacktape command. Be aware of potential differences between environments. You can only use one of `executeScript`, `executeScripts`, `executeCommand`, or `executeCommands`.","type":"array","items":{"type":"string"}},"cwd":{"description":"#### Working Directory\n\n---\n\nThe directory where the script or command will be executed.","default":"The directory where the Stacktape command was executed.","type":"string"},"pipeStdio":{"description":"#### Pipe Stdio\n\n---\n\nIf `true`, pipes the standard input/output (stdio) of the hook process to the main process. This allows you to see logs from your hook and interact with prompts.","default":true,"type":"boolean"},"connectTo":{"description":"#### Connect To\n\n---\n\nA list of resources the script needs to interact with. Stacktape automatically injects environment variables with connection details for each specified resource.\n\nEnvironment variable names are in the format `STP_[RESOURCE_NAME]_[VARIABLE_NAME]` (e.g., `STP_MY_DATABASE_CONNECTION_STRING`).\n\n**Injected Variables by Resource Type:**\n- **`Bucket`**: `NAME`, `ARN`\n- **`DynamoDbTable`**: `NAME`, `ARN`, `STREAM_ARN`\n- **`MongoDbAtlasCluster`**: `CONNECTION_STRING`\n- **`RelationalDatabase`**: `CONNECTION_STRING`, `JDBC_CONNECTION_STRING`, `HOST`, `PORT`. For Aurora clusters, `READER_CONNECTION_STRING`, `READER_JDBC_CONNECTION_STRING`, and `READER_HOST` are also included.\n- **`RedisCluster`**: `HOST`, `READER_HOST`, `PORT`\n- **`EventBus`**: `ARN`\n- **`Function`**: `ARN`\n- **`BatchJob`**: `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n- **`UserAuthPool`**: `ID`, `CLIENT_ID`, `ARN`\n- **`SnsTopic`**: `ARN`, `NAME`\n- **`SqsQueue`**: `ARN`, `NAME`, `URL`\n- **`UpstashKafkaTopic`**: `TOPIC_NAME`, `TOPIC_ID`, `USERNAME`, `PASSWORD`, `TCP_ENDPOINT`, `REST_URL`\n- **`UpstashRedis`**: `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n- **`PrivateService`**: `ADDRESS`\n- **`WebService`**: `URL`","type":"array","items":{"type":"string"}},"environment":{"description":"#### Environment Variables\n\n---\n\nA list of environment variables to pass to the script or command.\n\nValues can be:\n- A static string, number, or boolean.\n- The result of a [custom directive](https://docs.stacktape.com/configuration/directives/#custom-directives).\n- A reference to another resource's parameter using the [`$ResourceParam` directive](https://docs.stacktape.com/configuration/referencing-parameters/).\n- A value from a [secret](https://docs.stacktape.com/resources/secrets/) using the [`$Secret` directive](https://docs.stacktape.com/configuration/directives/#secret).","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"assumeRoleOfResource":{"description":"#### Assume Role of Resource\n\n---\n\nThe name of a deployed resource whose IAM role the script should assume. This grants the script the same permissions as the specified resource.\n\nThe resource must be deployed before the script is executed. Stacktape injects temporary AWS credentials as environment variables, which are automatically used by most AWS SDKs and CLIs.\n\n**Supported Resource Types:**\n- `function`\n- `batch-job`\n- `worker-service`\n- `web-service`\n- `private-service`\n- `multi-container-workload`\n- `nextjs-web`\n- `astro-web`\n- `nuxt-web`\n- `sveltekit-web`\n- `solidstart-web`\n- `tanstack-web`\n- `remix-web`","type":"string"}},"additionalProperties":false},"DirectiveDefinition":{"type":"object","properties":{"name":{"description":"#### Directive Name\n\n---\n\nThe name of the custom directive.","type":"string"},"filePath":{"description":"#### File Path\n\n---\n\nThe path to the file where the directive is defined, in the format `{file-path}:{handler}`.\n\nIf the `{handler}` is omitted:\n- For `.js` and `.ts` files, the `default` export is used.\n- For `.py` files, the `main` function is used.","type":"string"}},"additionalProperties":false,"required":["filePath","name"]},"DeploymentConfig":{"type":"object","properties":{"terminationProtection":{"description":"#### Prevents accidental stack deletion. Must be disabled before you can delete.\n\n---\n\nRecommended for production stacks. To delete a protected stack, first deploy with\n`terminationProtection: false`, then run the delete command.","default":false,"type":"boolean"},"cloudformationRoleArn":{"description":"#### IAM role for CloudFormation to assume during create/update/delete operations.\n\n---\n\nUse this when your deploy user has limited permissions and CloudFormation needs\na more privileged role to manage resources. The role is persisted across deployments\nand reused for delete/rollback even if removed from config later.","type":"string"},"triggerRollbackOnAlarms":{"description":"#### Alarms that trigger automatic rollback if they fire during deployment.\n\n---\n\nSpecify alarm names (from `alarms` section) or ARNs. The alarm must already exist -\na newly created alarm only takes effect on the *next* deployment.\n\nUse with `monitoringTimeAfterDeploymentInMinutes` to keep watching after deploy completes.","type":"array","items":{"type":"string"}},"monitoringTimeAfterDeploymentInMinutes":{"description":"#### How long (in minutes) to monitor rollback alarms after deployment completes.\n\n---\n\nIf an alarm fires during this window, the stack rolls back automatically.\nOnly useful when `triggerRollbackOnAlarms` is configured.","default":0,"type":"number"},"disableAutoRollback":{"description":"#### Keep the stack in a failed state instead of rolling back on deployment failure.\n\n---\n\nUseful for debugging: inspect what went wrong, then fix and redeploy\n(or run `stacktape rollback` manually). By default, failed deployments\nauto-rollback to the last working state.","default":false,"type":"boolean"},"publishEventsToArn":{"description":"#### SNS topic ARNs to receive CloudFormation stack events during deployment.\n\n---\n\nUseful for monitoring deployments in external systems (Slack, PagerDuty, etc.).","type":"array","items":{"type":"string"}},"previousVersionsToKeep":{"description":"#### How many old deployment artifacts (Lambda bundles, container images) to keep.\n\n---\n\nOlder versions are cleaned up automatically. Lower values save storage costs,\nhigher values make it easier to roll back to previous versions.","default":10,"type":"number"},"disableS3TransferAcceleration":{"description":"#### Disable faster uploads via S3 Transfer Acceleration.\n\n---\n\nTransfer Acceleration routes uploads through the nearest AWS edge location\nfor faster deploys, especially from distant regions. Adds a small cost per GB.\nAutomatically disabled in regions where it's not available.","default":false,"type":"boolean"}},"additionalProperties":false},"StackConfig":{"type":"object","properties":{"outputs":{"description":"#### Custom values to display and save after each deployment.\n\n---\n\nUse outputs to surface dynamic values like API URLs, database endpoints, or resource ARNs\nthat are only known after deployment. Outputs are:\n- Printed in the terminal after deploy\n- Saved to the stack info JSON file\n- Optionally exported for cross-stack references (via `export: true`)","type":"array","items":{"$ref":"#/definitions/StackOutput"}},"tags":{"description":"#### Tags applied to every AWS resource in this stack.\n\n---\n\nUseful for cost tracking, access control, and organization. Stacktape automatically\nadds `projectName`, `stage`, and `stackName` tags — your custom tags are merged on top.\n\nMax 45 tags.","type":"array","items":{"$ref":"#/definitions/CloudformationTag"}},"disableStackInfoSaving":{"description":"#### Stop saving stack info to a local file after each deployment.\n\n---\n\nBy default, Stacktape saves resource details and custom outputs to\n`.stacktape-stack-info/{stackName}.json` after every deploy.","default":false,"type":"boolean"},"stackInfoDirectory":{"description":"#### Directory for the stack info JSON file.\n\n---\n\nRelative to the project root.","default":".stacktape-stack-info/","type":"string"},"vpc":{"$ref":"#/definitions/VpcSettings","description":"#### VPC configuration: reuse an existing VPC or configure NAT Gateways."}},"additionalProperties":false},"StackOutput":{"type":"object","properties":{"name":{"description":"#### Name of the output (used as the key in terminal and stack info file).","type":"string"},"value":{"description":"#### Value to output. Typically a directive like `$ResourceParam('myApi', 'url')`.","type":"string"},"description":{"description":"#### Human-readable description shown alongside the output.","type":"string"},"export":{"description":"#### Make this output available to other CloudFormation stacks.\n\n---\n\nExported outputs can be referenced from other stacks using `$CfStackOutput()`.","default":false,"type":"boolean"}},"additionalProperties":false,"required":["name","value"]},"CloudformationTag":{"type":"object","properties":{"name":{"description":"#### Tag name (1-128 characters).","type":"string"},"value":{"description":"#### Tag value (1-256 characters).","type":"string"}},"additionalProperties":false,"required":["name","value"]},"VpcSettings":{"type":"object","properties":{"reuseVpc":{"$ref":"#/definitions/VpcReuseConfig","description":"#### Share a VPC with another Stacktape stack or use an existing VPC.\n\n---\n\nUseful when this stack needs to access VPC-protected resources (databases, Redis)\nfrom another stack. By default, each stack gets its own VPC.\n\n> **Important:** Set this when first creating the stack. Adding it to an already\n> deployed stack can cause resources to be replaced and **data to be lost**."},"nat":{"$ref":"#/definitions/NatSettings","description":"#### NAT Gateway configuration for private subnets.\n\n---\n\nOnly applies when you have workloads using `usePrivateSubnetsWithNAT: true`.\nControls how many availability zones get a NAT Gateway (affects cost and redundancy)."}},"additionalProperties":false},"VpcReuseConfig":{"type":"object","properties":{"projectName":{"description":"#### Project name of the stack whose VPC you want to share.\n\n---\n\nMust be used together with `stage`. Cannot be combined with `vpcId`.","type":"string"},"stage":{"description":"#### Stage of the stack whose VPC you want to share.\n\n---\n\nMust be used together with `projectName`. Cannot be combined with `vpcId`.","type":"string"},"vpcId":{"description":"#### Direct VPC ID to reuse (e.g., `vpc-1234567890abcdef0`).\n\n---\n\nUse this to connect to a VPC not managed by Stacktape. Cannot be combined\nwith `projectName`/`stage`.\n\nThe VPC must use a private CIDR range (10.x, 172.16-31.x, or 192.168.x)\nand have at least 3 public subnets (subnets with a route to an Internet Gateway).","type":"string"}},"additionalProperties":false},"NatSettings":{"type":"object","properties":{"availabilityZones":{"description":"#### How many availability zones get a NAT Gateway (~$32/month each).\n\n---\n\n- **1**: Cheapest, but no redundancy if that AZ goes down.\n- **2**: Balanced cost and availability.\n- **3**: Highest availability.\n\nEach NAT Gateway gets a static Elastic IP that persists across deployments —\nuseful for IP whitelisting with external services.","default":2,"enum":[1,2,3],"type":"number"}},"additionalProperties":false},"StacktapeResourceDefinition":{"anyOf":[{"$ref":"#/definitions/ContainerWorkload"},{"$ref":"#/definitions/BatchJob"},{"$ref":"#/definitions/WebService"},{"$ref":"#/definitions/PrivateService"},{"$ref":"#/definitions/WorkerService"},{"$ref":"#/definitions/RelationalDatabase"},{"$ref":"#/definitions/ApplicationLoadBalancer"},{"$ref":"#/definitions/NetworkLoadBalancer"},{"$ref":"#/definitions/HttpApiGateway"},{"$ref":"#/definitions/Bucket"},{"$ref":"#/definitions/UserAuthPool"},{"$ref":"#/definitions/EventBus"},{"$ref":"#/definitions/Bastion"},{"$ref":"#/definitions/DynamoDbTable"},{"$ref":"#/definitions/StateMachine"},{"$ref":"#/definitions/MongoDbAtlasCluster"},{"$ref":"#/definitions/RedisCluster"},{"$ref":"#/definitions/CustomResourceInstance"},{"$ref":"#/definitions/CustomResourceDefinition"},{"$ref":"#/definitions/UpstashRedis"},{"$ref":"#/definitions/DeploymentScript"},{"$ref":"#/definitions/AwsCdkConstruct"},{"$ref":"#/definitions/SqsQueue"},{"$ref":"#/definitions/SnsTopic"},{"$ref":"#/definitions/HostingBucket"},{"$ref":"#/definitions/WebAppFirewall"},{"$ref":"#/definitions/NextjsWeb"},{"$ref":"#/definitions/OpenSearchDomain"},{"$ref":"#/definitions/EfsFilesystem"},{"$ref":"#/definitions/KinesisStream"},{"$ref":"#/definitions/LambdaFunction"},{"$ref":"#/definitions/EdgeLambdaFunction"},{"$ref":"#/definitions/AstroWeb"},{"$ref":"#/definitions/NuxtWeb"},{"$ref":"#/definitions/SvelteKitWeb"},{"$ref":"#/definitions/SolidStartWeb"},{"$ref":"#/definitions/TanStackWeb"},{"$ref":"#/definitions/RemixWeb"}]},"ContainerWorkload":{"description":"#### Run multiple containers together as a single unit with shared compute resources.\n\n---\n\nFor advanced setups: sidecars, init containers, or services that need multiple processes.\nSupports Fargate (serverless) or EC2 (custom instances). Auto-scales horizontally.","type":"object","properties":{"type":{"type":"string","const":"multi-container-workload"},"properties":{"$ref":"#/definitions/ContainerWorkloadProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"ContainerWorkloadProps":{"type":"object","properties":{"containers":{"description":"#### Containers in this workload. They share compute resources and scale together.","type":"array","items":{"$ref":"#/definitions/ContainerWorkloadContainer"}},"resources":{"$ref":"#/definitions/ContainerWorkloadResourcesConfig","description":"#### CPU, memory, and compute engine (Fargate or EC2).\n\n---\n\n- **Fargate** (set `cpu` + `memory`): Serverless, no servers to manage.\n- **EC2** (set `instanceTypes`): Choose specific instance types for more control or GPU access."},"scaling":{"$ref":"#/definitions/ContainerWorkloadScaling","description":"#### Auto-scaling: how many instances and when to add/remove them."},"deployment":{"$ref":"#/definitions/ContainerWorkloadDeploymentConfig","description":"#### Gradual traffic shifting (canary/linear) for safe deployments. Requires an ALB integration."},"enableRemoteSessions":{"description":"#### Enable `stacktape container:session` for interactive shell access to running containers.","type":"boolean"},"usePrivateSubnetsWithNAT":{"description":"#### Run in private subnets with a NAT Gateway for outbound internet. Gives you a static public IP.\n\n---\n\nUseful for IP whitelisting with third-party APIs. NAT Gateway costs ~$32/month per AZ + data processing fees.","default":false,"type":"boolean"},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false,"required":["containers","resources"]},"ContainerWorkloadContainer":{"type":"object","properties":{"events":{"description":"#### How this container receives traffic (API Gateway, load balancer, or service-connect).","type":"array","items":{"anyOf":[{"$ref":"#/definitions/ContainerWorkloadLoadBalancerIntegration"},{"$ref":"#/definitions/ContainerWorkloadHttpApiIntegration"},{"$ref":"#/definitions/ContainerWorkloadInternalIntegration"},{"$ref":"#/definitions/ContainerWorkloadServiceConnectIntegration"},{"$ref":"#/definitions/ContainerWorkloadNetworkLoadBalancerIntegration"}]}},"loadBalancerHealthCheck":{"$ref":"#/definitions/LoadBalancerHealthCheck","description":"#### Load balancer health check settings. Only applies when integrated with an ALB or NLB."},"name":{"description":"#### Unique container name within this workload.","type":"string"},"packaging":{"$ref":"#/definitions/ContainerWorkloadContainerPackaging","description":"#### How to build or specify the container image."},"essential":{"description":"#### If `true` (default), the entire workload restarts when this container fails.","type":"boolean"},"logging":{"$ref":"#/definitions/ContainerWorkloadContainerLogging","description":"#### Container logging (stdout/stderr). Sent to CloudWatch, viewable with `stacktape logs`."},"dependsOn":{"description":"#### Start this container only after the listed containers reach a specific state.\n\n---\n\nE.g., wait for a database sidecar to be `HEALTHY` before starting the app container.","type":"array","items":{"$ref":"#/definitions/ContainerDependency"}},"environment":{"description":"#### Environment variables injected at runtime. Use `$ResourceParam()` or `$Secret()` for dynamic values.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"internalHealthCheck":{"$ref":"#/definitions/ContainerHealthCheck","description":"#### Command-based health check. If it fails on an essential container, the workload instance is replaced."},"stopTimeout":{"description":"#### Seconds to wait after SIGTERM before SIGKILL (2-120).","default":2,"type":"number"},"volumeMounts":{"description":"#### Mount EFS volumes for persistent, shared storage across containers.","type":"array","items":{"$ref":"#/definitions/ContainerEfsMount"}}},"additionalProperties":false,"required":["name","packaging"]},"ContainerWorkloadLoadBalancerIntegration":{"description":"#### Triggers a container when a request matches the specified conditions on an Application Load Balancer.\n\n---\n\nYou can route requests based on HTTP method, path, headers, query parameters, and source IP address.","type":"object","properties":{"type":{"type":"string","const":"application-load-balancer"},"properties":{"$ref":"#/definitions/ContainerWorkloadLoadBalancerIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"ContainerWorkloadLoadBalancerIntegrationProps":{"type":"object","properties":{"containerPort":{"description":"#### The container port that will receive traffic from the load balancer.","type":"number"},"loadBalancerName":{"description":"#### The name of the Application Load Balancer.\n\n---\n\nThis must reference a load balancer defined in your Stacktape configuration.","type":"string"},"listenerPort":{"description":"#### The port of the load balancer listener to attach to.\n\n---\n\nYou only need to specify this if the load balancer uses custom listeners.","type":"number"},"priority":{"description":"#### The priority of this integration rule.\n\n---\n\nLoad balancer rules are evaluated in order from the lowest priority to the highest.\nThe first rule that matches an incoming request will handle it.","type":"number"},"paths":{"description":"#### A list of URL paths that will trigger this integration.\n\n---\n\nThe request will be routed if its path matches any of the paths in this list.\nThe comparison is case-sensitive and supports `*` and `?` wildcards.\n\nExample: `/users`, `/articles/*`","type":"array","items":{"type":"string"}},"methods":{"description":"#### A list of HTTP methods that will trigger this integration.\n\n---\n\nExample: `GET`, `POST`, `DELETE`","type":"array","items":{"type":"string"}},"hosts":{"description":"#### A list of hostnames that will trigger this integration.\n\n---\n\nThe hostname is parsed from the `Host` header of the request.\nWildcards (`*` and `?`) are supported.\n\nExample: `api.example.com`, `*.myapp.com`","type":"array","items":{"type":"string"}},"headers":{"description":"#### A list of header conditions that the request must match.\n\n---\n\nAll header conditions must be met for the request to be routed.","type":"array","items":{"$ref":"#/definitions/LbHeaderCondition"}},"queryParams":{"description":"#### A list of query parameter conditions that the request must match.\n\n---\n\nAll query parameter conditions must be met for the request to be routed.","type":"array","items":{"$ref":"#/definitions/LbQueryParamCondition"}},"sourceIps":{"description":"#### A list of source IP addresses (in CIDR format) that are allowed to trigger this integration.\n\n---\n\n> **Note:** If the client is behind a proxy, this will be the IP address of the proxy.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["containerPort","loadBalancerName","priority"]},"LbHeaderCondition":{"type":"object","properties":{"headerName":{"description":"#### The name of the HTTP header.","type":"string"},"values":{"description":"#### A list of allowed values for the header.\n\n---\n\nThe condition is met if the header's value in the incoming request matches any of the values in this list. The comparison is case-insensitive.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["headerName","values"]},"LbQueryParamCondition":{"type":"object","properties":{"paramName":{"description":"#### The name of the query parameter.","type":"string"},"values":{"description":"#### A list of allowed values for the query parameter.\n\n---\n\nThe condition is met if the query parameter's value in the incoming request matches any of the values in this list. The comparison is case-insensitive.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["paramName","values"]},"ContainerWorkloadHttpApiIntegration":{"description":"#### Triggers a container when an HTTP API Gateway receives a matching request.\n\n---\n\nYou can route requests based on HTTP method and path.","type":"object","properties":{"type":{"type":"string","const":"http-api-gateway"},"properties":{"$ref":"#/definitions/ContainerWorkloadHttpApiIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"ContainerWorkloadHttpApiIntegrationProps":{"type":"object","properties":{"containerPort":{"description":"#### The container port that will receive traffic from the API Gateway.","type":"number"},"httpApiGatewayName":{"description":"#### The name of the HTTP API Gateway.","type":"string"},"method":{"description":"#### The HTTP method that will trigger this integration.\n\n---\n\nYou can specify an exact method (e.g., `GET`) or use `*` to match any method.","enum":["*","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT"],"type":"string"},"path":{"description":"#### The URL path that will trigger this integration.\n\n---\n\n- **Exact path**: `/users`\n- **Path with parameter**: `/users/{id}`. The `id` will be available in `event.pathParameters.id`.\n- **Greedy path**: `/files/{proxy+}`. This will match any path starting with `/files/`.","type":"string"},"authorizer":{"$ref":"#/definitions/StpAuthorizer","description":"#### An authorizer to protect this route.\n\n---\n\nUnauthorized requests will be rejected with a `401 Unauthorized` response."},"payloadFormat":{"description":"#### The payload format version for the Lambda integration.\n\n---\n\nFor details on the differences between formats, see the [AWS documentation](https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-develop-integrations-lambda.html).","default":"'1.0'","enum":["1.0","2.0"],"type":"string"}},"additionalProperties":false,"required":["containerPort","httpApiGatewayName","method","path"]},"StpAuthorizer":{"anyOf":[{"$ref":"#/definitions/CognitoAuthorizer"},{"$ref":"#/definitions/LambdaAuthorizer"}]},"CognitoAuthorizer":{"type":"object","properties":{"type":{"description":"#### Cognito JWT authorizer\n\n---\n\nConfigures an HTTP API authorizer that validates JSON Web Tokens (JWTs) issued by a Cognito user pool.\nThis is the simplest way to protect routes when your users sign in via `user-auth-pool`.\n\nStacktape turns this into an API Gateway v2 authorizer of type `JWT` that checks the token's issuer and audience.","type":"string","const":"cognito"},"properties":{"$ref":"#/definitions/CognitoAuthorizerProperties"}},"additionalProperties":false,"required":["properties","type"]},"CognitoAuthorizerProperties":{"type":"object","properties":{"userPoolName":{"description":"#### Name of the user pool to protect the API\n\n---\n\nThe Stacktape name of the `user-auth-pool` resource whose tokens should be accepted by this HTTP API authorizer.\nStacktape uses this to:\n\n- Set the expected **audience** to the user pool client ID.\n- Build the expected **issuer** URL based on the user pool and AWS region.\n\nIn practice this means only JWTs issued by this pool (and its client) will be considered valid.","type":"string"},"identitySources":{"description":"#### Where to read the JWT from in the request\n\n---\n\nA list of identity sources that tell API Gateway where to look for the bearer token, using the\n`$request.*` syntax from API Gateway (for example `'$request.header.Authorization'`).\n\nIf you omit this, Stacktape defaults to reading the token from the `Authorization` HTTP header,\nusing a JWT authorizer as described in the API Gateway v2 authorizer docs\n([AWS::ApiGatewayV2::Authorizer](https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-resource-apigatewayv2-authorizer)).","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["userPoolName"]},"LambdaAuthorizer":{"type":"object","properties":{"type":{"description":"#### Lambda-based HTTP API authorizer\n\n---\n\nConfigures an API Gateway **request** authorizer that runs a Lambda function to decide whether a request is allowed.\nThis is useful when your authorization logic can't be expressed as simple JWT validation – for example when you\ncheck API keys, look up permissions in a database, or integrate with a non-JWT identity system.\n\nStacktape creates an `AWS::ApiGatewayV2::Authorizer` of type `REQUEST` and wires it up to your Lambda.","type":"string","const":"lambda"},"properties":{"$ref":"#/definitions/LambdaAuthorizerProperties"}},"additionalProperties":false,"required":["properties","type"]},"LambdaAuthorizerProperties":{"type":"object","properties":{"functionName":{"description":"#### Name of the authorizer function\n\n---\n\nThe Stacktape name of a `function` resource that should run for each authorized request.\nAPI Gateway calls this Lambda, passes request details, and uses its response to allow or deny access.","type":"string"},"iamResponse":{"description":"#### Use IAM-style (v1) authorizer responses\n\n---\n\n- If `true`, your Lambda must return a full IAM policy document (the \"v1\" format).\n- If `false` or omitted, Stacktape enables **simple responses** (the HTTP API v2 payload format)\n  so your Lambda can return a small JSON object with an `isAuthorized` flag and optional context.\n\nThis flag is wired to `EnableSimpleResponses` on the underlying `AWS::ApiGatewayV2::Authorizer`.","type":"boolean"},"identitySources":{"description":"#### Where to read identity data from\n\n---\n\nA list of request fields API Gateway should pass into your Lambda authorizer (for example headers, query parameters,\nor stage variables) using the `$request.*` syntax.\n\nWhen left empty, no specific identity sources are configured and your Lambda must inspect the incoming event directly.","type":"array","items":{"type":"string"}},"cacheResultSeconds":{"description":"#### Cache authorizer results\n\n---\n\nNumber of seconds API Gateway should cache the result of the Lambda authorizer for a given identity.\nWhile cached, repeated requests skip calling your authorizer function and reuse the previous result.\n\nThis value is applied to `AuthorizerResultTtlInSeconds`. If omitted, Stacktape sets it to `0` (no caching).","type":"number"}},"additionalProperties":false,"required":["functionName"]},"ContainerWorkloadInternalIntegration":{"description":"#### Opens a container port for connections from other containers within the same workload.","type":"object","properties":{"type":{"type":"string","const":"workload-internal"},"properties":{"$ref":"#/definitions/ContainerWorkloadInternalIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"ContainerWorkloadInternalIntegrationProps":{"type":"object","properties":{"containerPort":{"description":"#### The container port to open for internal traffic.","type":"number"}},"additionalProperties":false,"required":["containerPort"]},"ContainerWorkloadServiceConnectIntegration":{"description":"#### Opens a container port for connections from other compute resources in the same stack.","type":"object","properties":{"type":{"type":"string","const":"service-connect"},"properties":{"$ref":"#/definitions/ContainerWorkloadServiceConnectIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"ContainerWorkloadServiceConnectIntegrationProps":{"type":"object","properties":{"containerPort":{"description":"#### The container port to open for service-to-service communication.","type":"number"},"alias":{"description":"#### An alias for this service, used for service discovery.\n\n---\n\nOther resources in the stack can connect to this service using a URL like `protocol://alias:port` (e.g., `http://my-service:8080`).\nBy default, the alias is derived from the resource and container names (e.g., `my-resource-my-container`).","type":"string"},"protocol":{"description":"#### The protocol used for service-to-service communication.\n\n---\n\nSpecifying the protocol allows AWS to capture protocol-specific metrics, such as the number of HTTP 5xx errors.","enum":["grpc","http","http2"],"type":"string"}},"additionalProperties":false,"required":["containerPort"]},"ContainerWorkloadNetworkLoadBalancerIntegration":{"description":"#### Triggers a container when a request is made to a Network Load Balancer.\n\n---\n\nA Network Load Balancer operates at the transport layer (Layer 4) and can handle TCP and TLS traffic.","type":"object","properties":{"type":{"type":"string","const":"network-load-balancer"},"properties":{"$ref":"#/definitions/ContainerWorkloadNetworkLoadBalancerIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"ContainerWorkloadNetworkLoadBalancerIntegrationProps":{"type":"object","properties":{"containerPort":{"description":"#### The container port that will receive traffic from the load balancer.","type":"number"},"loadBalancerName":{"description":"#### The name of the Network Load Balancer.\n\n---\n\nThis must reference a load balancer defined in your Stacktape configuration.","type":"string"},"listenerPort":{"description":"#### The port of the listener that will forward traffic to this integration.","type":"number"}},"additionalProperties":false,"required":["containerPort","listenerPort","loadBalancerName"]},"LoadBalancerHealthCheck":{"type":"object","properties":{"healthcheckPath":{"description":"#### Path the load balancer pings to check container health.","default":"/","type":"string"},"healthcheckInterval":{"description":"#### Seconds between health checks.","default":5,"type":"number"},"healthcheckTimeout":{"description":"#### Seconds before a health check is considered failed.","default":4,"type":"number"},"healthCheckProtocol":{"description":"#### Health check protocol. ALB defaults to `HTTP`, NLB defaults to `TCP`.","enum":["HTTP","TCP"],"type":"string"},"healthCheckPort":{"description":"#### Health check port. Defaults to the traffic port.","type":"number"}},"additionalProperties":false},"ContainerWorkloadContainerPackaging":{"anyOf":[{"$ref":"#/definitions/StpBuildpackCwImagePackaging"},{"$ref":"#/definitions/ExternalBuildpackCwImagePackaging"},{"$ref":"#/definitions/PrebuiltCwImagePackaging"},{"$ref":"#/definitions/CustomDockerfileCwImagePackaging"},{"$ref":"#/definitions/NixpacksCwImagePackaging"}]},"StpBuildpackCwImagePackaging":{"description":"#### A zero-config buildpack that creates a container image from your source code.\n\n---\n\nThe `stacktape-image-buildpack` automatically bundles your code and dependencies into an optimized container image.\n\n**Supported languages:** JavaScript, TypeScript, Python, Java, and Go.\n\nFor JS/TS, your code is bundled into a single file with source maps.\nThe resulting image is uploaded to a managed ECR repository.","type":"object","properties":{"type":{"type":"string","const":"stacktape-image-buildpack"},"properties":{"$ref":"#/definitions/StpBuildpackCwImagePackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"StpBuildpackCwImagePackagingProps":{"description":"#### Configures an image to be built automatically by Stacktape from your source code.","type":"object","properties":{"languageSpecificConfig":{"description":"#### Language-specific packaging configuration.","anyOf":[{"$ref":"#/definitions/EsLanguageSpecificConfig"},{"$ref":"#/definitions/PyLanguageSpecificConfig"},{"$ref":"#/definitions/JavaLanguageSpecificConfig"},{"$ref":"#/definitions/PhpLanguageSpecificConfig"},{"$ref":"#/definitions/DotnetLanguageSpecificConfig"},{"$ref":"#/definitions/GoLanguageSpecificConfig"},{"$ref":"#/definitions/RubyLanguageSpecificConfig"}]},"requiresGlibcBinaries":{"description":"#### Use glibc instead of musl (Alpine default). Enable if native dependencies require glibc.\n\n---\n\nResults in a larger image. Common packages needing this: `sharp`, `canvas`, `bcrypt`, `puppeteer`.","type":"boolean"},"customDockerBuildCommands":{"description":"#### A list of commands to be executed during the `docker build` process.\n\n---\n\nThese commands are executed using the `RUN` directive in the Dockerfile.\nThis is useful for installing additional system dependencies in your container.","type":"array","items":{"type":"string"}},"entryfilePath":{"description":"#### Path to your app's entry point, relative to the Stacktape config file.\n\n---\n\nFor JS/TS: code is bundled into a single file. Dependencies with native binaries are installed separately.\nFor Python: use `module/file.py:app` format when using `runAppAs` (WSGI/ASGI).","type":"string"},"includeFiles":{"description":"#### A glob pattern of files to explicitly include in the deployment package.\n\n---\n\nThe path is relative to your Stacktape configuration file.","type":"array","items":{"type":"string"}},"excludeFiles":{"description":"#### A glob pattern of files to explicitly exclude from the deployment package.\n\n---","type":"array","items":{"type":"string"}},"excludeDependencies":{"description":"#### A list of dependencies to exclude from the deployment package.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["entryfilePath"]},"EsLanguageSpecificConfig":{"type":"object","properties":{"tsConfigPath":{"description":"#### The path to the `tsconfig.json` file.\n\n---\n\nThis is primarily used to resolve path aliases during the build process.","type":"string"},"emitTsDecoratorMetadata":{"description":"#### Emit TypeScript decorator metadata. Required by NestJS, TypeORM, and similar frameworks.","type":"boolean"},"dependenciesToExcludeFromBundle":{"description":"#### A list of dependencies to exclude from the main bundle.\n\n---\n\nThese dependencies will be treated as \"external\" and will not be bundled directly into your application's code.\nInstead, they will be installed separately in the deployment package.\nUse `*` to exclude all dependencies from the bundle.","type":"array","items":{"type":"string"}},"outputModuleFormat":{"description":"#### Output module format: `cjs` (CommonJS) or `esm` (ES Modules, enables top-level `await`).\n\n---\n\n**Note:** Some npm packages don't support ESM. ESM may also produce less readable stack traces.","default":"'cjs'","enum":["cjs","esm"],"type":"string"},"nodeVersion":{"description":"#### The major version of Node.js to use.","default":18,"enum":[16,17,18,19,20,21,22,23,24],"type":"number"},"disableSourceMaps":{"description":"#### Skip generating source maps. Reduces package size but makes production errors harder to debug.","type":"boolean"},"outputSourceMapsTo":{"description":"#### Save source maps to a local directory instead of uploading them to AWS.\n\n---\n\nUseful for uploading to external error tracking (Sentry, Datadog, etc.). CloudWatch stack traces won't be mapped.","type":"string"},"dependenciesToExcludeFromDeploymentPackage":{"description":"#### A list of dependencies to exclude from the deployment package.\n\n---\n\nThis only applies to dependencies that are not statically bundled.\nTo exclude a dependency from the static bundle, use `dependenciesToExcludeFromBundle`.\nUse `*` to exclude all non-bundled dependencies.","type":"array","items":{"type":"string"}}},"additionalProperties":false},"PyLanguageSpecificConfig":{"type":"object","properties":{"packageManagerFile":{"description":"#### The path to your project's dependency file.\n\n---\n\nThis can be a `requirements.txt`, `Pipfile`, or `pyproject.toml` file.","type":"string"},"packageManager":{"description":"#### The Python package manager to use.\n\n---\n\nStacktape uses `uv` for dependency resolution and installation. This option is kept\nfor compatibility and must be set to `uv` if provided.","type":"string","const":"uv"},"pythonVersion":{"$ref":"#/definitions/SupportedPythonVersion","description":"#### The version of Python to use.","default":3.9},"runAppAs":{"$ref":"#/definitions/SupportedPythonRunAppAs","description":"#### Python server type: `WSGI` (Flask, Django) or `ASGI` (FastAPI, Starlette).\n\n---\n\nOnly for `stacktape-image-buildpack`. Auto-binds to the `PORT` env var.\nSet `entryfilePath` to `module/file.py:app` (e.g., `app/main.py:app`)."},"minify":{"description":"#### Minify Python code to reduce package size. Makes production stack traces harder to read.","default":true,"type":"boolean"}},"additionalProperties":false},"SupportedPythonVersion":{"enum":[2.7,3.11,3.12,3.13,3.14,3.6,3.7,3.8,3.9],"type":"number"},"SupportedPythonRunAppAs":{"enum":["ASGI","WSGI"],"type":"string"},"JavaLanguageSpecificConfig":{"type":"object","properties":{"useMaven":{"description":"#### Specifies whether to use Maven instead of Gradle.\n\n---\n\nBy default, Stacktape uses Gradle to build Java projects.","type":"boolean"},"packageManagerFile":{"description":"#### The path to your project's build file (`pom.xml` for Maven or `build.gradle` for Gradle).","type":"string"},"javaVersion":{"$ref":"#/definitions/SupportedJavaVersion","description":"#### The version of Java to use.","default":11}},"additionalProperties":false},"SupportedJavaVersion":{"enum":[11,17,19,8],"type":"number"},"PhpLanguageSpecificConfig":{"type":"object","properties":{"phpVersion":{"$ref":"#/definitions/SupportedPhpVersion","description":"#### The version of PHP to use.","default":8.3}},"additionalProperties":false},"SupportedPhpVersion":{"enum":[8.2,8.3],"type":"number"},"DotnetLanguageSpecificConfig":{"type":"object","properties":{"projectFile":{"description":"#### The path to your .NET project file (.csproj).","type":"string"},"dotnetVersion":{"$ref":"#/definitions/SupportedDotnetVersion","description":"#### The version of .NET to use.","default":8}},"additionalProperties":false},"SupportedDotnetVersion":{"enum":[6,8],"type":"number"},"GoLanguageSpecificConfig":{"type":"object","additionalProperties":false},"RubyLanguageSpecificConfig":{"type":"object","properties":{"rubyVersion":{"$ref":"#/definitions/SupportedRubyVersion","description":"#### The version of Ruby to use.","default":3.3}},"additionalProperties":false},"SupportedRubyVersion":{"enum":[3.2,3.3],"type":"number"},"ExternalBuildpackCwImagePackaging":{"description":"#### Builds a container image using an external buildpack.\n\n---\n\nExternal buildpacks (buildpacks.io) automatically detect your application type\nand build an optimized container image with zero configuration.\n\nThe default builder is `paketobuildpacks/builder-jammy-base`.\nYou can find buildpacks for almost any language or framework.","type":"object","properties":{"type":{"type":"string","const":"external-buildpack"},"properties":{"$ref":"#/definitions/ExternalBuildpackCwImagePackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"ExternalBuildpackCwImagePackagingProps":{"type":"object","properties":{"builder":{"description":"#### The Buildpack Builder to use.\n\n---","default":"paketobuildpacks/builder-jammy-base","type":"string"},"buildpacks":{"description":"#### The specific Buildpack to use.\n\n---\n\nBy default, the buildpack is detected automatically.","type":"array","items":{"type":"string"}},"sourceDirectoryPath":{"description":"#### The path to the source code directory.","type":"string"},"command":{"description":"#### A command to be executed when the container starts.\n\n---\n\nExample: `['/app/start.sh']`","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["sourceDirectoryPath"]},"PrebuiltCwImagePackaging":{"description":"#### Uses a pre-built container image.\n\n---\n\nWith `prebuilt-image`, you provide a reference to an existing container image.\nThis can be a public image from Docker Hub or a private image from any container registry.\n\nFor private registries, configure `repositoryCredentialsSecretArn` with credentials stored in AWS Secrets Manager.","type":"object","properties":{"type":{"type":"string","const":"prebuilt-image"},"properties":{"$ref":"#/definitions/PrebuiltImageCwPackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"PrebuiltImageCwPackagingProps":{"description":"#### Configures a pre-built container image.","type":"object","properties":{"repositoryCredentialsSecretArn":{"description":"#### The ARN of a secret containing credentials for a private container registry.\n\n---\n\nThe secret must be a JSON object with `username` and `password` keys.\nYou can create secrets using the `stacktape secret:create` command.","type":"string"},"entryPoint":{"description":"#### A script to be executed when the container starts.\n\n---\n\nThis overrides the `ENTRYPOINT` instruction in the Dockerfile.","type":"array","items":{"type":"string"}},"image":{"description":"#### The name or URL of the container image.","type":"string"},"command":{"description":"#### A command to be executed when the container starts.\n\n---\n\nThis overrides the `CMD` instruction in the Dockerfile.\n\nExample: `['/app/start.sh']`","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["image"]},"CustomDockerfileCwImagePackaging":{"description":"#### Builds a container image from your own Dockerfile.\n\n---\n\nWith `custom-dockerfile`, you provide a path to your Dockerfile and build context.\nStacktape builds the image and uploads it to a managed ECR repository.\n\nThis gives you full control over the container environment and is ideal for complex setups.","type":"object","properties":{"type":{"type":"string","const":"custom-dockerfile"},"properties":{"$ref":"#/definitions/CustomDockerfileCwImagePackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"CustomDockerfileCwImagePackagingProps":{"description":"#### Configures an image to be built by Stacktape from a specified Dockerfile.","type":"object","properties":{"entryPoint":{"description":"#### A script to be executed when the container starts.\n\n---\n\nThis overrides the `ENTRYPOINT` instruction in the Dockerfile.","type":"array","items":{"type":"string"}},"dockerfilePath":{"description":"#### The path to the Dockerfile, relative to `buildContextPath`.","type":"string"},"buildContextPath":{"description":"#### The path to the build context directory, relative to your Stacktape configuration file.","type":"string"},"buildArgs":{"description":"#### A list of arguments to pass to the `docker build` command.","type":"array","items":{"$ref":"#/definitions/DockerBuildArg"}},"command":{"description":"#### A command to be executed when the container starts.\n\n---\n\nThis overrides the `CMD` instruction in the Dockerfile.\n\nExample: `['/app/start.sh']`","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["buildContextPath"]},"DockerBuildArg":{"type":"object","properties":{"argName":{"description":"#### Argument name","type":"string"},"value":{"description":"#### Argument value","type":"string"}},"additionalProperties":false,"required":["argName","value"]},"NixpacksCwImagePackaging":{"description":"#### Builds a container image using Nixpacks.\n\n---\n\nNixpacks automatically detects your application type and builds an optimized container image.\nIn most cases, no configuration is required.\n\nIt supports a wide range of languages and frameworks out of the box.","type":"object","properties":{"type":{"type":"string","const":"nixpacks"},"properties":{"$ref":"#/definitions/NixpacksCwImagePackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"NixpacksCwImagePackagingProps":{"type":"object","properties":{"sourceDirectoryPath":{"description":"#### The path to the source code directory.","type":"string"},"buildImage":{"description":"#### The base image to use for building the application.\n\n---\n\nFor more details, see the [Nixpacks documentation](https://nixpacks.com/docs/configuration/file#build-image).","type":"string"},"providers":{"description":"#### A list of providers to use for determining the build and runtime environments.","type":"array","items":{"type":"string"}},"startCmd":{"description":"#### The command to execute when starting the application.\n\n---\n\nThis overrides the default start command inferred by Nixpacks.","type":"string"},"startRunImage":{"description":"#### The base image to use for running the application.","type":"string"},"startOnlyIncludeFiles":{"description":"#### A list of file paths to include in the runtime environment; all other files will be excluded.","type":"array","items":{"type":"string"}},"phases":{"description":"#### The build phases for the application.","type":"array","items":{"$ref":"#/definitions/NixpacksPhase"}}},"additionalProperties":false,"required":["sourceDirectoryPath"]},"NixpacksPhase":{"type":"object","properties":{"name":{"description":"#### The name of the build phase.","type":"string"},"cmds":{"description":"#### A list of shell commands to execute in this phase.","type":"array","items":{"type":"string"}},"nixPkgs":{"description":"#### A list of Nix packages to install in this phase.","type":"array","items":{"type":"string"}},"nixLibs":{"description":"#### A list of Nix libraries to include in this phase.","type":"array","items":{"type":"string"}},"nixOverlay":{"description":"#### A list of Nix overlay files to apply in this phase.","type":"array","items":{"type":"string"}},"nixpkgsArchive":{"description":"#### The Nixpkgs archive to use.","type":"string"},"aptPkgs":{"description":"#### A list of APT packages to install in this phase.","type":"array","items":{"type":"string"}},"cacheDirectories":{"description":"#### A list of directories to cache between builds to speed up subsequent builds.","type":"array","items":{"type":"string"}},"onlyIncludeFiles":{"description":"#### A list of file paths to include in this phase; all other files will be excluded.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["name"]},"ContainerWorkloadContainerLogging":{"type":"object","properties":{"disabled":{"description":"#### Disable logging to CloudWatch.","default":false,"type":"boolean"},"retentionDays":{"description":"#### How many days to keep logs.","default":90,"enum":[1,120,14,150,180,1827,3,30,365,3653,400,5,545,60,7,731,90],"type":"number"},"logForwarding":{"description":"#### Forward logs to an external service (Datadog, Highlight.io, or any HTTP endpoint).\n\n---\n\nUses Kinesis Data Firehose (~$0.03/GB). Failed deliveries go to a backup S3 bucket.","anyOf":[{"$ref":"#/definitions/HttpEndpointLogForwarding"},{"$ref":"#/definitions/HighlightLogForwarding"},{"$ref":"#/definitions/DatadogLogForwarding"}]}},"additionalProperties":false},"HttpEndpointLogForwarding":{"type":"object","properties":{"type":{"type":"string","const":"http-endpoint"},"properties":{"$ref":"#/definitions/HttpEndpointLogForwardingProps"}},"additionalProperties":false,"required":["properties","type"]},"HttpEndpointLogForwardingProps":{"type":"object","properties":{"endpointUrl":{"description":"#### HTTPS endpoint URL where logs are sent.","type":"string"},"gzipEncodingEnabled":{"description":"#### Compress request body with GZIP to reduce transfer costs.","default":false,"type":"boolean"},"parameters":{"description":"#### Extra metadata sent in the `X-Amz-Firehose-Common-Attributes` header.","type":"object","additionalProperties":{"type":"string"}},"retryDuration":{"description":"#### Total retry time (seconds) before sending failed logs to a backup S3 bucket.","default":300,"type":"number"},"accessKey":{"description":"#### Auth credential sent in `X-Amz-Firehose-Access-Key` header. Store as `$Secret()` for security.","type":"string"}},"additionalProperties":false,"required":["endpointUrl"]},"HighlightLogForwarding":{"type":"object","properties":{"type":{"type":"string","const":"highlight"},"properties":{"$ref":"#/definitions/HighlightLogForwardingProps"}},"additionalProperties":false,"required":["properties","type"]},"HighlightLogForwardingProps":{"type":"object","properties":{"projectId":{"description":"#### Your Highlight.io project ID (from the Highlight console).","type":"string"},"endpointUrl":{"description":"#### Highlight.io endpoint. Override for self-hosted or regional endpoints.","default":"https://pub.highlight.io/v1/logs/firehose","type":"string"}},"additionalProperties":false,"required":["projectId"]},"DatadogLogForwarding":{"type":"object","properties":{"type":{"type":"string","const":"datadog"},"properties":{"$ref":"#/definitions/DatadogLogForwardingProps"}},"additionalProperties":false,"required":["properties","type"]},"DatadogLogForwardingProps":{"type":"object","properties":{"apiKey":{"description":"#### Your Datadog API key. Store as `$Secret()` for security.","type":"string"},"endpointUrl":{"description":"#### Datadog endpoint. Use the EU URL if your account is in the EU region.","default":"https://aws-kinesis-http-intake.logs.datadoghq.com/v1/input","type":"string"}},"additionalProperties":false,"required":["apiKey"]},"ContainerDependency":{"type":"object","properties":{"containerName":{"description":"The name of the container that this container depends on.","type":"string"},"condition":{"description":"#### The condition that the dependency container must meet.\n---\nAvailable conditions:\n- `START`: The dependency has started.\n- `COMPLETE`: The dependency has finished executing (regardless of success).\n- `SUCCESS`: The dependency has finished with an exit code of `0`.\n- `HEALTHY`: The dependency has passed its first health check.","enum":["COMPLETE","HEALTHY","START","SUCCESS"],"type":"string"}},"additionalProperties":false,"required":["condition","containerName"]},"ContainerHealthCheck":{"type":"object","properties":{"healthCheckCommand":{"description":"#### Command to check health. E.g., `[\"CMD-SHELL\", \"curl -f http://localhost/ || exit 1\"]`. Exit 0 = healthy.","type":"array","items":{"type":"string"}},"intervalSeconds":{"description":"#### Seconds between health checks (5-300).","default":30,"type":"number"},"timeoutSeconds":{"description":"#### Seconds before a check is considered failed (2-60).","default":5,"type":"number"},"retries":{"description":"#### Consecutive failures before marking unhealthy (1-10).","default":3,"type":"number"},"startPeriodSeconds":{"description":"#### Grace period (seconds) before counting failures. Gives the container time to start (0-300).","type":"number"}},"additionalProperties":false,"required":["healthCheckCommand"]},"ContainerEfsMount":{"type":"object","properties":{"type":{"description":"#### The type of the volume mount.","type":"string","const":"efs"},"properties":{"$ref":"#/definitions/ContainerEfsMountProps","description":"#### Properties for the EFS volume mount."}},"additionalProperties":false,"required":["properties","type"]},"ContainerEfsMountProps":{"type":"object","properties":{"efsFilesystemName":{"description":"#### Name of the `efs-filesystem` resource defined in your config.","type":"string"},"rootDirectory":{"description":"#### Subdirectory within the EFS filesystem to mount. Restricts access to that directory.","default":"/","type":"string"},"mountPath":{"description":"#### Absolute path inside the container where the volume is mounted (e.g., `/data`).","type":"string"}},"additionalProperties":false,"required":["efsFilesystemName","mountPath"]},"ContainerWorkloadResourcesConfig":{"type":"object","properties":{"cpu":{"description":"#### vCPUs for the workload (Fargate). Ignored when using `instanceTypes`.","enum":[0.25,0.5,1,16,2,4,8],"type":"number"},"memory":{"description":"#### Memory in MB. Must be compatible with the vCPU count on Fargate.\n\n---\n\nFargate valid combos: 0.25 vCPU → 512-2048 MB, 0.5 → 1024-4096, 1 → 2048-8192, 2 → 4096-16384,\n4 → 8192-30720, 8 → 16384-61440, 16 → 32768-122880.\nFor EC2: auto-detected from instance type if omitted.","type":"number"},"instanceTypes":{"description":"#### EC2 instance types for the workload (e.g., `t3.medium`, `c6g.large`). Use instead of `cpu`/`memory`.\n\n---\n\nFirst type in the list is preferred. Instances auto-scale and are refreshed weekly for patching.\nTip: specify a single type and omit `cpu`/`memory` for optimal sizing.","type":"array","items":{"type":"string"}},"enableWarmPool":{"description":"#### Keep pre-initialized EC2 instances ready for faster scaling. Only works with a single instance type.","type":"boolean"},"architecture":{"description":"#### CPU architecture for Fargate. `arm64` is ~20% cheaper. Ignored when using `instanceTypes`.","default":"'x86_64'","enum":["arm64","x86_64"],"type":"string"}},"additionalProperties":false},"ContainerWorkloadScaling":{"type":"object","properties":{"minInstances":{"description":"#### Minimum running instances. Set to 0 is not supported — minimum is 1.","default":1,"type":"number"},"maxInstances":{"description":"#### Maximum running instances. Traffic is distributed across all instances.","default":1,"type":"number"},"scalingPolicy":{"$ref":"#/definitions/ContainerWorkloadScalingPolicy","description":"#### When to scale: CPU and/or memory utilization targets."}},"additionalProperties":false},"ContainerWorkloadScalingPolicy":{"type":"object","properties":{"keepAvgCpuUtilizationUnder":{"description":"#### Scale out when avg CPU exceeds this %, scale in when it drops below.","default":80,"type":"number"},"keepAvgMemoryUtilizationUnder":{"description":"#### Scale out when avg memory exceeds this %, scale in when it drops below.","default":80,"type":"number"}},"additionalProperties":false},"ContainerWorkloadDeploymentConfig":{"type":"object","properties":{"strategy":{"description":"#### How traffic shifts to the new version during deployment.\n\n---\n\n- `Canary10Percent5Minutes`: 10% first, then all after 5 min.\n- `Canary10Percent15Minutes`: 10% first, then all after 15 min.\n- `Linear10PercentEvery1Minutes`: 10% more every minute.\n- `Linear10PercentEvery3Minutes`: 10% more every 3 minutes.\n- `AllAtOnce`: Instant switch.","enum":["AllAtOnce","Canary10Percent15Minutes","Canary10Percent5Minutes","Linear10PercentEvery1Minutes","Linear10PercentEvery3Minutes"],"type":"string"},"beforeAllowTrafficFunction":{"description":"#### Lambda function to run before traffic shifts to the new version (for validation/smoke tests).","type":"string"},"afterTrafficShiftFunction":{"description":"#### Lambda function to run after all traffic has shifted (for post-deployment checks).","type":"string"},"testListenerPort":{"description":"#### ALB listener port for test traffic. Only needed with `beforeAllowTrafficFunction` and custom listeners.","type":"number"}},"additionalProperties":false,"required":["strategy"]},"StpIamRoleStatement":{"type":"object","properties":{"Sid":{"description":"#### Optional identifier for this statement (for readability).","type":"string"},"Effect":{"description":"#### Whether to allow or deny the specified actions.","default":"Allow","type":"string"},"Action":{"description":"#### AWS actions to allow or deny (e.g., `s3:GetObject`, `sqs:SendMessage`).","type":"array","items":{"type":"string"}},"Condition":{"description":"#### Conditions under which this statement applies (e.g., IP restrictions, tag-based access)."},"Resource":{"description":"#### ARNs of the AWS resources this statement applies to. Use `\"*\"` for all resources.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["Resource"]},"BatchJob":{"description":"#### Run containerized tasks to completion — data processing, ML training, video encoding, etc.\n\n---\n\nPay only for the compute time used. Supports CPU and GPU workloads, retries on failure,\nand can be triggered by schedules, HTTP requests, S3 uploads, or queue messages.","type":"object","properties":{"type":{"type":"string","const":"batch-job"},"properties":{"$ref":"#/definitions/BatchJobProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"BatchJobProps":{"type":"object","properties":{"container":{"$ref":"#/definitions/BatchJobContainer","description":"#### Docker container image and environment for the job."},"resources":{"$ref":"#/definitions/BatchJobResources","description":"#### CPU, memory, and GPU requirements. AWS auto-provisions a matching instance."},"timeout":{"description":"#### Max run time in seconds. The job is killed if it exceeds this, then retried if `retryConfig` is set.","type":"number"},"useSpotInstances":{"description":"#### Use discounted spare AWS capacity. Saves up to 90%, but jobs can be interrupted.\n\n---\n\n**Use this when:** Your job can safely be restarted from the beginning (e.g., data imports,\nimage processing, ML training with checkpoints). Combine with `retryConfig` to auto-retry\non interruption.\n\n**Don't use when:** Your job has side effects that can't be repeated (e.g., sending emails,\ncharging payments) or must finish within a strict deadline.\n\nIf interrupted, your container gets a `SIGTERM` and 120 seconds to shut down gracefully.","default":false,"type":"boolean"},"logging":{"$ref":"#/definitions/BatchJobLogging","description":"#### Container logging (stdout/stderr). Sent to CloudWatch, viewable with `stacktape logs`."},"retryConfig":{"$ref":"#/definitions/BatchJobRetryConfiguration","description":"#### Auto-retry on failure, timeout, or Spot interruption."},"events":{"description":"#### Events that trigger this job (schedules, HTTP requests, S3 uploads, SQS messages, etc.).","type":"array","items":{"anyOf":[{"$ref":"#/definitions/ApplicationLoadBalancerIntegration"},{"$ref":"#/definitions/SnsIntegration"},{"$ref":"#/definitions/SqsIntegration"},{"$ref":"#/definitions/KinesisIntegration"},{"$ref":"#/definitions/DynamoDbIntegration"},{"$ref":"#/definitions/S3Integration"},{"$ref":"#/definitions/ScheduleIntegration"},{"$ref":"#/definitions/CloudwatchLogIntegration"},{"$ref":"#/definitions/HttpApiIntegration"},{"$ref":"#/definitions/EventBusIntegration"}]}},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false,"required":["container","resources"]},"BatchJobContainer":{"type":"object","properties":{"packaging":{"$ref":"#/definitions/BatchJobContainerPackaging","description":"#### How to build or specify the container image for this job."},"environment":{"description":"#### Environment variables injected into the container at runtime.\n\n---\n\nUse `$ResourceParam()` or `$Secret()` to inject database URLs, API keys, etc.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}}},"additionalProperties":false,"required":["packaging"]},"BatchJobContainerPackaging":{"anyOf":[{"$ref":"#/definitions/StpBuildpackBjImagePackaging"},{"$ref":"#/definitions/ExternalBuildpackBjImagePackaging"},{"$ref":"#/definitions/PrebuiltBjImagePackaging"},{"$ref":"#/definitions/CustomDockerfileBjImagePackaging"},{"$ref":"#/definitions/NixpacksBjImagePackaging"}]},"StpBuildpackBjImagePackaging":{"type":"object","properties":{"type":{"type":"string","const":"stacktape-image-buildpack"},"properties":{"$ref":"#/definitions/StpBuildpackBjImagePackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"StpBuildpackBjImagePackagingProps":{"description":"#### Configures an image to be built automatically by Stacktape from your source code.","type":"object","properties":{"languageSpecificConfig":{"description":"#### Language-specific packaging configuration.","anyOf":[{"$ref":"#/definitions/EsLanguageSpecificConfig"},{"$ref":"#/definitions/PyLanguageSpecificConfig"},{"$ref":"#/definitions/JavaLanguageSpecificConfig"},{"$ref":"#/definitions/PhpLanguageSpecificConfig"},{"$ref":"#/definitions/DotnetLanguageSpecificConfig"},{"$ref":"#/definitions/GoLanguageSpecificConfig"},{"$ref":"#/definitions/RubyLanguageSpecificConfig"}]},"requiresGlibcBinaries":{"description":"#### Use glibc instead of musl (Alpine default). Enable if native dependencies require glibc.\n\n---\n\nResults in a larger image. Common packages needing this: `sharp`, `canvas`, `bcrypt`, `puppeteer`.","type":"boolean"},"customDockerBuildCommands":{"description":"#### A list of commands to be executed during the `docker build` process.\n\n---\n\nThese commands are executed using the `RUN` directive in the Dockerfile.\nThis is useful for installing additional system dependencies in your container.","type":"array","items":{"type":"string"}},"entryfilePath":{"description":"#### Path to your app's entry point, relative to the Stacktape config file.\n\n---\n\nFor JS/TS: code is bundled into a single file. Dependencies with native binaries are installed separately.\nFor Python: use `module/file.py:app` format when using `runAppAs` (WSGI/ASGI).","type":"string"},"includeFiles":{"description":"#### A glob pattern of files to explicitly include in the deployment package.\n\n---\n\nThe path is relative to your Stacktape configuration file.","type":"array","items":{"type":"string"}},"excludeFiles":{"description":"#### A glob pattern of files to explicitly exclude from the deployment package.\n\n---","type":"array","items":{"type":"string"}},"excludeDependencies":{"description":"#### A list of dependencies to exclude from the deployment package.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["entryfilePath"]},"ExternalBuildpackBjImagePackaging":{"type":"object","properties":{"type":{"type":"string","const":"external-buildpack"},"properties":{"$ref":"#/definitions/ExternalBuildpackBjImagePackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"ExternalBuildpackBjImagePackagingProps":{"type":"object","properties":{"builder":{"description":"#### The Buildpack Builder to use.\n\n---","default":"paketobuildpacks/builder-jammy-base","type":"string"},"buildpacks":{"description":"#### The specific Buildpack to use.\n\n---\n\nBy default, the buildpack is detected automatically.","type":"array","items":{"type":"string"}},"sourceDirectoryPath":{"description":"#### The path to the source code directory.","type":"string"},"command":{"description":"#### A command to be executed when the container starts.\n\n---\n\nExample: `['/app/start.sh']`","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["sourceDirectoryPath"]},"PrebuiltBjImagePackaging":{"type":"object","properties":{"type":{"type":"string","const":"prebuilt-image"},"properties":{"$ref":"#/definitions/PrebuiltImageBjPackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"PrebuiltImageBjPackagingProps":{"description":"#### Configures a pre-built container image.","type":"object","properties":{"image":{"description":"#### The name or URL of the container image.","type":"string"},"command":{"description":"#### A command to be executed when the container starts.\n\n---\n\nThis overrides the `CMD` instruction in the Dockerfile.\n\nExample: `['/app/start.sh']`","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["image"]},"CustomDockerfileBjImagePackaging":{"type":"object","properties":{"type":{"type":"string","const":"custom-dockerfile"},"properties":{"$ref":"#/definitions/CustomDockerfileBjImagePackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"CustomDockerfileBjImagePackagingProps":{"description":"#### Configures an image to be built by Stacktape from a specified Dockerfile.","type":"object","properties":{"dockerfilePath":{"description":"#### The path to the Dockerfile, relative to `buildContextPath`.","type":"string"},"buildContextPath":{"description":"#### The path to the build context directory, relative to your Stacktape configuration file.","type":"string"},"buildArgs":{"description":"#### A list of arguments to pass to the `docker build` command.","type":"array","items":{"$ref":"#/definitions/DockerBuildArg"}},"command":{"description":"#### A command to be executed when the container starts.\n\n---\n\nThis overrides the `CMD` instruction in the Dockerfile.\n\nExample: `['/app/start.sh']`","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["buildContextPath"]},"NixpacksBjImagePackaging":{"type":"object","properties":{"type":{"type":"string","const":"nixpacks"},"properties":{"$ref":"#/definitions/NixpacksBjImagePackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"NixpacksBjImagePackagingProps":{"type":"object","properties":{"sourceDirectoryPath":{"description":"#### The path to the source code directory.","type":"string"},"buildImage":{"description":"#### The base image to use for building the application.\n\n---\n\nFor more details, see the [Nixpacks documentation](https://nixpacks.com/docs/configuration/file#build-image).","type":"string"},"providers":{"description":"#### A list of providers to use for determining the build and runtime environments.","type":"array","items":{"type":"string"}},"startCmd":{"description":"#### The command to execute when starting the application.\n\n---\n\nThis overrides the default start command inferred by Nixpacks.","type":"string"},"startRunImage":{"description":"#### The base image to use for running the application.","type":"string"},"startOnlyIncludeFiles":{"description":"#### A list of file paths to include in the runtime environment; all other files will be excluded.","type":"array","items":{"type":"string"}},"phases":{"description":"#### The build phases for the application.","type":"array","items":{"$ref":"#/definitions/NixpacksPhase"}}},"additionalProperties":false,"required":["sourceDirectoryPath"]},"BatchJobResources":{"type":"object","properties":{"cpu":{"description":"#### Number of vCPUs for the job (e.g., 1, 2, 4).","type":"number"},"memory":{"description":"#### Memory in MB. Use slightly less than powers of 2 for efficient instance sizing.\n\n---\n\nAWS reserves some memory for system processes. Requesting exactly 8192 MB (8 GB) may provision\na larger instance than needed. Use 7680 MB instead to fit on a standard 8 GB instance.","type":"number"},"gpu":{"description":"#### Number of GPUs. The job will run on a GPU instance (NVIDIA A100, A10G, etc.).\n\n---\n\nOmit for CPU-only workloads.","type":"number"}},"additionalProperties":false,"required":["cpu","memory"]},"BatchJobLogging":{"type":"object","properties":{"disabled":{"description":"#### Disable logging to CloudWatch.","default":false,"type":"boolean"},"retentionDays":{"description":"#### How many days to keep logs.","default":90,"enum":[1,120,14,150,180,1827,3,30,365,3653,400,5,545,60,7,731,90],"type":"number"},"logForwarding":{"description":"#### Forward logs to an external service (Datadog, Highlight.io, or any HTTP endpoint).\n\n---\n\nUses Kinesis Data Firehose (~$0.03/GB). Failed deliveries go to a backup S3 bucket.","anyOf":[{"$ref":"#/definitions/HttpEndpointLogForwarding"},{"$ref":"#/definitions/HighlightLogForwarding"},{"$ref":"#/definitions/DatadogLogForwarding"}]}},"additionalProperties":false},"BatchJobRetryConfiguration":{"type":"object","properties":{"attempts":{"description":"#### Max retry attempts before the job is marked as failed.","default":1,"type":"number"},"retryIntervalSeconds":{"description":"#### Seconds to wait between retries.","default":0,"type":"number"},"retryIntervalMultiplier":{"description":"#### Multiply wait time by this factor after each retry (exponential backoff).\n\n---\n\nE.g., with `retryIntervalSeconds: 5` and `retryIntervalMultiplier: 2`, waits are 5s, 10s, 20s, etc.","default":1,"type":"number"}},"additionalProperties":false},"ApplicationLoadBalancerIntegration":{"description":"#### Triggers a function when an Application Load Balancer receives a matching HTTP request.\n\n---\n\nYou can route requests based on HTTP method, path, headers, query parameters, and source IP address.","type":"object","properties":{"type":{"description":"#### Triggers a function when an Application Load Balancer receives a matching HTTP request.\n\n---\n\nYou can route requests based on HTTP method, path, headers, query parameters, and source IP address.","type":"string","const":"application-load-balancer"},"properties":{"$ref":"#/definitions/ApplicationLoadBalancerIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"ApplicationLoadBalancerIntegrationProps":{"type":"object","properties":{"loadBalancerName":{"description":"#### The name of the Application Load Balancer.\n\n---\n\nThis must reference a load balancer defined in your Stacktape configuration.","type":"string"},"listenerPort":{"description":"#### The port of the load balancer listener to attach to.\n\n---\n\nYou only need to specify this if the load balancer uses custom listeners.","type":"number"},"priority":{"description":"#### The priority of this integration rule.\n\n---\n\nLoad balancer rules are evaluated in order from the lowest priority to the highest.\nThe first rule that matches an incoming request will handle it.","type":"number"},"paths":{"description":"#### A list of URL paths that will trigger this integration.\n\n---\n\nThe request will be routed if its path matches any of the paths in this list.\nThe comparison is case-sensitive and supports `*` and `?` wildcards.\n\nExample: `/users`, `/articles/*`","type":"array","items":{"type":"string"}},"methods":{"description":"#### A list of HTTP methods that will trigger this integration.\n\n---\n\nExample: `GET`, `POST`, `DELETE`","type":"array","items":{"type":"string"}},"hosts":{"description":"#### A list of hostnames that will trigger this integration.\n\n---\n\nThe hostname is parsed from the `Host` header of the request.\nWildcards (`*` and `?`) are supported.\n\nExample: `api.example.com`, `*.myapp.com`","type":"array","items":{"type":"string"}},"headers":{"description":"#### A list of header conditions that the request must match.\n\n---\n\nAll header conditions must be met for the request to be routed.","type":"array","items":{"$ref":"#/definitions/LbHeaderCondition"}},"queryParams":{"description":"#### A list of query parameter conditions that the request must match.\n\n---\n\nAll query parameter conditions must be met for the request to be routed.","type":"array","items":{"$ref":"#/definitions/LbQueryParamCondition"}},"sourceIps":{"description":"#### A list of source IP addresses (in CIDR format) that are allowed to trigger this integration.\n\n---\n\n> **Note:** If the client is behind a proxy, this will be the IP address of the proxy.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["loadBalancerName","priority"]},"SnsIntegration":{"description":"#### Triggers a function when a new message is published to an SNS topic.\n\n---\n\nSNS is a pub/sub messaging service. Reference a topic from your stack's `snsTopics` or use an external ARN.","type":"object","properties":{"type":{"type":"string","const":"sns"},"properties":{"$ref":"#/definitions/SnsIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"SnsIntegrationProps":{"type":"object","properties":{"snsTopicName":{"description":"#### The name of an SNS topic defined in your stack's resources.\n\n---\n\nYou must specify either `snsTopicName` or `snsTopicArn`.","type":"string"},"snsTopicArn":{"description":"#### The ARN of an existing SNS topic.\n\n---\n\nUse this to subscribe to a topic that is not managed by your stack.\nYou must specify either `snsTopicName` or `snsTopicArn`.","type":"string"},"filterPolicy":{"description":"#### Filter messages by attributes so only relevant ones trigger the function.\n\n---\n\nUses SNS subscription filter policy syntax. For content-based filtering, use EventBridge instead."},"onDeliveryFailure":{"$ref":"#/definitions/SnsOnDeliveryFailure","description":"#### A destination for messages that fail to be delivered to the target.\n\n---\n\nIn rare cases (e.g., if the target function cannot scale fast enough), a message might fail to be delivered.\nThis property specifies an SQS queue where failed messages will be sent."}},"additionalProperties":false},"SnsOnDeliveryFailure":{"type":"object","properties":{"sqsQueueArn":{"description":"#### The ARN of the SQS queue for failed messages.","type":"string"},"sqsQueueName":{"description":"#### The name of an SQS queue (defined in your Stacktape configuration) for failed messages.","type":"string"}},"additionalProperties":false},"SqsIntegration":{"description":"#### Triggers a function when new messages are available in an SQS queue.\n\n---\n\nMessages are processed in batches. The function fires when `batchSize` is reached,\n`maxBatchWindowSeconds` expires, or the 6 MB payload limit is hit.\n\n**Important:** A single SQS queue should only have one consumer function. For fan-out (multiple\nconsumers for the same message), use an SNS topic or EventBridge event bus instead.","type":"object","properties":{"type":{"type":"string","const":"sqs"},"properties":{"$ref":"#/definitions/SqsIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"SqsIntegrationProps":{"type":"object","properties":{"sqsQueueName":{"description":"#### The name of an SQS queue defined in your stack's resources.\n\n---\n\nYou must specify either `sqsQueueName` or `sqsQueueArn`.","type":"string"},"sqsQueueArn":{"description":"#### The ARN of an existing SQS queue.\n\n---\n\nUse this to consume messages from a queue that is not managed by your stack.\nYou must specify either `sqsQueueName` or `sqsQueueArn`.","type":"string"},"batchSize":{"description":"#### The maximum number of records to process in a single batch.\n\n---\n\nMaximum is 10,000.","default":10,"type":"number"},"maxBatchWindowSeconds":{"description":"#### The maximum time (in seconds) to wait before invoking the function with a batch of records.\n\n---\n\nMaximum is 300 seconds. If not set, the function is invoked as soon as messages are available.","type":"number"}},"additionalProperties":false},"KinesisIntegration":{"description":"#### Triggers a function when new records are available in a Kinesis Data Stream.\n\n---\n\nRecords are processed in batches. Two consumption modes:\n- **Direct**: Polls each shard ~1/sec, throughput shared with other consumers.\n- **Stream Consumer** (`autoCreateConsumer`): Dedicated connection per shard — higher throughput, lower latency.","type":"object","properties":{"type":{"type":"string","const":"kinesis-stream"},"properties":{"$ref":"#/definitions/KinesisIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"KinesisIntegrationProps":{"type":"object","properties":{"kinesisStreamName":{"description":"#### The name of a Kinesis stream defined in your stack's resources.\n\n---\n\nYou must specify either `kinesisStreamName` or `streamArn`.","type":"string"},"streamArn":{"description":"#### The ARN of an existing Kinesis stream to consume records from.\n\n---\n\nUse this to consume from a stream that is not managed by your stack.\nYou must specify either `kinesisStreamName` or `streamArn`.","type":"string"},"consumerArn":{"description":"#### The ARN of a specific stream consumer to use.\n\n---\n\nThis cannot be used with `autoCreateConsumer`.","type":"string"},"autoCreateConsumer":{"description":"#### Automatically creates a dedicated stream consumer for this integration.\n\n---\n\nThis is recommended for minimizing latency and maximizing throughput.\nFor more details, see the [AWS documentation on stream consumers](https://docs.aws.amazon.com/streams/latest/dev/amazon-kinesis-consumers.html).\nThis cannot be used with `consumerArn`.","type":"boolean"},"maxBatchWindowSeconds":{"description":"#### The maximum time (in seconds) to wait before invoking the function with a batch of records.\n\n---\n\nMaximum is 300 seconds.","type":"number"},"batchSize":{"description":"#### The maximum number of records to process in a single batch.\n\n---\n\nMaximum is 10,000.","default":10,"type":"number"},"startingPosition":{"description":"#### The position in the stream from which to start reading records.\n\n---\n\n- `LATEST`: Read only new records.\n- `TRIM_HORIZON`: Read all available records from the beginning of the stream.","default":"TRIM_HORIZON","enum":["LATEST","TRIM_HORIZON"],"type":"string"},"maximumRetryAttempts":{"description":"#### The number of times to retry a failed batch of records.\n\n---\n\n> **Important:** If an error occurs, the entire batch is retried, including records that were processed successfully. Your function should be idempotent to handle this.","type":"number"},"onFailure":{"$ref":"#/definitions/DestinationOnFailure","description":"#### A destination (SQS queue or SNS topic) for batches that fail after all retry attempts."},"parallelizationFactor":{"description":"#### The number of batches to process concurrently from the same shard.","type":"number"},"bisectBatchOnFunctionError":{"description":"#### Splits a failed batch in two before retrying.\n\n---\n\nThis can be useful if a failure is caused by a batch being too large.","type":"boolean"}},"additionalProperties":false},"DestinationOnFailure":{"type":"object","properties":{"arn":{"description":"#### The ARN of the SNS topic or SQS queue for failed batches.","type":"string"},"type":{"description":"#### The type of the destination.","enum":["sns","sqs"],"type":"string"}},"additionalProperties":false,"required":["arn","type"]},"DynamoDbIntegration":{"description":"#### Triggers a function when items are created, updated, or deleted in a DynamoDB table.\n\n---\n\nRecords are processed in batches. You must enable streams on the DynamoDB table first\n(set `streaming` in your `dynamoDbTables` config).","type":"object","properties":{"type":{"type":"string","const":"dynamo-db-stream"},"properties":{"$ref":"#/definitions/DynamoDbIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"DynamoDbIntegrationProps":{"type":"object","properties":{"streamArn":{"description":"#### The ARN of the DynamoDB table stream.","type":"string"},"maxBatchWindowSeconds":{"description":"#### The maximum time (in seconds) to wait before invoking the function with a batch of records.\n\n---\n\nMaximum is 300 seconds.","type":"number"},"batchSize":{"description":"#### The maximum number of records to process in a single batch.\n\n---\n\nMaximum is 1,000.","default":100,"type":"number"},"startingPosition":{"description":"#### The position in the stream from which to start reading records.\n\n---\n\n- `LATEST`: Read only new records.\n- `TRIM_HORIZON`: Read all available records from the beginning of the stream.","default":"TRIM_HORIZON","type":"string"},"maximumRetryAttempts":{"description":"#### The number of times to retry a failed batch of records.\n\n---\n\n> **Important:** If an error occurs, the entire batch is retried, including records that were processed successfully. Your function should be idempotent to handle this.","type":"number"},"onFailure":{"$ref":"#/definitions/DestinationOnFailure","description":"#### A destination (SQS queue or SNS topic) for batches that fail after all retry attempts."},"parallelizationFactor":{"description":"#### The number of batches to process concurrently from the same shard.","type":"number"},"bisectBatchOnFunctionError":{"description":"#### Splits a failed batch in two before retrying.\n\n---\n\nThis can be useful if a failure is caused by a batch being too large.","type":"boolean"}},"additionalProperties":false,"required":["streamArn"]},"S3Integration":{"description":"#### Triggers a function when files are created, deleted, or restored in an S3 bucket.","type":"object","properties":{"type":{"type":"string","const":"s3"},"properties":{"$ref":"#/definitions/S3IntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"S3IntegrationProps":{"type":"object","properties":{"bucketArn":{"description":"#### The ARN of the S3 bucket to monitor for events.","type":"string"},"s3EventType":{"description":"#### The type of S3 event that will trigger the function.","enum":["s3:ObjectCreated:*","s3:ObjectCreated:CompleteMultipartUpload","s3:ObjectCreated:Copy","s3:ObjectCreated:Post","s3:ObjectCreated:Put","s3:ObjectRemoved:*","s3:ObjectRemoved:Delete","s3:ObjectRemoved:DeleteMarkerCreated","s3:ObjectRestore:*","s3:ObjectRestore:Completed","s3:ObjectRestore:Post","s3:ReducedRedundancyLostObject","s3:Replication:*","s3:Replication:OperationFailedReplication","s3:Replication:OperationMissedThreshold","s3:Replication:OperationNotTracked","s3:Replication:OperationReplicatedAfterThreshold"],"type":"string"},"filterRule":{"$ref":"#/definitions/S3FilterRule","description":"#### A filter to apply to objects, so the function is only triggered for relevant objects."}},"additionalProperties":false,"required":["bucketArn","s3EventType"]},"S3FilterRule":{"type":"object","properties":{"prefix":{"description":"#### The prefix that an object's key must have to trigger the function.","type":"string"},"suffix":{"description":"#### The suffix that an object's key must have to trigger the function.","type":"string"}},"additionalProperties":false},"ScheduleIntegration":{"description":"#### Triggers a function on a recurring schedule (cron jobs, periodic tasks).\n\n---\n\nTwo formats:\n- **Rate**: `rate(5 minutes)`, `rate(1 hour)`, `rate(7 days)`\n- **Cron**: `cron(0 18 ? * MON-FRI *)` (6-field AWS cron, all times UTC)","type":"object","properties":{"type":{"type":"string","const":"schedule"},"properties":{"$ref":"#/definitions/ScheduleIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"ScheduleIntegrationProps":{"type":"object","properties":{"scheduleRate":{"description":"#### The schedule rate or cron expression.\n\n---\n\nExamples: `rate(2 hours)`, `cron(0 10 * * ? *)`","type":"string"},"input":{"description":"#### A fixed JSON object to be passed as the event payload.\n\n---\n\nIf you need to customize the payload based on the event, use `inputTransformer` instead.\nYou can only use one of `input`, `inputPath`, or `inputTransformer`.\n\nExample:\n\n```yaml\ninput:\n  source: 'my-scheduled-event'\n```"},"inputPath":{"description":"#### A JSONPath expression to extract a portion of the event to pass to the target.\n\n---\n\nThis is useful for forwarding only a specific part of the event payload.\nYou can only use one of `input`, `inputPath`, or `inputTransformer`.\n\nExample:\n\n```yaml\ninputPath: '$.detail'\n```","type":"string"},"inputTransformer":{"$ref":"#/definitions/EventInputTransformer","description":"#### Customizes the event payload sent to the target.\n\n---\n\nThis allows you to extract values from the original event and use them to construct a new payload.\nYou can only use one of `input`, `inputPath`, or `inputTransformer`.\n\nExample:\n\n```yaml\ninputTransformer:\n  inputPathsMap:\n    eventTime: '$.time'\n  inputTemplate:\n    message: 'This event occurred at <eventTime>.'\n```"}},"additionalProperties":false,"required":["scheduleRate"]},"EventInputTransformer":{"type":"object","properties":{"inputPathsMap":{"description":"#### A map of key-value pairs to extract from the event payload.\n\n---\n\nEach value is a JSONPath expression that extracts data from the event. These extracted values can then be used in the `inputTemplate`."},"inputTemplate":{"description":"#### A template for constructing a new event payload.\n\n---\n\nUse placeholders (`<placeholder>`) to insert the values extracted with `inputPathsMap`."}},"additionalProperties":false,"required":["inputTemplate"]},"CloudwatchLogIntegration":{"description":"#### Triggers a function when new log records appear in a CloudWatch log group.\n\n---\n\n**Note:** The event payload is base64-encoded and gzipped — you must decode and decompress it in your handler.","type":"object","properties":{"type":{"type":"string","const":"cloudwatch-log"},"properties":{"$ref":"#/definitions/CloudwatchLogIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"CloudwatchLogIntegrationProps":{"type":"object","properties":{"logGroupArn":{"description":"#### The ARN of the log group to watch for new records.","type":"string"},"filter":{"description":"#### A filter pattern to apply to the log records.\n\n---\n\nOnly logs that match this pattern will trigger the function.\nFor details on the syntax, see the [AWS documentation on filter and pattern syntax](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html).","type":"string"}},"additionalProperties":false,"required":["logGroupArn"]},"HttpApiIntegration":{"description":"#### Triggers a function when an HTTP API Gateway receives a matching request.\n\n---\n\nRoutes are matched by specificity — exact paths take priority over wildcard paths.","type":"object","properties":{"type":{"type":"string","const":"http-api-gateway"},"properties":{"$ref":"#/definitions/HttpApiIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"HttpApiIntegrationProps":{"type":"object","properties":{"httpApiGatewayName":{"description":"#### The name of the HTTP API Gateway.","type":"string"},"method":{"description":"#### The HTTP method that will trigger this integration.\n\n---\n\nYou can specify an exact method (e.g., `GET`) or use `*` to match any method.","enum":["*","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT"],"type":"string"},"path":{"description":"#### The URL path that will trigger this integration.\n\n---\n\n- **Exact path**: `/users`\n- **Path with parameter**: `/users/{id}`. The `id` will be available in `event.pathParameters.id`.\n- **Greedy path**: `/files/{proxy+}`. This will match any path starting with `/files/`.","type":"string"},"authorizer":{"$ref":"#/definitions/StpAuthorizer","description":"#### An authorizer to protect this route.\n\n---\n\nUnauthorized requests will be rejected with a `401 Unauthorized` response."},"payloadFormat":{"description":"#### The payload format version for the Lambda integration.\n\n---\n\nFor details on the differences between formats, see the [AWS documentation](https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-develop-integrations-lambda.html).","default":"'1.0'","enum":["1.0","2.0"],"type":"string"}},"additionalProperties":false,"required":["httpApiGatewayName","method","path"]},"EventBusIntegration":{"description":"#### Triggers a batch job when an event matching a specified pattern is received by an event bus.\n\n---\n\nYou can use a custom event bus or the default AWS event bus.","type":"object","properties":{"type":{"type":"string","const":"event-bus"},"properties":{"$ref":"#/definitions/EventBusIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"EventBusIntegrationProps":{"type":"object","properties":{"eventBusArn":{"description":"#### The ARN of an existing event bus.\n\n---\n\nUse this to subscribe to an event bus that is not managed by your stack.\nYou must specify only one of `eventBusArn`, `eventBusName`, or `useDefaultBus`.","type":"string"},"eventBusName":{"description":"#### The name of an event bus defined in your stack's resources.\n\n---\n\nYou must specify only one of `eventBusArn`, `eventBusName`, or `useDefaultBus`.","type":"string"},"useDefaultBus":{"description":"#### Uses the default AWS event bus.\n\n---\n\nYou must specify only one of `eventBusArn`, `eventBusName`, or `useDefaultBus`.","type":"boolean"},"eventPattern":{"$ref":"#/definitions/EventBusIntegrationPattern","description":"#### A pattern to filter events from the event bus.\n\n---\n\nOnly events that match this pattern will trigger the target.\nFor details on the syntax, see the [AWS EventBridge documentation on event patterns](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-event-patterns.html)."},"onDeliveryFailure":{"$ref":"#/definitions/EventBusOnDeliveryFailure","description":"#### A destination for events that fail to be delivered to the target.\n\n---\n\nIn rare cases, an event might fail to be delivered. This property specifies an SQS queue where failed events will be sent."},"input":{"description":"#### A fixed JSON object to be passed as the event payload.\n\n---\n\nIf you need to customize the payload based on the event, use `inputTransformer` instead.\nYou can only use one of `input`, `inputPath`, or `inputTransformer`.\n\nExample:\n\n```yaml\ninput:\n  source: 'my-custom-event'\n```"},"inputPath":{"description":"#### A JSONPath expression to extract a portion of the event to pass to the target.\n\n---\n\nThis is useful for forwarding only a specific part of the event payload.\nYou can only use one of `input`, `inputPath`, or `inputTransformer`.\n\nExample:\n\n```yaml\ninputPath: '$.detail'\n```","type":"string"},"inputTransformer":{"$ref":"#/definitions/EventInputTransformer","description":"#### Customizes the event payload sent to the target.\n\n---\n\nThis allows you to extract values from the original event and use them to construct a new payload.\nYou can only use one of `input`, `inputPath`, or `inputTransformer`.\n\nExample:\n\n```yaml\ninputTransformer:\n  inputPathsMap:\n    instanceId: '$.detail.instance-id'\n    instanceState: '$.detail.state'\n  inputTemplate:\n    message: 'Instance <instanceId> is now in state <instanceState>.'\n```"}},"additionalProperties":false,"required":["eventPattern"]},"EventBusIntegrationPattern":{"type":"object","properties":{"version":{"description":"#### Filter by event version."},"detail-type":{"description":"#### Filter by event detail-type (e.g., `[\"OrderPlaced\"]`). This is the primary field for routing custom events."},"source":{"description":"#### Filter by event source (e.g., `[\"my-app\"]` or `[\"aws.ec2\"]` for AWS service events)."},"account":{"description":"#### Filter by AWS account ID."},"region":{"description":"#### Filter by AWS region."},"resources":{"description":"#### Filter by resource ARNs."},"detail":{"description":"#### Filter by event payload content. Supports nested matching, prefix/suffix, numeric comparisons."},"replay-name":{"description":"#### Filter by replay name (only present on replayed events)."}},"additionalProperties":false},"EventBusOnDeliveryFailure":{"type":"object","properties":{"sqsQueueArn":{"description":"#### The ARN of the SQS queue for failed events.","type":"string"},"sqsQueueName":{"description":"#### The name of an SQS queue (defined in your Stacktape configuration) for failed events.","type":"string"}},"additionalProperties":false},"WebService":{"description":"#### A container running 24/7 with a public HTTPS URL.\n\n---\n\nUse for APIs, web apps, and any service that needs to be always-on and reachable from the internet.\nIncludes TLS/SSL, auto-scaling, health checks, and zero-downtime deployments.","type":"object","properties":{"type":{"type":"string","const":"web-service"},"properties":{"$ref":"#/definitions/WebServiceProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"WebServiceProps":{"type":"object","properties":{"cors":{"$ref":"#/definitions/HttpApiCorsConfig","description":"#### CORS settings. Overrides any CORS headers from your application.\n\n---\n\nOnly works with `http-api-gateway` load balancing (the default)."},"customDomains":{"description":"#### Custom domains (e.g., `api.example.com`). Stacktape auto-creates DNS records and TLS certificates.\n\n---\n\nYour domain must be added as a Route53 hosted zone in your AWS account first.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"loadBalancing":{"description":"#### How traffic reaches your containers. Affects pricing, features, and protocol support.\n\n---\n\n- **`http-api-gateway`** (default): Pay-per-request (~$1/million requests). Best for most apps.\n  Cheapest at low traffic, but costs grow with volume.\n\n- **`application-load-balancer`**: Flat ~$18/month + usage. Required for gradual deployments\n  (`deployment`), firewalls (`useFirewall`), and WebSocket support.\n  More cost-effective above ~500k requests/day. AWS Free Tier eligible.\n\n- **`network-load-balancer`**: For non-HTTP traffic (TCP/TLS) like MQTT, game servers, or custom protocols.\n  Requires explicit `ports` configuration. Does not support CDN, firewall, or gradual deployments.","anyOf":[{"$ref":"#/definitions/WebServiceHttpApiGatewayLoadBalancing"},{"$ref":"#/definitions/WebServiceAlbLoadBalancing"},{"$ref":"#/definitions/WebServiceNlbLoadBalancing"}]},"cdn":{"$ref":"#/definitions/CdnConfiguration","description":"#### Put a CDN (CloudFront) in front of this service for caching and lower latency worldwide."},"alarms":{"description":"#### Alarms for this service (merged with global alarms from the Stacktape Console).","type":"array","items":{"anyOf":[{"$ref":"#/definitions/ApplicationLoadBalancerAlarm"},{"$ref":"#/definitions/HttpApiGatewayAlarm"}]}},"disabledGlobalAlarms":{"description":"#### Global alarm names to exclude from this service.","type":"array","items":{"type":"string"}},"deployment":{"$ref":"#/definitions/ContainerWorkloadDeploymentConfig","description":"#### Gradual traffic shifting for safe deployments (canary, linear, or all-at-once).\n\n---\n\nRequires `loadBalancing` type `application-load-balancer`."},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this service from common web exploits.","type":"string"},"packaging":{"$ref":"#/definitions/ContainerWorkloadContainerPackaging","description":"#### Configures the container image for the service."},"environment":{"description":"#### Environment variables injected into the container at runtime.\n\n---\n\nUse for configuration like API keys, feature flags, or secrets.\nVariables from `connectTo` (e.g., `STP_MY_DATABASE_CONNECTION_STRING`) are added automatically.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"logging":{"$ref":"#/definitions/ContainerWorkloadContainerLogging","description":"#### Logging configuration.\n\n---\n\nContainer output (`stdout`/`stderr`) is automatically sent to CloudWatch and retained for 90 days.\nView logs with `stacktape logs` or in the Stacktape Console."},"resources":{"$ref":"#/definitions/ContainerWorkloadResourcesConfig","description":"#### CPU, memory, and compute engine for the container.\n\n---\n\nTwo compute engines:\n- **Fargate** (default): Serverless — just specify `cpu` and `memory`.\n- **EC2**: Specify `instanceTypes` for more control and potentially lower cost."},"scaling":{"$ref":"#/definitions/ContainerWorkloadScaling","description":"#### Auto-scaling: add/remove container instances based on demand.\n\n---\n\nTraffic is automatically distributed across all running containers."},"internalHealthCheck":{"$ref":"#/definitions/ContainerHealthCheck","description":"#### Health check that auto-replaces unhealthy containers.\n\n---\n\nIf a container fails the health check, it's terminated and replaced automatically."},"stopTimeout":{"description":"#### Seconds to wait for graceful shutdown before force-killing the container.\n\n---\n\nThe container receives `SIGTERM` first, then `SIGKILL` after this timeout. Must be 2-120.","default":2,"type":"number"},"enableRemoteSessions":{"description":"#### Allow SSH-like access to running containers for debugging.\n\n---\n\nEnables `stacktape container:session` to open an interactive shell inside the container.\nAdds a small SSM agent that uses minimal CPU/memory.","default":false,"type":"boolean"},"volumeMounts":{"description":"#### Persistent EFS volumes shared across containers and restarts.\n\n---\n\nData stored in EFS volumes persists even when containers are replaced.\nMultiple containers can mount the same volume. All data is encrypted in transit.","type":"array","items":{"$ref":"#/definitions/ContainerEfsMount"}},"sideContainers":{"description":"#### Helper containers that run alongside the main container.\n\n---\n\n- **`run-on-init`**: Runs to completion before the main container starts (e.g., database migrations).\n- **`always-running`**: Runs for the entire lifecycle (e.g., log forwarders, monitoring agents).\n  Can reach the main container via `localhost`.","type":"array","items":{"$ref":"#/definitions/ServiceHelperContainer"}},"usePrivateSubnetsWithNAT":{"description":"#### Deploy in private subnets with a static outbound IP via NAT Gateway.\n\n---\n\nThe container won't have a public IP. All outbound traffic routes through a NAT Gateway,\ngiving you a static IP you can whitelist in external services (APIs, payment gateways, etc.).\n\nConfigure the number of NAT Gateways in `stackConfig.vpc.nat`.\n\n**Adds cost:** NAT Gateway ~$32/month + data processing fees.","default":false,"type":"boolean"},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false,"required":["packaging","resources"]},"HttpApiCorsConfig":{"type":"object","properties":{"enabled":{"description":"#### Enable CORS. With no other options, uses permissive defaults (`*` origins, common headers).","default":false,"type":"boolean"},"allowedOrigins":{"description":"#### Allowed origins (e.g., `https://myapp.com`). Use `*` for any origin.","default":["*"],"type":"array","items":{"type":"string"}},"allowedHeaders":{"description":"#### Allowed request headers in CORS preflight.","type":"array","items":{"type":"string"}},"allowedMethods":{"description":"#### Allowed HTTP methods. Auto-detected from integrations if not set.","type":"array","items":{"$ref":"#/definitions/HttpMethod"}},"allowCredentials":{"description":"#### Allow cookies/auth headers in cross-origin requests.","type":"boolean"},"exposedResponseHeaders":{"description":"#### Response headers accessible to browser JavaScript.","type":"array","items":{"type":"string"}},"maxAge":{"description":"#### How long (seconds) browsers can cache preflight responses.","type":"number"}},"additionalProperties":false,"required":["enabled"]},"HttpMethod":{"enum":["*","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT"],"type":"string"},"DomainConfiguration":{"type":"object","properties":{"domainName":{"description":"#### Your domain name (e.g., `mydomain.com` or `api.mydomain.com`).\n\n---\n\nDon't include the protocol (`https://`). The domain must have a Route53 hosted zone\nin your AWS account, with your registrar's nameservers pointing to it.\n\nStacktape automatically creates a DNS record and provisions a free TLS certificate.","type":"string"},"customCertificateArn":{"description":"#### Use your own TLS certificate instead of the auto-generated one.\n\n---\n\nProvide the ARN of an ACM certificate from your AWS account.\nOnly needed if you have specific certificate requirements (e.g., EV/OV certs).\nBy default, Stacktape provisions and renews free certificates automatically.","type":"string"},"disableDnsRecordCreation":{"description":"#### Skip DNS record creation for this domain.\n\n---\n\nSet to `true` if you manage DNS records yourself (e.g., through Cloudflare or another DNS provider).\nStacktape will still provision the TLS certificate but won't touch your DNS.","default":false,"type":"boolean"}},"additionalProperties":false,"required":["domainName"]},"WebServiceHttpApiGatewayLoadBalancing":{"type":"object","properties":{"type":{"type":"string","const":"http-api-gateway"}},"additionalProperties":false,"required":["type"]},"WebServiceAlbLoadBalancing":{"type":"object","properties":{"type":{"type":"string","const":"application-load-balancer"},"properties":{"$ref":"#/definitions/WebServiceAlbLoadBalancingProps"}},"additionalProperties":false,"required":["type"]},"WebServiceAlbLoadBalancingProps":{"type":"object","properties":{"healthcheckPath":{"description":"#### Path the load balancer pings to check container health.","default":"/","type":"string"},"healthcheckInterval":{"description":"#### Seconds between health checks.","default":5,"type":"number"},"healthcheckTimeout":{"description":"#### Seconds before a health check is considered failed.","default":4,"type":"number"}},"additionalProperties":false},"WebServiceNlbLoadBalancing":{"type":"object","properties":{"type":{"type":"string","const":"network-load-balancer"},"properties":{"$ref":"#/definitions/WebServiceNlbLoadBalancingProps"}},"additionalProperties":false,"required":["properties","type"]},"WebServiceNlbLoadBalancingProps":{"type":"object","properties":{"healthcheckPath":{"description":"#### Health check path (only used when `healthCheckProtocol` is `HTTP`).","default":"/","type":"string"},"healthcheckInterval":{"description":"#### Seconds between health checks (5-300).","default":5,"type":"number"},"healthcheckTimeout":{"description":"#### Seconds before a health check is considered failed (2-120).","default":4,"type":"number"},"healthCheckProtocol":{"description":"#### Health check protocol: `TCP` (port check) or `HTTP` (path check).","default":"TCP","enum":["HTTP","TCP"],"type":"string"},"healthCheckPort":{"description":"#### Health check port. Defaults to the traffic port.","type":"number"},"ports":{"type":"array","items":{"$ref":"#/definitions/WebServiceNlbLoadBalancingPort"}}},"additionalProperties":false,"required":["ports"]},"WebServiceNlbLoadBalancingPort":{"type":"object","properties":{"port":{"description":"#### Public port exposed by the load balancer.","type":"number"},"protocol":{"description":"#### Protocol: `TLS` (encrypted) or `TCP` (raw).","default":"TLS","enum":["TCP","TLS"],"type":"string"},"containerPort":{"description":"#### Port on the container that receives the traffic. Defaults to `port`.","type":"number"}},"additionalProperties":false,"required":["port"]},"CdnConfiguration":{"type":"object","properties":{"enabled":{"description":"#### Enable CDN (CloudFront) for faster global delivery and lower bandwidth costs.\n\n---\n\nCaches responses at edge locations worldwide so users get content from the nearest server.\nThe CDN itself has no monthly fee — you pay per request (~$0.01/10k) and per GB transferred.","default":false,"type":"boolean"},"cachingOptions":{"$ref":"#/definitions/CdnCachingOptions","description":"#### Control how long and what gets cached at the CDN edge.\n\n---\n\nWhen the origin response has no `Cache-Control` header, defaults apply:\n- **Bucket origins**: cached for 6 months (or until invalidated on deploy).\n- **API Gateway / Load Balancer origins**: not cached."},"forwardingOptions":{"$ref":"#/definitions/CdnForwardingOptions","description":"#### Control which headers, cookies, and query params are forwarded to your origin.\n\n---\n\nBy default, all headers/cookies/query params are forwarded. Use this to restrict\nwhat reaches your app (e.g., strip cookies for static content)."},"routeRewrites":{"description":"#### Route specific URL patterns to different origins (e.g., `/api/*` → Lambda, `/assets/*` → S3).\n\n---\n\nEvaluated in order; first match wins. Unmatched requests go to the default origin.\nEach route can have its own caching and forwarding settings.","type":"array","items":{"$ref":"#/definitions/CdnRouteRewrite"}},"customDomains":{"description":"#### Custom domains (e.g., `cdn.example.com`). Stacktape auto-creates DNS records and TLS certificates.\n\n---\n\nYour domain must be added as a Route53 hosted zone in your AWS account first.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"edgeFunctions":{"$ref":"#/definitions/EdgeFunctionsConfig","description":"#### Run edge functions on CDN requests/responses (URL rewrites, auth, A/B testing).\n\n---\n\n- `onRequest`: Before cache lookup — modify the request, add auth, or return early.\n- `onResponse`: Before returning to the client — modify headers, add cookies."},"cloudfrontPriceClass":{"description":"#### Which regions the CDN serves from. Fewer regions = lower cost, but slower for distant users.\n\n---\n\n- **`PriceClass_100`**: North America + Europe. Cheapest option. Good if your users are in the US/EU.\n- **`PriceClass_200`**: Adds Asia, Middle East, Africa.\n- **`PriceClass_All`** (default): All regions worldwide, including South America and Oceania.\n\nThe CDN itself has no monthly base cost - you only pay per request and per GB transferred.\nThe price class controls which edge locations are used, and some regions cost more per request.","default":"PriceClass_All","enum":["PriceClass_100","PriceClass_200","PriceClass_All"],"type":"string"},"defaultRoutePrefix":{"description":"#### Prepend a path prefix to all requests forwarded to the origin.\n\n---\n\nE.g., with prefix `/v2`, a request for `/users` is forwarded to the origin as `/v2/users`.","type":"string"},"errorDocument":{"description":"#### Page to show for 404 errors (e.g., `/error.html`).","default":"/404.html","type":"string"},"indexDocument":{"description":"#### Page served for requests to `/`.","default":"/index.html","type":"string"},"disableInvalidationAfterDeploy":{"description":"#### Skip clearing the CDN cache after each deploy.\n\n---\n\nBy default, all cached content is flushed on every deploy so users see the latest version.\nSet to `true` if you manage cache invalidation yourself or want to keep cached content between deploys.","default":false,"type":"boolean"},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this CDN from common web exploits.","type":"string"}},"additionalProperties":false,"required":["enabled"]},"CdnCachingOptions":{"type":"object","properties":{"cacheMethods":{"description":"#### HTTP methods to cache. Use `['GET', 'HEAD', 'OPTIONS']` if your API uses CORS preflight.","type":"array","items":{"enum":["GET","HEAD","OPTIONS"],"type":"string"}},"minTTL":{"description":"#### Minimum cache time (seconds). Overrides `Cache-Control: max-age` if the origin sets a lower value.","type":"number"},"maxTTL":{"description":"#### Maximum cache time (seconds). Caps how long the CDN caches content, even if the origin says longer.","type":"number"},"defaultTTL":{"description":"#### Default cache time (seconds). Used when the origin response has no `Cache-Control` or `Expires` header.","type":"number"},"disableCompression":{"description":"#### Disable automatic Gzip/Brotli compression. Compression is on by default and reduces transfer size/cost.","default":false,"type":"boolean"},"cacheKeyParameters":{"$ref":"#/definitions/CdnCacheKey","description":"#### Which headers, cookies, and query params make responses unique in the cache.\n\n---\n\nDefaults: **Bucket** = URL path only. **API/ALB** = URL path + query string.\nValues included in the cache key are always forwarded to the origin."},"cachePolicyId":{"description":"#### Use a pre-existing AWS cache policy ID instead of configuring TTL and cache key options here.","type":"string"}},"additionalProperties":false},"CdnCacheKey":{"type":"object","properties":{"cookies":{"$ref":"#/definitions/CacheKeyCookies","description":"#### Which cookies to include in the cache key. Different cookie values = different cached responses."},"headers":{"$ref":"#/definitions/CacheKeyHeaders","description":"#### Which headers to include in the cache key. Different header values = different cached responses."},"queryString":{"$ref":"#/definitions/CacheKeyQueryString","description":"#### Which query params to include in the cache key. Different param values = different cached responses."}},"additionalProperties":false},"CacheKeyCookies":{"type":"object","properties":{"none":{"description":"#### No cookies are included in the cache key.","type":"boolean"},"whitelist":{"description":"#### Only the listed cookies are included in the cache key.","type":"array","items":{"type":"string"}},"allExcept":{"description":"#### All cookies except the listed ones are included in the cache key.","type":"array","items":{"type":"string"}},"all":{"description":"#### All cookies are included in the cache key.","type":"boolean"}},"additionalProperties":false},"CacheKeyHeaders":{"type":"object","properties":{"none":{"description":"#### No headers are included in the cache key.","type":"boolean"},"whitelist":{"description":"#### Only the listed headers are included in the cache key.","type":"array","items":{"type":"string"}}},"additionalProperties":false},"CacheKeyQueryString":{"type":"object","properties":{"all":{"description":"#### All query parameters are included in the cache key.","type":"boolean"},"none":{"description":"#### No query parameters are included in the cache key.","type":"boolean"},"whitelist":{"description":"#### Only the listed query parameters are included in the cache key.","type":"array","items":{"type":"string"}}},"additionalProperties":false},"CdnForwardingOptions":{"type":"object","properties":{"customRequestHeaders":{"description":"#### Static headers the CDN adds to every request sent to the origin (e.g., API keys, custom identifiers).","type":"array","items":{"$ref":"#/definitions/CdnCustomRequestHeader"}},"allowedMethods":{"description":"#### HTTP methods forwarded to the origin. Default: all methods.","type":"array","items":{"enum":["DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT"],"type":"string"}},"cookies":{"$ref":"#/definitions/ForwardCookies","description":"#### Which cookies to forward to the origin. Default: all cookies.\n\n---\n\nCookies in the cache key (see `cachingOptions`) are always forwarded regardless of this setting."},"headers":{"$ref":"#/definitions/ForwardHeaders","description":"#### Which headers to forward to the origin. Default: all headers.\n\n---\n\n> The `Authorization` header must be added to `cachingOptions.cacheKeyParameters` to be forwarded."},"queryString":{"$ref":"#/definitions/ForwardQueryString","description":"#### Which query params to forward to the origin. Default: all query params."},"originRequestPolicyId":{"description":"#### Use a pre-existing AWS origin request policy ID instead of configuring forwarding options here.","type":"string"}},"additionalProperties":false},"CdnCustomRequestHeader":{"type":"object","properties":{"headerName":{"description":"#### Name of the header","type":"string"},"value":{"description":"#### Value of the header","type":"string"}},"additionalProperties":false,"required":["headerName","value"]},"ForwardCookies":{"type":"object","properties":{"none":{"description":"#### No cookies are forwarded to the origin.","type":"boolean"},"whitelist":{"description":"#### Only the listed cookies are forwarded to the origin.","type":"array","items":{"type":"string"}},"all":{"description":"#### All cookies are forwarded to the origin.","type":"boolean"}},"additionalProperties":false},"ForwardHeaders":{"type":"object","properties":{"none":{"description":"#### No headers are forwarded to the origin.","type":"boolean"},"whitelist":{"description":"#### Only the listed headers are forwarded to the origin.","type":"array","items":{"type":"string"}},"allViewer":{"description":"#### Forward all headers from the viewer's request.","type":"boolean"},"allViewerAndWhitelistCloudFront":{"description":"#### Forward all viewer headers plus the listed CloudFront-specific headers (e.g., `CloudFront-Viewer-Country`).","type":"array","items":{"type":"string"}},"allExcept":{"description":"#### Forward all viewer headers except the listed ones.","type":"array","items":{"type":"string"}}},"additionalProperties":false},"ForwardQueryString":{"type":"object","properties":{"all":{"description":"#### All query parameters are forwarded to the origin.","type":"boolean"},"none":{"description":"#### No query parameters are forwarded to the origin.","type":"boolean"},"whitelist":{"description":"#### Only the listed query parameters are forwarded to the origin.","type":"array","items":{"type":"string"}}},"additionalProperties":false},"CdnRouteRewrite":{"type":"object","properties":{"path":{"description":"#### URL path pattern to match (e.g., `/api/*`, `*.jpg`, `/docs/v2/*`). Wildcards supported.","type":"string"},"routePrefix":{"description":"#### Prepend a path prefix to requests before forwarding to the origin.\n\n---\n\nE.g., with prefix `/v2`, a request for `/users` is forwarded as `/v2/users`.","type":"string"},"routeTo":{"description":"#### Where to send matching requests. Can be a bucket, API Gateway, load balancer, Lambda, or external domain.\n\n---\n\nIf not set, requests go to the default origin (the resource this CDN is attached to).","anyOf":[{"$ref":"#/definitions/CdnLoadBalancerRoute"},{"$ref":"#/definitions/CdnHttpApiGatewayRoute"},{"$ref":"#/definitions/CdnLambdaFunctionRoute"},{"$ref":"#/definitions/CdnCustomDomainRoute"},{"$ref":"#/definitions/CdnBucketRoute"}]},"cachingOptions":{"$ref":"#/definitions/CdnCachingOptions","description":"#### Override caching behavior for requests matching this route."},"forwardingOptions":{"$ref":"#/definitions/CdnForwardingOptions","description":"#### Override which headers, cookies, and query params are forwarded for this route."},"edgeFunctions":{"$ref":"#/definitions/EdgeFunctionsConfig","description":"#### Run edge functions on requests/responses matching this route."}},"additionalProperties":false,"required":["path"]},"CdnLoadBalancerRoute":{"type":"object","properties":{"type":{"type":"string","const":"application-load-balancer"},"properties":{"$ref":"#/definitions/CdnLoadBalancerOrigin"}},"additionalProperties":false,"required":["properties","type"]},"CdnLoadBalancerOrigin":{"type":"object","properties":{"loadBalancerName":{"description":"#### Name of the `application-load-balancer` resource to route to.","type":"string"},"listenerPort":{"description":"#### Listener port on the load balancer. Only needed if using custom listeners.","type":"number"},"originDomainName":{"description":"#### Explicit origin domain. Only needed if the ALB has no `customDomains` and uses `customCertificateArns`.","type":"string"}},"additionalProperties":false,"required":["loadBalancerName"]},"CdnHttpApiGatewayRoute":{"type":"object","properties":{"type":{"type":"string","const":"http-api-gateway"},"properties":{"$ref":"#/definitions/CdnHttpApiGatewayOrigin"}},"additionalProperties":false,"required":["properties","type"]},"CdnHttpApiGatewayOrigin":{"type":"object","properties":{"httpApiGatewayName":{"description":"#### Name of the `http-api-gateway` resource to route to.","type":"string"}},"additionalProperties":false,"required":["httpApiGatewayName"]},"CdnLambdaFunctionRoute":{"type":"object","properties":{"type":{"type":"string","const":"function"},"properties":{"$ref":"#/definitions/CdnLambdaFunctionOrigin"}},"additionalProperties":false,"required":["properties","type"]},"CdnLambdaFunctionOrigin":{"type":"object","properties":{"functionName":{"description":"#### Name of the `function` resource to route to. The function must have `url.enabled: true`.","type":"string"}},"additionalProperties":false,"required":["functionName"]},"CdnCustomDomainRoute":{"type":"object","properties":{"type":{"type":"string","const":"custom-origin"},"properties":{"$ref":"#/definitions/CdnCustomOrigin"}},"additionalProperties":false,"required":["properties","type"]},"CdnCustomOrigin":{"type":"object","properties":{"domainName":{"description":"#### Domain name of the external origin (e.g., `api.example.com`).","type":"string"},"protocol":{"description":"#### Protocol for connecting to the origin.","default":"HTTPS","enum":["HTTP","HTTPS"],"type":"string"},"port":{"description":"#### Port on the origin. Defaults to 443 for HTTPS, 80 for HTTP.","type":"number"}},"additionalProperties":false,"required":["domainName"]},"CdnBucketRoute":{"type":"object","properties":{"type":{"type":"string","const":"bucket"},"properties":{"$ref":"#/definitions/CdnBucketOrigin"}},"additionalProperties":false,"required":["properties","type"]},"CdnBucketOrigin":{"type":"object","properties":{"bucketName":{"description":"#### Name of the `bucket` resource to route to.","type":"string"},"disableUrlNormalization":{"description":"#### Disable clean URL normalization (e.g., `/about` → `/about.html`).","default":false,"type":"boolean"}},"additionalProperties":false,"required":["bucketName"]},"EdgeFunctionsConfig":{"type":"object","properties":{"onRequest":{"description":"#### Name of an `edge-lambda-function` to run when the CDN receives a request (before cache lookup).\n\n---\n\nUse to modify the request, add auth checks, or return an immediate response without hitting the origin.","type":"string"},"onResponse":{"description":"#### Name of an `edge-lambda-function` to run before returning the response to the client.\n\n---\n\nUse to modify response headers, add security headers, or set cookies.\nDoes not run if the origin returned a 400+ error or if `onRequest` already generated a response.","type":"string"},"onOriginRequest":{"description":"#### Name of an `edge-lambda-function` to run before forwarding to the origin (after cache miss).\n\n---\n\nOnly runs on cache misses. Use to modify the request before it reaches your origin.\n\n> **Warning:** Stacktape uses this trigger internally for bucket/web-service/API Gateway CDN setups.\n> Overriding it may break default behavior. Only use if you know what you're doing.","type":"string"},"onOriginResponse":{"description":"#### Name of an `edge-lambda-function` to run after the origin responds (before caching).\n\n---\n\nModify the response before it's cached and returned. Changes are cached as if they came from the origin.","type":"string"}},"additionalProperties":false},"ApplicationLoadBalancerAlarm":{"type":"object","properties":{"trigger":{"$ref":"#/definitions/ApplicationLoadBalancerAlarmTrigger"},"evaluation":{"$ref":"#/definitions/AlarmEvaluation","description":"#### How long and how often to evaluate the metric before triggering.\n\n---\n\nControls the evaluation window (period), how many periods to look at, and how many must breach\nthe threshold to fire the alarm. Useful for filtering out short spikes."},"notificationTargets":{"description":"#### Where to send notifications when the alarm fires — Slack, MS Teams, or email.","type":"array","items":{"$ref":"#/definitions/AlarmUserIntegration"}},"description":{"description":"#### Custom alarm description used in notification messages and the AWS console.","type":"string"}},"additionalProperties":false,"required":["trigger"]},"ApplicationLoadBalancerAlarmTrigger":{"anyOf":[{"$ref":"#/definitions/ApplicationLoadBalancerCustomTrigger"},{"$ref":"#/definitions/ApplicationLoadBalancerErrorRateTrigger"},{"$ref":"#/definitions/ApplicationLoadBalancerUnhealthyTargetsTrigger"}]},"ApplicationLoadBalancerCustomTrigger":{"type":"object","properties":{"type":{"type":"string","const":"application-load-balancer-custom"},"properties":{"$ref":"#/definitions/ApplicationLoadBalancerCustomTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"ApplicationLoadBalancerCustomTriggerProps":{"type":"object","properties":{"metric":{"$ref":"#/definitions/ApplicationLoadBalancerMetric","description":"#### The metric to monitor on the Load Balancer.\n\n---\n\nThe threshold will be compared against the calculated value of `statistic(METRIC)`, where:\n- `statistic` is the function applied to the metric values collected during the evaluation period (default: `avg`).\n- `METRIC` is the chosen metric.\n\n**Available Metrics:**\n\n- `ActiveConnectionCount`: The total number of concurrent TCP connections active from clients to the load balancer and from the load balancer to targets.\n- `AnomalousHostCount`: The number of hosts detected with anomalies.\n- `ClientTLSNegotiationErrorCount`: The number of TLS connections initiated by the client that did not establish a session with the load balancer due to a TLS error.\n- `ConsumedLCUs`: The number of load balancer capacity units (LCU) used by your load balancer.\n- `DesyncMitigationMode_NonCompliant_Request_Count`: The number of requests that do not comply with RFC 7230.\n- `DroppedInvalidHeaderRequestCount`: The number of requests where the load balancer removed HTTP headers with invalid fields before routing the request.\n- `MitigatedHostCount`: The number of targets under mitigation.\n- `ForwardedInvalidHeaderRequestCount`: The number of requests routed by the load balancer that had HTTP headers with invalid fields.\n- `GrpcRequestCount`: The number of gRPC requests processed over IPv4 and IPv6.\n- `HTTP_Fixed_Response_Count`: The number of successful fixed-response actions.\n- `HTTP_Redirect_Count`: The number of successful redirect actions.\n- `HTTP_Redirect_Url_Limit_Exceeded_Count`: The number of redirect actions that failed because the URL in the response location header exceeded 8K.\n- `HTTPCode_ELB_3XX_Count`: The number of HTTP 3XX redirection codes originating from the load balancer.\n- `HTTPCode_ELB_4XX_Count`: The number of HTTP 4XX client error codes originating from the load balancer.\n- `HTTPCode_ELB_5XX_Count`: The number of HTTP 5XX server error codes originating from the load balancer.\n- `HTTPCode_ELB_500_Count`: The number of HTTP 500 error codes originating from the load balancer.\n- `HTTPCode_ELB_502_Count`: The number of HTTP 502 error codes originating from the load balancer.\n- `HTTPCode_ELB_503_Count`: The number of HTTP 503 error codes originating from the load balancer.\n- `HTTPCode_ELB_504_Count`: The number of HTTP 504 error codes originating from the load balancer.\n- `IPv6ProcessedBytes`: The total number of bytes processed by the load balancer over IPv6.\n- `IPv6RequestCount`: The number of IPv6 requests received by the load balancer.\n- `NewConnectionCount`: The total number of new TCP connections established from clients to the load balancer and from the load balancer to targets.\n- `NonStickyRequestCount`: The number of requests where the load balancer chose a new target because it could not use an existing sticky session.\n- `ProcessedBytes`: The total number of bytes processed by the load balancer over IPv4 and IPv6.\n- `RejectedConnectionCount`: The number of connections rejected because the load balancer reached its maximum number of connections.\n- `RequestCount`: The number of requests processed over IPv4 and IPv6.\n- `RuleEvaluations`: The number of rules processed by the load balancer, averaged over an hour.\n- `HealthyHostCount`: The number of targets that are considered healthy.\n- `HTTPCode_Target_2XX_Count`: The number of HTTP 2XX response codes generated by the targets.\n- `HTTPCode_Target_3XX_Count`: The number of HTTP 3XX response codes generated by the targets.\n- `HTTPCode_Target_4XX_Count`: The number of HTTP 4XX response codes generated by the targets.\n- `HTTPCode_Target_5XX_Count`: The number of HTTP 5XX response codes generated by the targets.\n- `RequestCountPerTarget`: The average number of requests per target in a target group.\n- `TargetConnectionErrorCount`: The number of connections that were not successfully established between the load balancer and a target.\n- `TargetResponseTime`: The time elapsed (in seconds) from when a request leaves the load balancer until the target starts sending response headers.\n- `TargetTLSNegotiationErrorCount`: The number of TLS connections initiated by the load balancer that did not establish a session with the target.\n- `UnHealthyHostCount`: The number of targets that are considered unhealthy.\n- `HealthyStateDNS`: The number of zones that meet the DNS healthy state requirements.\n- `HealthyStateRouting`: The number of zones that meet the routing healthy state requirements.\n- `UnhealthyRoutingRequestCount`: The number of requests routed using the routing failover action (fail open).\n- `UnhealthyStateDNS`: The number of zones that do not meet the DNS healthy state requirements.\n- `UnhealthyStateRouting`: The number of zones that do not meet the routing healthy state requirements.\n- `LambdaInternalError`: The number of requests to a Lambda function that failed due to an issue internal to the load balancer or AWS Lambda.\n- `LambdaTargetProcessedBytes`: The total number of bytes processed by the load balancer for requests to and responses from a Lambda function.\n- `LambdaUserError`: The number of requests to a Lambda function that failed due to an issue with the Lambda function itself.\n- `ELBAuthError`: The number of user authentications that could not be completed due to an internal error.\n- `ELBAuthFailure`: The number of user authentications that could not be completed because the IdP denied access.\n- `ELBAuthLatency`: The time elapsed (in milliseconds) to query the IdP for the ID token and user info.\n- `ELBAuthRefreshTokenSuccess`: The number of times the load balancer successfully refreshed user claims using a refresh token.\n- `ELBAuthSuccess`: The number of successful authentication actions.\n- `ELBAuthUserClaimsSizeExceeded`: The number of times a configured IdP returned user claims that exceeded 11K bytes in size."},"threshold":{"description":"#### The threshold that triggers the alarm.\n\n---\n\nThe threshold is compared against the calculated value of `statistic(METRIC)`, where:\n- `statistic` is the function applied to the metric values collected during the evaluation period (default: `avg`).\n- `METRIC` is the chosen metric.","type":"number"},"statistic":{"$ref":"#/definitions/StatisticFunction","description":"#### How to aggregate metric values within each period: `avg`, `sum`, `min`, `max`, `p90`, `p95`, `p99`.","default":"avg"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"}},"additionalProperties":false,"required":["metric","threshold"]},"ApplicationLoadBalancerMetric":{"enum":["ActiveConnectionCount","AnomalousHostCount","ClientTLSNegotiationErrorCount","ConsumedLCUs","DesyncMitigationMode_NonCompliant_Request_Count","DroppedInvalidHeaderRequestCount","ELBAuthError","ELBAuthFailure","ELBAuthLatency","ELBAuthRefreshTokenSuccess","ELBAuthSuccess","ELBAuthUserClaimsSizeExceeded","ForwardedInvalidHeaderRequestCount","GrpcRequestCount","HTTPCode_ELB_3XX_Count","HTTPCode_ELB_4XX_Count","HTTPCode_ELB_500_Count","HTTPCode_ELB_502_Count","HTTPCode_ELB_503_Count","HTTPCode_ELB_504_Count","HTTPCode_ELB_5XX_Count","HTTPCode_Target_2XX_Count","HTTPCode_Target_3XX_Count","HTTPCode_Target_4XX_Count","HTTPCode_Target_5XX_Count","HTTP_Fixed_Response_Count","HTTP_Redirect_Count","HTTP_Redirect_Url_Limit_Exceeded_Count","HealthyHostCount","HealthyStateDNS","HealthyStateRouting","IPv6ProcessedBytes","IPv6RequestCount","LambdaInternalError","LambdaTargetProcessedBytes","LambdaUserError","MitigatedHostCount","NewConnectionCount","NonStickyRequestCount","ProcessedBytes","RejectedConnectionCount","RequestCount","RequestCountPerTarget","RuleEvaluations","TargetConnectionErrorCount","TargetResponseTime","TargetTLSNegotiationErrorCount","UnHealthyHostCount","UnhealthyRoutingRequestCount","UnhealthyStateDNS","UnhealthyStateRouting"],"type":"string"},"StatisticFunction":{"enum":["avg","max","min","p90","p95","p99","sum"],"type":"string"},"ComparisonOperator":{"enum":["GreaterThanOrEqualToThreshold","GreaterThanThreshold","LessThanOrEqualToThreshold","LessThanThreshold"],"type":"string"},"ApplicationLoadBalancerErrorRateTrigger":{"type":"object","properties":{"type":{"type":"string","const":"application-load-balancer-error-rate"},"properties":{"$ref":"#/definitions/ApplicationLoadBalancerErrorRateTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"ApplicationLoadBalancerErrorRateTriggerProps":{"type":"object","properties":{"thresholdPercent":{"description":"#### Fires when 4xx/5xx error rate exceeds this percentage.\n\n---\n\nExample: `5` fires the alarm if more than 5% of requests return errors.","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"}},"additionalProperties":false,"required":["thresholdPercent"]},"ApplicationLoadBalancerUnhealthyTargetsTrigger":{"type":"object","properties":{"type":{"type":"string","const":"application-load-balancer-unhealthy-targets"},"properties":{"$ref":"#/definitions/ApplicationLoadBalancerUnhealthyTargetsTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"ApplicationLoadBalancerUnhealthyTargetsTriggerProps":{"type":"object","properties":{"thresholdPercent":{"description":"#### Fires when the percentage of unhealthy targets exceeds this value.\n\n---\n\nIf the load balancer has multiple target groups, the alarm fires if *any* group breaches the threshold.","type":"number"},"onlyIncludeTargets":{"description":"#### Only monitor health of these target container services. If omitted, monitors all targets.\n\n---\n\nOnly services actually targeted by the load balancer can be listed.","type":"array","items":{"type":"string"}},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"}},"additionalProperties":false,"required":["thresholdPercent"]},"AlarmEvaluation":{"type":"object","properties":{"period":{"description":"#### Duration of one evaluation period in seconds. Must be a multiple of 60.","default":60,"type":"number"},"evaluationPeriods":{"description":"#### How many recent periods to evaluate. Prevents alarms from firing on short spikes.\n\n---\n\nExample: set to `5` with `breachedPeriods: 3` — the alarm fires only if the threshold is breached\nin at least 3 of the last 5 periods.","default":1,"type":"number"},"breachedPeriods":{"description":"#### How many periods (within `evaluationPeriods`) must breach the threshold to fire the alarm.\n\n---\n\nMust be ≤ `evaluationPeriods`.","default":1,"type":"number"}},"additionalProperties":false},"AlarmUserIntegration":{"anyOf":[{"$ref":"#/definitions/MsTeamsIntegration"},{"$ref":"#/definitions/SlackIntegration"},{"$ref":"#/definitions/EmailIntegration"}]},"MsTeamsIntegration":{"type":"object","properties":{"type":{"type":"string","const":"ms-teams"},"properties":{"$ref":"#/definitions/MsTeamsIntegrationProps"}},"additionalProperties":false,"required":["type"]},"MsTeamsIntegrationProps":{"type":"object","properties":{"webhookUrl":{"description":"#### Incoming Webhook URL for the MS Teams channel. Store as `$Secret()` for security.\n\n---\n\nCreate an Incoming Webhook connector in your Teams channel settings to get this URL.","type":"string"}},"additionalProperties":false,"required":["webhookUrl"]},"SlackIntegration":{"type":"object","properties":{"type":{"type":"string","const":"slack"},"properties":{"$ref":"#/definitions/SlackIntegrationProps"}},"additionalProperties":false,"required":["type"]},"SlackIntegrationProps":{"type":"object","properties":{"conversationId":{"description":"#### The Slack channel or DM ID to send notifications to.\n\n---\n\nTo find the ID: open the channel, click its name, and look at the bottom of the **About** tab.","type":"string"},"accessToken":{"description":"#### Bot User OAuth Token for your Slack app. Store as `$Secret()` for security.\n\n---\n\nCreate a Slack app, add the `chat:write` scope, install it to your workspace, then copy the Bot User OAuth Token.","type":"string"}},"additionalProperties":false,"required":["accessToken","conversationId"]},"EmailIntegration":{"type":"object","properties":{"type":{"type":"string","const":"email"},"properties":{"$ref":"#/definitions/EmailIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"EmailIntegrationProps":{"type":"object","properties":{"sender":{"description":"#### The email address of the sender.","type":"string"},"recipient":{"description":"#### The email address of the recipient.","type":"string"}},"additionalProperties":false,"required":["recipient","sender"]},"HttpApiGatewayAlarm":{"type":"object","properties":{"trigger":{"$ref":"#/definitions/HttpApiGatewayAlarmTrigger"},"evaluation":{"$ref":"#/definitions/AlarmEvaluation","description":"#### How long and how often to evaluate the metric before triggering.\n\n---\n\nControls the evaluation window (period), how many periods to look at, and how many must breach\nthe threshold to fire the alarm. Useful for filtering out short spikes."},"notificationTargets":{"description":"#### Where to send notifications when the alarm fires — Slack, MS Teams, or email.","type":"array","items":{"$ref":"#/definitions/AlarmUserIntegration"}},"description":{"description":"#### Custom alarm description used in notification messages and the AWS console.","type":"string"}},"additionalProperties":false,"required":["trigger"]},"HttpApiGatewayAlarmTrigger":{"anyOf":[{"$ref":"#/definitions/HttpApiGatewayErrorRateTrigger"},{"$ref":"#/definitions/HttpApiGatewayLatencyTrigger"}]},"HttpApiGatewayErrorRateTrigger":{"type":"object","properties":{"type":{"type":"string","const":"http-api-gateway-error-rate"},"properties":{"$ref":"#/definitions/HttpApiGatewayErrorRateTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"HttpApiGatewayErrorRateTriggerProps":{"type":"object","properties":{"thresholdPercent":{"description":"#### Fires when 4xx/5xx error rate exceeds this percentage.","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"}},"additionalProperties":false,"required":["thresholdPercent"]},"HttpApiGatewayLatencyTrigger":{"type":"object","properties":{"type":{"type":"string","const":"http-api-gateway-latency"},"properties":{"$ref":"#/definitions/HttpApiGatewayLatencyTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"HttpApiGatewayLatencyTriggerProps":{"type":"object","properties":{"thresholdMilliseconds":{"description":"#### Fires when request-to-response latency exceeds this value (ms).\n\n---\n\nDefault: fires if **average** latency > threshold. Customize with `statistic` and `comparisonOperator`.","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"},"statistic":{"$ref":"#/definitions/StatisticFunction","description":"#### How to aggregate metric values within each period: `avg`, `sum`, `min`, `max`, `p90`, `p95`, `p99`.","default":"avg"}},"additionalProperties":false,"required":["thresholdMilliseconds"]},"ServiceHelperContainer":{"type":"object","properties":{"containerType":{"description":"#### When and how this sidecar container runs.\n\n---\n\n- **`run-on-init`**: Must exit with code 0 before the main container starts. Use for migrations or setup.\n- **`always-running`**: Runs alongside the main container for its entire lifetime. If it crashes, the whole task fails.","enum":["always-running","run-on-init"],"type":"string"},"name":{"description":"#### Unique container name within this workload.","type":"string"},"packaging":{"$ref":"#/definitions/ContainerWorkloadContainerPackaging","description":"#### How to build or specify the container image."},"essential":{"description":"#### If `true` (default), the entire workload restarts when this container fails.","type":"boolean"},"logging":{"$ref":"#/definitions/ContainerWorkloadContainerLogging","description":"#### Container logging (stdout/stderr). Sent to CloudWatch, viewable with `stacktape logs`."},"dependsOn":{"description":"#### Start this container only after the listed containers reach a specific state.\n\n---\n\nE.g., wait for a database sidecar to be `HEALTHY` before starting the app container.","type":"array","items":{"$ref":"#/definitions/ContainerDependency"}},"environment":{"description":"#### Environment variables injected at runtime. Use `$ResourceParam()` or `$Secret()` for dynamic values.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"internalHealthCheck":{"$ref":"#/definitions/ContainerHealthCheck","description":"#### Command-based health check. If it fails on an essential container, the workload instance is replaced."},"stopTimeout":{"description":"#### Seconds to wait after SIGTERM before SIGKILL (2-120).","default":2,"type":"number"},"volumeMounts":{"description":"#### Mount EFS volumes for persistent, shared storage across containers.","type":"array","items":{"$ref":"#/definitions/ContainerEfsMount"}}},"additionalProperties":false,"required":["containerType","name","packaging"]},"PrivateService":{"description":"#### Always-on container with a private endpoint, reachable only from other resources in your stack.\n\n---\n\nUse for internal APIs, microservices, or gRPC servers that shouldn't be publicly accessible.\nOther containers in the same stack can reach it by name (e.g., `http://myService:3000`).","type":"object","properties":{"type":{"type":"string","const":"private-service"},"properties":{"$ref":"#/definitions/PrivateServiceProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"PrivateServiceProps":{"type":"object","properties":{"port":{"description":"#### Port this service listens on. Injected as the `PORT` env var.","default":3000,"type":"number"},"protocol":{"description":"#### Protocol for metrics collection. Set to enable protocol-specific metrics (e.g., HTTP 5xx tracking).","enum":["grpc","http","http2"],"type":"string"},"loadBalancing":{"$ref":"#/definitions/PrivateServiceLoadBalancing","description":"#### How traffic reaches this service from other resources.\n\n---\n\n- **`service-connect`** (default, ~$0.50/mo): Direct container-to-container. Cheapest option.\n  Only reachable from other container-based resources in the stack.\n- **`application-load-balancer`** (~$18/mo): HTTP load balancer. Reachable from any VPC resource.","default":"service-connect"},"packaging":{"$ref":"#/definitions/ContainerWorkloadContainerPackaging","description":"#### Configures the container image for the service."},"environment":{"description":"#### Environment variables injected into the container at runtime.\n\n---\n\nUse for configuration like API keys, feature flags, or secrets.\nVariables from `connectTo` (e.g., `STP_MY_DATABASE_CONNECTION_STRING`) are added automatically.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"logging":{"$ref":"#/definitions/ContainerWorkloadContainerLogging","description":"#### Logging configuration.\n\n---\n\nContainer output (`stdout`/`stderr`) is automatically sent to CloudWatch and retained for 90 days.\nView logs with `stacktape logs` or in the Stacktape Console."},"resources":{"$ref":"#/definitions/ContainerWorkloadResourcesConfig","description":"#### CPU, memory, and compute engine for the container.\n\n---\n\nTwo compute engines:\n- **Fargate** (default): Serverless — just specify `cpu` and `memory`.\n- **EC2**: Specify `instanceTypes` for more control and potentially lower cost."},"scaling":{"$ref":"#/definitions/ContainerWorkloadScaling","description":"#### Auto-scaling: add/remove container instances based on demand.\n\n---\n\nTraffic is automatically distributed across all running containers."},"internalHealthCheck":{"$ref":"#/definitions/ContainerHealthCheck","description":"#### Health check that auto-replaces unhealthy containers.\n\n---\n\nIf a container fails the health check, it's terminated and replaced automatically."},"stopTimeout":{"description":"#### Seconds to wait for graceful shutdown before force-killing the container.\n\n---\n\nThe container receives `SIGTERM` first, then `SIGKILL` after this timeout. Must be 2-120.","default":2,"type":"number"},"enableRemoteSessions":{"description":"#### Allow SSH-like access to running containers for debugging.\n\n---\n\nEnables `stacktape container:session` to open an interactive shell inside the container.\nAdds a small SSM agent that uses minimal CPU/memory.","default":false,"type":"boolean"},"volumeMounts":{"description":"#### Persistent EFS volumes shared across containers and restarts.\n\n---\n\nData stored in EFS volumes persists even when containers are replaced.\nMultiple containers can mount the same volume. All data is encrypted in transit.","type":"array","items":{"$ref":"#/definitions/ContainerEfsMount"}},"sideContainers":{"description":"#### Helper containers that run alongside the main container.\n\n---\n\n- **`run-on-init`**: Runs to completion before the main container starts (e.g., database migrations).\n- **`always-running`**: Runs for the entire lifecycle (e.g., log forwarders, monitoring agents).\n  Can reach the main container via `localhost`.","type":"array","items":{"$ref":"#/definitions/ServiceHelperContainer"}},"usePrivateSubnetsWithNAT":{"description":"#### Deploy in private subnets with a static outbound IP via NAT Gateway.\n\n---\n\nThe container won't have a public IP. All outbound traffic routes through a NAT Gateway,\ngiving you a static IP you can whitelist in external services (APIs, payment gateways, etc.).\n\nConfigure the number of NAT Gateways in `stackConfig.vpc.nat`.\n\n**Adds cost:** NAT Gateway ~$32/month + data processing fees.","default":false,"type":"boolean"},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false,"required":["packaging","resources"]},"PrivateServiceLoadBalancing":{"type":"object","properties":{"type":{"enum":["application-load-balancer","service-connect"],"type":"string"}},"additionalProperties":false,"required":["type"]},"WorkerService":{"description":"#### Always-on container with no public URL. For background workers, queue processors, and internal tasks.\n\n---\n\nRuns 24/7 inside your VPC. Not reachable from the internet. Can connect to databases, queues, and other resources.","type":"object","properties":{"type":{"type":"string","const":"worker-service"},"properties":{"$ref":"#/definitions/WorkerServiceProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"WorkerServiceProps":{"type":"object","properties":{"packaging":{"$ref":"#/definitions/ContainerWorkloadContainerPackaging","description":"#### Configures the container image for the service."},"environment":{"description":"#### Environment variables injected into the container at runtime.\n\n---\n\nUse for configuration like API keys, feature flags, or secrets.\nVariables from `connectTo` (e.g., `STP_MY_DATABASE_CONNECTION_STRING`) are added automatically.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"logging":{"$ref":"#/definitions/ContainerWorkloadContainerLogging","description":"#### Logging configuration.\n\n---\n\nContainer output (`stdout`/`stderr`) is automatically sent to CloudWatch and retained for 90 days.\nView logs with `stacktape logs` or in the Stacktape Console."},"resources":{"$ref":"#/definitions/ContainerWorkloadResourcesConfig","description":"#### CPU, memory, and compute engine for the container.\n\n---\n\nTwo compute engines:\n- **Fargate** (default): Serverless — just specify `cpu` and `memory`.\n- **EC2**: Specify `instanceTypes` for more control and potentially lower cost."},"scaling":{"$ref":"#/definitions/ContainerWorkloadScaling","description":"#### Auto-scaling: add/remove container instances based on demand.\n\n---\n\nTraffic is automatically distributed across all running containers."},"internalHealthCheck":{"$ref":"#/definitions/ContainerHealthCheck","description":"#### Health check that auto-replaces unhealthy containers.\n\n---\n\nIf a container fails the health check, it's terminated and replaced automatically."},"stopTimeout":{"description":"#### Seconds to wait for graceful shutdown before force-killing the container.\n\n---\n\nThe container receives `SIGTERM` first, then `SIGKILL` after this timeout. Must be 2-120.","default":2,"type":"number"},"enableRemoteSessions":{"description":"#### Allow SSH-like access to running containers for debugging.\n\n---\n\nEnables `stacktape container:session` to open an interactive shell inside the container.\nAdds a small SSM agent that uses minimal CPU/memory.","default":false,"type":"boolean"},"volumeMounts":{"description":"#### Persistent EFS volumes shared across containers and restarts.\n\n---\n\nData stored in EFS volumes persists even when containers are replaced.\nMultiple containers can mount the same volume. All data is encrypted in transit.","type":"array","items":{"$ref":"#/definitions/ContainerEfsMount"}},"sideContainers":{"description":"#### Helper containers that run alongside the main container.\n\n---\n\n- **`run-on-init`**: Runs to completion before the main container starts (e.g., database migrations).\n- **`always-running`**: Runs for the entire lifecycle (e.g., log forwarders, monitoring agents).\n  Can reach the main container via `localhost`.","type":"array","items":{"$ref":"#/definitions/ServiceHelperContainer"}},"usePrivateSubnetsWithNAT":{"description":"#### Deploy in private subnets with a static outbound IP via NAT Gateway.\n\n---\n\nThe container won't have a public IP. All outbound traffic routes through a NAT Gateway,\ngiving you a static IP you can whitelist in external services (APIs, payment gateways, etc.).\n\nConfigure the number of NAT Gateways in `stackConfig.vpc.nat`.\n\n**Adds cost:** NAT Gateway ~$32/month + data processing fees.","default":false,"type":"boolean"},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false,"required":["packaging","resources"]},"RelationalDatabase":{"description":"#### A fully managed relational (SQL) database resource.\n\n---\n\nSupports various database engines like PostgreSQL, MySQL, and MariaDB, with features like clustering and high availability.","type":"object","properties":{"type":{"type":"string","const":"relational-database"},"properties":{"$ref":"#/definitions/RelationalDatabaseProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"RelationalDatabaseProps":{"type":"object","properties":{"credentials":{"$ref":"#/definitions/RelationalDatabaseCredentials","description":"#### Master user credentials (username and password).\n\n---\n\nIncluded in the auto-generated connection string. Store the password in a Stacktape secret\nto avoid exposing it in your config file."},"engine":{"description":"#### Database engine: what type of database and how it runs.\n\n---\n\n- **RDS** (`postgres`, `mysql`, `mariadb`, etc.): Single-node, fixed-size. Simple and predictable pricing.\n- **Aurora** (`aurora-postgresql`, `aurora-mysql`): High-performance clustered DB with auto-failover.\n  Up to 5x faster than standard MySQL / 3x faster than standard PostgreSQL.\n- **Aurora Serverless v2** (`aurora-postgresql-serverless-v2`): Auto-scales from 0.5 to 128 ACUs.\n  **Recommended for most new projects** — pay only for what you use.","anyOf":[{"$ref":"#/definitions/AuroraEngine"},{"$ref":"#/definitions/AuroraServerlessEngine"},{"$ref":"#/definitions/AuroraServerlessV2Engine"},{"$ref":"#/definitions/RdsEngine"}]},"accessibility":{"$ref":"#/definitions/DatabaseAccessibility","description":"#### Who can connect to this database (network-level access control).\n\n---\n\nDefault is `internet` — anyone with credentials can connect (fine for development).\nFor production, use `scoping-workloads-in-vpc` to restrict access to only resources\nthat list this database in their `connectTo`."},"deletionProtection":{"description":"#### Prevent accidental deletion of the database. Must be disabled before deleting.","default":false,"type":"boolean"},"automatedBackupRetentionDays":{"description":"#### Days to keep automated daily backups (0-35). Set to 0 to disable (RDS only).","default":1,"type":"number"},"preferredMaintenanceWindow":{"description":"#### When maintenance (patching, upgrades) happens. Format: `Sun:02:00-Sun:04:00` (UTC).\n\n---\n\nThe database may be briefly unavailable during this window.\nUse multi-AZ or Aurora to minimize downtime.","type":"string"},"alarms":{"description":"#### Alarms for this database (merged with global alarms from the Stacktape Console).","type":"array","items":{"$ref":"#/definitions/RelationalDatabaseAlarm"}},"disabledGlobalAlarms":{"description":"#### Global alarm names to exclude from this database.","type":"array","items":{"type":"string"}},"logging":{"$ref":"#/definitions/RelationalDatabaseLogging","description":"#### Database logging (connections, slow queries, errors).\n\n---\n\nLogs are sent to CloudWatch and retained for 90 days by default.\nAvailable log types vary by engine."},"dev":{"$ref":"#/definitions/DevModeConfig","description":"#### Dev mode: runs locally in Docker by default. Set `remote: true` to use the deployed database."}},"additionalProperties":false,"required":["credentials","engine"]},"RelationalDatabaseCredentials":{"type":"object","properties":{"masterUserName":{"description":"#### Admin username. Avoid special characters: `[]{}(),;?*=!@`.\n\n---\n\n> **Warning:** Changing this after creation **replaces the database and deletes all data**.","default":"db_master_user","type":"string"},"masterUserPassword":{"description":"#### Admin password. Avoid special characters: `[]{}(),;?*=!@`.\n\n---\n\nUse `$Secret()` to store it securely instead of hardcoding:\n```yaml\nmasterUserPassword: $Secret('database.password')\n```","type":"string"}},"additionalProperties":false,"required":["masterUserPassword"]},"AuroraEngine":{"description":"#### Aurora: high-performance clustered database with auto-failover.\n\n---\n\nUp to 5x faster than MySQL, 3x faster than PostgreSQL. Data is replicated across 3 AZs\nautomatically. If the primary instance fails, a read replica is promoted in seconds.","type":"object","properties":{"type":{"enum":["aurora-mysql","aurora-postgresql"],"type":"string"},"properties":{"$ref":"#/definitions/AuroraEngineProperties"}},"additionalProperties":false,"required":["properties","type"]},"AuroraEngineProperties":{"type":"object","properties":{"dbName":{"description":"#### Name of the initial database.","default":"defdb","type":"string"},"port":{"description":"#### Port. Defaults: aurora-mysql 3306, aurora-postgresql 5432.","type":"number"},"instances":{"description":"#### Cluster instances. First = primary (writer), rest = read replicas.\n\n---\n\nReads are load-balanced across all instances. If the primary fails,\na replica is automatically promoted (usually within 30 seconds).","type":"array","items":{"$ref":"#/definitions/AuroraEngineInstance"}},"version":{"description":"#### Engine version (e.g., `16.6` for PostgreSQL, `8.0.36` for MySQL).","type":"string"},"disableAutoMinorVersionUpgrade":{"description":"#### Skip automatic minor version upgrades (e.g., 16.4 → 16.5).","default":false,"type":"boolean"}},"additionalProperties":false,"required":["instances","version"]},"AuroraEngineInstance":{"type":"object","properties":{"instanceSize":{"description":"#### Instance size (e.g., `db.t4g.medium`, `db.r6g.large`).\n\n---\n\n`t` family = burstable (dev/low-traffic). `r` family = memory-optimized (production).","type":"string"}},"additionalProperties":false,"required":["instanceSize"]},"AuroraServerlessEngine":{"description":"#### Aurora Serverless v1: auto-scaling database that can pause when idle.\n\n---\n\nScales compute capacity automatically and pauses during inactivity (you only pay for storage).\n\n> **For new projects, use Aurora Serverless v2 instead** — it has faster scaling and more granular capacity control.","type":"object","properties":{"type":{"enum":["aurora-mysql-serverless","aurora-postgresql-serverless"],"type":"string"},"properties":{"$ref":"#/definitions/AuroraServerlessEngineProperties"}},"additionalProperties":false,"required":["type"]},"AuroraServerlessEngineProperties":{"type":"object","properties":{"version":{"description":"#### Engine version. Usually managed by AWS automatically for serverless v1.","type":"string"},"dbName":{"description":"#### Name of the initial database.","default":"defdb","type":"string"},"minCapacity":{"description":"#### Minimum ACUs to scale down to (~1 ACU ≈ 2 GB RAM).\n\n---\n\nMySQL: 1-256 (powers of 2). PostgreSQL: 2-256 (powers of 2).","default":2,"type":"number"},"maxCapacity":{"description":"#### Maximum ACUs to scale up to.\n\n---\n\nMySQL: 1-256 (powers of 2). PostgreSQL: 2-256 (powers of 2).","default":4,"type":"number"},"pauseAfterSeconds":{"description":"#### Pause the database after this many seconds of inactivity (no connections).\n\n---\n\nWhen paused, you only pay for storage. Range: 300 (5 min) - 86400 (24 hr).\nOmit to never pause.","type":"number"},"disableAutoMinorVersionUpgrade":{"description":"#### Skip automatic minor version upgrades (e.g., 16.4 → 16.5).","default":false,"type":"boolean"}},"additionalProperties":false},"AuroraServerlessV2Engine":{"description":"#### Aurora Serverless v2: recommended for most new projects.\n\n---\n\nScales instantly from 0.5 to 128 ACUs in 0.5-ACU increments (~1 ACU ≈ 2 GB RAM).\nYou pay only for the capacity used, making it cost-effective for variable workloads.","type":"object","properties":{"type":{"enum":["aurora-mysql-serverless-v2","aurora-postgresql-serverless-v2"],"type":"string"},"properties":{"$ref":"#/definitions/AuroraServerlessV2EngineProperties"}},"additionalProperties":false,"required":["properties","type"]},"AuroraServerlessV2EngineProperties":{"type":"object","properties":{"dbName":{"description":"#### Name of the initial database.","default":"defdb","type":"string"},"minCapacity":{"description":"#### Minimum ACUs (0.5-128 in 0.5 increments). ~1 ACU ≈ 2 GB RAM.\n\n---\n\nSet low (0.5) for dev/staging to minimize cost. The database scales up instantly under load.","default":0.5,"type":"number"},"maxCapacity":{"description":"#### Maximum ACUs (0.5-128 in 0.5 increments). Caps your scaling and cost.","default":10,"type":"number"},"version":{"description":"#### Engine version (e.g., `16.6` for PostgreSQL, `8.0.36` for MySQL).","type":"string"},"disableAutoMinorVersionUpgrade":{"description":"#### Skip automatic minor version upgrades (e.g., 16.4 → 16.5).","default":false,"type":"boolean"}},"additionalProperties":false,"required":["version"]},"RdsEngine":{"description":"#### Standard RDS: single-instance database with predictable pricing.\n\n---\n\nChoose a fixed instance size and pay hourly. AWS handles patching, backups, and recovery.\nFor high availability, enable `multiAz` on the primary instance.","type":"object","properties":{"type":{"enum":["mariadb","mysql","oracle-ee","oracle-se2","postgres","sqlserver-ee","sqlserver-ex","sqlserver-se","sqlserver-web"],"type":"string"},"properties":{"$ref":"#/definitions/RdsEngineProperties"}},"additionalProperties":false,"required":["properties","type"]},"RdsEngineProperties":{"type":"object","properties":{"dbName":{"description":"#### Name of the database created on initialization. For Oracle, this is the SID. Not applicable to SQL Server.","type":"string"},"port":{"description":"#### Port the database listens on. Defaults: PostgreSQL 5432, MySQL/MariaDB 3306, Oracle 1521, SQL Server 1433.","type":"number"},"storage":{"$ref":"#/definitions/RdsEngineStorage","description":"#### Storage configuration. Auto-scales up when free space is low."},"primaryInstance":{"$ref":"#/definitions/RdsEnginePrimaryInstance","description":"#### The primary (writer) instance. Handles all write operations."},"readReplicas":{"description":"#### Read replicas to offload read traffic from the primary instance.\n\n---\n\nEach replica gets its own endpoint. Data is replicated asynchronously from the primary.","type":"array","items":{"$ref":"#/definitions/RdsEngineReadReplica"}},"version":{"description":"#### Engine version (e.g., `16.6` for PostgreSQL, `8.0.36` for MySQL).","type":"string"},"disableAutoMinorVersionUpgrade":{"description":"#### Skip automatic minor version upgrades (e.g., 16.4 → 16.5).","default":false,"type":"boolean"}},"additionalProperties":false,"required":["primaryInstance","version"]},"RdsEngineStorage":{"type":"object","properties":{"initialSize":{"description":"#### Initial storage in GB. Auto-scales up when free space is low.","default":20,"type":"number"},"maxSize":{"description":"#### Max storage in GB. The database won't auto-scale beyond this.","default":200,"type":"number"}},"additionalProperties":false},"RdsEnginePrimaryInstance":{"type":"object","properties":{"instanceSize":{"description":"#### Instance size (e.g., `db.t4g.micro`, `db.r6g.large`).\n\n---\n\nDetermines CPU, memory, and network capacity. Quick guide:\n- **db.t4g.micro** (~$12/mo): Dev/testing, 2 vCPU, 1 GB RAM\n- **db.t4g.medium** (~$50/mo): Small production, 2 vCPU, 4 GB RAM\n- **db.r6g.large** (~$180/mo): Production, 2 vCPU, 16 GB RAM\n\n`t` family instances are burstable (fine for low/variable load). Use `r` family for steady workloads.","type":"string"},"multiAz":{"description":"#### Create a standby replica in another availability zone for automatic failover.\n\n---\n\nIf the primary goes down, traffic fails over to the standby automatically.\nAlso reduces downtime during maintenance. Doubles the instance cost.","type":"boolean"}},"additionalProperties":false,"required":["instanceSize"]},"RdsEngineReadReplica":{"type":"object","properties":{"instanceSize":{"description":"#### Instance size (e.g., `db.t4g.micro`, `db.r6g.large`).\n\n---\n\nDetermines CPU, memory, and network capacity. Quick guide:\n- **db.t4g.micro** (~$12/mo): Dev/testing, 2 vCPU, 1 GB RAM\n- **db.t4g.medium** (~$50/mo): Small production, 2 vCPU, 4 GB RAM\n- **db.r6g.large** (~$180/mo): Production, 2 vCPU, 16 GB RAM\n\n`t` family instances are burstable (fine for low/variable load). Use `r` family for steady workloads.","type":"string"},"multiAz":{"description":"#### Create a standby replica in another availability zone for automatic failover.\n\n---\n\nIf the primary goes down, traffic fails over to the standby automatically.\nAlso reduces downtime during maintenance. Doubles the instance cost.","type":"boolean"}},"additionalProperties":false,"required":["instanceSize"]},"DatabaseAccessibility":{"type":"object","properties":{"accessibilityMode":{"description":"#### Controls who can connect to your database.\n\n---\n\n- **`internet`** (default): Anyone with the credentials can connect. Simplest setup, great for development.\n  The database is still protected by username/password.\n- **`vpc`**: Only your app's resources (and anything in the same VPC) can connect.\n  You can also whitelist specific IPs (e.g., your office) using `whitelistedIps`.\n- **`scoping-workloads-in-vpc`**: Most restrictive. Only resources that explicitly list this\n  database in their `connectTo` can reach it. Best for production.\n- **`whitelisted-ips-only`**: Only the IP addresses you list in `whitelistedIps` can connect.\n\n> Aurora Serverless engines only support `vpc` or `scoping-workloads-in-vpc`.","default":"internet","enum":["internet","scoping-workloads-in-vpc","vpc","whitelisted-ips-only"],"type":"string"},"forceDisablePublicIp":{"description":"#### Remove the database's public IP entirely (VPC-only access).\n\n---\n\n> For Aurora, this can only be set at creation time and cannot be changed later.","type":"boolean"},"whitelistedIps":{"description":"#### IP addresses or CIDR ranges allowed to connect (e.g., `203.0.113.50/32`).\n\n---\n\n- In `vpc`/`scoping-workloads-in-vpc`: adds external IPs on top of VPC access (e.g., your office).\n- In `whitelisted-ips-only`: only these IPs can connect.\n- No effect in `internet` mode.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["accessibilityMode"]},"RelationalDatabaseAlarm":{"type":"object","properties":{"trigger":{"$ref":"#/definitions/RelationalDatabaseAlarmTrigger"},"evaluation":{"$ref":"#/definitions/AlarmEvaluation","description":"#### How long and how often to evaluate the metric before triggering.\n\n---\n\nControls the evaluation window (period), how many periods to look at, and how many must breach\nthe threshold to fire the alarm. Useful for filtering out short spikes."},"notificationTargets":{"description":"#### Where to send notifications when the alarm fires — Slack, MS Teams, or email.","type":"array","items":{"$ref":"#/definitions/AlarmUserIntegration"}},"description":{"description":"#### Custom alarm description used in notification messages and the AWS console.","type":"string"}},"additionalProperties":false,"required":["trigger"]},"RelationalDatabaseAlarmTrigger":{"anyOf":[{"$ref":"#/definitions/RelationalDatabaseReadLatencyTrigger"},{"$ref":"#/definitions/RelationalDatabaseWriteLatencyTrigger"},{"$ref":"#/definitions/RelationalDatabaseCPUUtilizationTrigger"},{"$ref":"#/definitions/RelationalDatabaseFreeStorageTrigger"},{"$ref":"#/definitions/RelationalDatabaseFreeMemoryTrigger"},{"$ref":"#/definitions/RelationalDatabaseConnectionCountTrigger"}]},"RelationalDatabaseReadLatencyTrigger":{"type":"object","properties":{"type":{"type":"string","const":"database-read-latency"},"properties":{"$ref":"#/definitions/RelationalDatabaseReadLatencyTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"RelationalDatabaseReadLatencyTriggerProps":{"type":"object","properties":{"thresholdSeconds":{"description":"#### Fires when average read I/O latency exceeds this value (seconds).","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"},"statistic":{"$ref":"#/definitions/StatisticFunction","description":"#### How to aggregate metric values within each period: `avg`, `sum`, `min`, `max`, `p90`, `p95`, `p99`.","default":"avg"}},"additionalProperties":false,"required":["thresholdSeconds"]},"RelationalDatabaseWriteLatencyTrigger":{"type":"object","properties":{"type":{"type":"string","const":"database-write-latency"},"properties":{"$ref":"#/definitions/RelationalDatabaseWriteLatencyTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"RelationalDatabaseWriteLatencyTriggerProps":{"type":"object","properties":{"thresholdSeconds":{"description":"#### Fires when average write I/O latency exceeds this value (seconds).","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"},"statistic":{"$ref":"#/definitions/StatisticFunction","description":"#### How to aggregate metric values within each period: `avg`, `sum`, `min`, `max`, `p90`, `p95`, `p99`.","default":"avg"}},"additionalProperties":false,"required":["thresholdSeconds"]},"RelationalDatabaseCPUUtilizationTrigger":{"type":"object","properties":{"type":{"type":"string","const":"database-cpu-utilization"},"properties":{"$ref":"#/definitions/RelationalDatabaseCPUUtilizationTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"RelationalDatabaseCPUUtilizationTriggerProps":{"type":"object","properties":{"thresholdPercent":{"description":"#### Fires when CPU utilization exceeds this percentage.","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"},"statistic":{"$ref":"#/definitions/StatisticFunction","description":"#### How to aggregate metric values within each period: `avg`, `sum`, `min`, `max`, `p90`, `p95`, `p99`.","default":"avg"}},"additionalProperties":false,"required":["thresholdPercent"]},"RelationalDatabaseFreeStorageTrigger":{"type":"object","properties":{"type":{"type":"string","const":"database-free-storage"},"properties":{"$ref":"#/definitions/RelationalDatabaseFreeStorageTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"RelationalDatabaseFreeStorageTriggerProps":{"type":"object","properties":{"thresholdMB":{"description":"#### Fires when free disk space drops below this value (MB).\n\n---\n\nDefault: fires if **minimum** free storage < threshold.","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"},"statistic":{"$ref":"#/definitions/StatisticFunction","description":"#### How to aggregate metric values within each period: `avg`, `sum`, `min`, `max`, `p90`, `p95`, `p99`.","default":"avg"}},"additionalProperties":false,"required":["thresholdMB"]},"RelationalDatabaseFreeMemoryTrigger":{"type":"object","properties":{"type":{"type":"string","const":"database-free-memory"},"properties":{"$ref":"#/definitions/RelationalDatabaseFreeMemoryTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"RelationalDatabaseFreeMemoryTriggerProps":{"type":"object","properties":{"thresholdMB":{"description":"#### Fires when free memory drops below this value (MB).\n\n---\n\nDefault: fires if **average** free memory < threshold. Customize with `statistic` and `comparisonOperator`.","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"},"statistic":{"$ref":"#/definitions/StatisticFunction","description":"#### How to aggregate metric values within each period: `avg`, `sum`, `min`, `max`, `p90`, `p95`, `p99`.","default":"avg"}},"additionalProperties":false,"required":["thresholdMB"]},"RelationalDatabaseConnectionCountTrigger":{"type":"object","properties":{"type":{"type":"string","const":"database-connection-count"},"properties":{"$ref":"#/definitions/RelationalDatabaseConnectionCountTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"RelationalDatabaseConnectionCountTriggerProps":{"type":"object","properties":{"thresholdCount":{"description":"#### Fires when the number of active database connections exceeds this value.","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"},"statistic":{"$ref":"#/definitions/StatisticFunction","description":"#### How to aggregate metric values within each period: `avg`, `sum`, `min`, `max`, `p90`, `p95`, `p99`.","default":"avg"}},"additionalProperties":false,"required":["thresholdCount"]},"RelationalDatabaseLogging":{"type":"object","properties":{"disabled":{"description":"#### Disable CloudWatch logging entirely.","default":false,"type":"boolean"},"retentionDays":{"description":"#### How many days to keep logs.","default":90,"enum":[1,120,14,150,180,1827,3,30,365,3653,400,5,545,60,7,731,90],"type":"number"},"logTypes":{"description":"#### Which log types to export. Depends on engine:\n\n- **PostgreSQL**: `postgresql`\n- **MySQL/MariaDB**: `audit`, `error`, `general`, `slowquery`\n- **Oracle**: `alert`, `audit`, `listener`, `trace`\n- **SQL Server**: `agent`, `error`","type":"array","items":{"type":"string"}},"engineSpecificOptions":{"description":"#### Fine-grained logging settings (PostgreSQL: slow queries, statements; MySQL: audit events).","anyOf":[{"$ref":"#/definitions/PostgresLoggingOptions"},{"$ref":"#/definitions/MysqlLoggingOptions"}]},"logForwarding":{"description":"#### Forward logs to an external service (Datadog, Highlight.io, or any HTTP endpoint).\n\n---\n\nUses Kinesis Data Firehose (~$0.03/GB). Failed deliveries go to a backup S3 bucket.","anyOf":[{"$ref":"#/definitions/HttpEndpointLogForwarding"},{"$ref":"#/definitions/HighlightLogForwarding"},{"$ref":"#/definitions/DatadogLogForwarding"}]}},"additionalProperties":false},"PostgresLoggingOptions":{"type":"object","properties":{"log_connections":{"description":"#### Log new client connections.","default":false,"type":"boolean"},"log_disconnections":{"description":"#### Log client disconnections.","default":false,"type":"boolean"},"log_lock_waits":{"description":"#### Log sessions waiting for locks (helps find lock contention issues).","default":false,"type":"boolean"},"log_min_duration_statement":{"description":"#### Log queries slower than this (ms). `-1` = disabled, `0` = log all. Great for finding slow queries.","default":10000,"type":"number"},"log_statement":{"description":"#### Which SQL statements to log: `none`, `ddl` (CREATE/ALTER), `mod` (ddl + INSERT/UPDATE/DELETE), `all`.","default":"ddl","enum":["all","ddl","mod","none"],"type":"string"}},"additionalProperties":false},"MysqlLoggingOptions":{"type":"object","properties":{"server_audit_events":{"description":"#### What to record in the audit log: connections, all queries, DDL only, DML only, etc.","default":["QUERY_DDL"],"type":"array","items":{"enum":["CONNECT","QUERY","QUERY_DCL","QUERY_DDL","QUERY_DML","QUERY_DML_NO_SELECT"],"type":"string"}},"long_query_time":{"description":"#### Queries slower than this (seconds) are logged as \"slow queries\". `-1` to disable.","default":10,"type":"number"}},"additionalProperties":false},"DevModeConfig":{"description":"#### Dev Mode Configuration\n\n---\n\nControls whether this resource runs locally or connects to the deployed AWS version\nduring `stacktape dev`.","type":"object","properties":{"remote":{"description":"#### Use the deployed AWS resource instead of a local emulation.\n\n---\n\nBy default, databases, Redis, and DynamoDB run locally in Docker during dev mode.\nSet to `true` to connect to the real deployed resource instead (must be deployed first).\n\nUseful when local emulation doesn't match production behavior closely enough,\nor when you need to work with real data.","default":false,"type":"boolean"}},"additionalProperties":false},"ApplicationLoadBalancer":{"description":"#### HTTP/HTTPS load balancer with flat ~$18/month pricing. Required for WebSockets, firewalls, and gradual deployments.\n\n---\n\nRoutes requests to containers or Lambda functions based on path, host, headers, or query params.\nMore cost-effective than API Gateway above ~500k requests/day. AWS Free Tier eligible.","type":"object","properties":{"type":{"type":"string","const":"application-load-balancer"},"properties":{"$ref":"#/definitions/ApplicationLoadBalancerProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"ApplicationLoadBalancerProps":{"type":"object","properties":{"interface":{"description":"#### `internet` (public) or `internal` (VPC-only). Internal ALBs are not reachable from the internet.","default":"internet","enum":["internal","internet"],"type":"string"},"customDomains":{"description":"#### Custom domains.\n\n---\n\nBy default, Stacktape creates DNS records and TLS certificates for each domain.\nIf you manage DNS yourself, set `disableDnsRecordCreation` and provide `customCertificateArn`.\n\nBackward compatible format `string[]` is still supported.","anyOf":[{"type":"array","items":{"type":"string"}},{"type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}}]},"listeners":{"description":"#### Custom listeners (port + protocol). Defaults to HTTPS on 443 + HTTP on 80 (redirecting to HTTPS).","type":"array","items":{"$ref":"#/definitions/ApplicationLoadBalancerListener"}},"cdn":{"$ref":"#/definitions/ApplicationLoadBalancerCdnConfiguration","description":"#### Put a CDN (CloudFront) in front of this load balancer for caching and lower latency worldwide."},"alarms":{"description":"#### Alarms for this load balancer (merged with global alarms from the Stacktape Console).","type":"array","items":{"$ref":"#/definitions/ApplicationLoadBalancerAlarm"}},"disabledGlobalAlarms":{"description":"#### Global alarm names to exclude from this load balancer.","type":"array","items":{"type":"string"}},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this load balancer from common web exploits.","type":"string"}},"additionalProperties":false},"ApplicationLoadBalancerListener":{"type":"object","properties":{"protocol":{"description":"#### Listener protocol. `HTTPS` requires a TLS certificate (auto-created with `customDomains` or via `customCertificateArns`).","enum":["HTTP","HTTPS"],"type":"string"},"port":{"description":"#### Port this listener accepts traffic on (e.g., 443 for HTTPS, 80 for HTTP).","type":"number"},"customCertificateArns":{"description":"#### ARNs of your own ACM certificates. Not needed if using `customDomains` (Stacktape creates certs automatically).","type":"array","items":{"type":"string"}},"whitelistIps":{"description":"#### Restrict access to specific IP addresses/CIDRs. Default: all IPs allowed.","type":"array","items":{"type":"string"}},"defaultAction":{"$ref":"#/definitions/LbRedirect","description":"#### Action for requests that don't match any integration. Currently supports `redirect` only."}},"additionalProperties":false,"required":["port","protocol"]},"LbRedirect":{"type":"object","properties":{"type":{"description":"#### The type of the default action.","type":"string","const":"redirect"},"properties":{"$ref":"#/definitions/LbRedirectProperties","description":"#### Configures where to redirect the request.\n\n---\n\nA redirect changes the URI, which has the format: `protocol://hostname:port/path?query`.\nUnmodified URI components will retain their original values.\n\nTo avoid redirect loops, ensure that you sufficiently modify the URI.\nYou can reuse URI components with the following keywords: `#{protocol}`, `#{host}`, `#{port}`, `#{path}` (the leading `/` is removed), and `#{query}`.\n\nFor example, you can change the path to `/new/#{path}`, the hostname to `example.#{host}`, or the query to `#{query}&value=xyz`."}},"additionalProperties":false,"required":["properties","type"]},"LbRedirectProperties":{"type":"object","properties":{"path":{"description":"#### Redirect path (must start with `/`). Use `#{path}` to reuse the original path.","type":"string"},"query":{"description":"#### Query string for the redirect (without leading `?`). Use `#{query}` to preserve the original.","type":"string"},"port":{"description":"#### Redirect port (1-65535). Use `#{port}` to keep the original.","type":"number"},"host":{"description":"#### Redirect hostname. Use `#{host}` to keep the original.","type":"string"},"protocol":{"description":"#### Redirect protocol. Cannot redirect HTTPS to HTTP.","enum":["HTTP","HTTPS"],"type":"string"},"statusCode":{"description":"#### `HTTP_301` (permanent) or `HTTP_302` (temporary) redirect.","enum":["HTTP_301","HTTP_302"],"type":"string"}},"additionalProperties":false,"required":["statusCode"]},"ApplicationLoadBalancerCdnConfiguration":{"type":"object","properties":{"listenerPort":{"description":"#### Listener port for CDN traffic. Only needed if using custom listeners.","type":"number"},"originDomainName":{"description":"#### Explicit origin domain. Only needed if the ALB has no `customDomains` and uses `customCertificateArns`.","type":"string"},"enabled":{"description":"#### Enable CDN (CloudFront) for faster global delivery and lower bandwidth costs.\n\n---\n\nCaches responses at edge locations worldwide so users get content from the nearest server.\nThe CDN itself has no monthly fee — you pay per request (~$0.01/10k) and per GB transferred.","default":false,"type":"boolean"},"cachingOptions":{"$ref":"#/definitions/CdnCachingOptions","description":"#### Control how long and what gets cached at the CDN edge.\n\n---\n\nWhen the origin response has no `Cache-Control` header, defaults apply:\n- **Bucket origins**: cached for 6 months (or until invalidated on deploy).\n- **API Gateway / Load Balancer origins**: not cached."},"forwardingOptions":{"$ref":"#/definitions/CdnForwardingOptions","description":"#### Control which headers, cookies, and query params are forwarded to your origin.\n\n---\n\nBy default, all headers/cookies/query params are forwarded. Use this to restrict\nwhat reaches your app (e.g., strip cookies for static content)."},"routeRewrites":{"description":"#### Route specific URL patterns to different origins (e.g., `/api/*` → Lambda, `/assets/*` → S3).\n\n---\n\nEvaluated in order; first match wins. Unmatched requests go to the default origin.\nEach route can have its own caching and forwarding settings.","type":"array","items":{"$ref":"#/definitions/CdnRouteRewrite"}},"customDomains":{"description":"#### Custom domains (e.g., `cdn.example.com`). Stacktape auto-creates DNS records and TLS certificates.\n\n---\n\nYour domain must be added as a Route53 hosted zone in your AWS account first.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"edgeFunctions":{"$ref":"#/definitions/EdgeFunctionsConfig","description":"#### Run edge functions on CDN requests/responses (URL rewrites, auth, A/B testing).\n\n---\n\n- `onRequest`: Before cache lookup — modify the request, add auth, or return early.\n- `onResponse`: Before returning to the client — modify headers, add cookies."},"cloudfrontPriceClass":{"description":"#### Which regions the CDN serves from. Fewer regions = lower cost, but slower for distant users.\n\n---\n\n- **`PriceClass_100`**: North America + Europe. Cheapest option. Good if your users are in the US/EU.\n- **`PriceClass_200`**: Adds Asia, Middle East, Africa.\n- **`PriceClass_All`** (default): All regions worldwide, including South America and Oceania.\n\nThe CDN itself has no monthly base cost - you only pay per request and per GB transferred.\nThe price class controls which edge locations are used, and some regions cost more per request.","default":"PriceClass_All","enum":["PriceClass_100","PriceClass_200","PriceClass_All"],"type":"string"},"defaultRoutePrefix":{"description":"#### Prepend a path prefix to all requests forwarded to the origin.\n\n---\n\nE.g., with prefix `/v2`, a request for `/users` is forwarded to the origin as `/v2/users`.","type":"string"},"errorDocument":{"description":"#### Page to show for 404 errors (e.g., `/error.html`).","default":"/404.html","type":"string"},"indexDocument":{"description":"#### Page served for requests to `/`.","default":"/index.html","type":"string"},"disableInvalidationAfterDeploy":{"description":"#### Skip clearing the CDN cache after each deploy.\n\n---\n\nBy default, all cached content is flushed on every deploy so users see the latest version.\nSet to `true` if you manage cache invalidation yourself or want to keep cached content between deploys.","default":false,"type":"boolean"},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this CDN from common web exploits.","type":"string"}},"additionalProperties":false,"required":["enabled"]},"NetworkLoadBalancer":{"description":"#### TCP/TLS load balancer for non-HTTP traffic (MQTT, game servers, custom protocols).\n\n---\n\nHandles millions of connections with ultra-low latency. Use when you need raw TCP/TLS\ninstead of HTTP routing. Does not support CDN, firewall, or gradual deployments.","type":"object","properties":{"type":{"type":"string","const":"network-load-balancer"},"properties":{"$ref":"#/definitions/NetworkLoadBalancerProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"NetworkLoadBalancerProps":{"type":"object","properties":{"interface":{"description":"#### `internet` (public) or `internal` (VPC-only).","default":"internet","enum":["internal","internet"],"type":"string"},"customDomains":{"description":"#### Custom domains.\n\n---\n\nBy default, Stacktape creates DNS records and TLS certificates for each domain.\nIf you manage DNS yourself, set `disableDnsRecordCreation` and provide `customCertificateArn`.\n\nBackward compatible format `string[]` is still supported.","anyOf":[{"type":"array","items":{"type":"string"}},{"type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}}]},"listeners":{"description":"#### Listeners define which ports and protocols (TCP/TLS) this load balancer accepts traffic on.","type":"array","items":{"$ref":"#/definitions/NetworkLoadBalancerListener"}}},"additionalProperties":false,"required":["listeners"]},"NetworkLoadBalancerListener":{"type":"object","properties":{"protocol":{"description":"#### `TCP` (raw) or `TLS` (encrypted). TLS requires a certificate (auto-created with `customDomains` or via `customCertificateArns`).","enum":["TCP","TLS"],"type":"string"},"port":{"description":"#### Port this listener accepts traffic on.","type":"number"},"customCertificateArns":{"description":"#### ARNs of your own ACM certificates. Not needed if using `customDomains` or TCP protocol.","type":"array","items":{"type":"string"}},"whitelistIps":{"description":"#### Restrict access to specific IP addresses/CIDRs. Default: all IPs allowed.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["port","protocol"]},"HttpApiGateway":{"description":"#### Serverless HTTP API with pay-per-request pricing (~$1/million requests).\n\n---\n\nRoutes HTTP requests to Lambda functions, containers, or other backends.\nNo servers to manage. Includes built-in throttling, CORS, and TLS.","type":"object","properties":{"type":{"type":"string","const":"http-api-gateway"},"properties":{"$ref":"#/definitions/HttpApiGatewayProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"HttpApiGatewayProps":{"type":"object","properties":{"payloadFormat":{"description":"#### Lambda event payload format. `2.0` is simpler and recommended for new projects.\n\n---\n\nOnly used if not overridden at the integration level.","enum":["1.0","2.0"],"type":"string"},"cors":{"$ref":"#/definitions/HttpApiCorsConfig","description":"#### CORS settings. Overrides any CORS headers from your application code."},"logging":{"$ref":"#/definitions/HttpApiAccessLogsConfig","description":"#### Access logging (request ID, IP, method, status, etc.). Viewable with `stacktape logs`."},"customDomains":{"description":"#### Custom domains (e.g., `api.example.com`). Stacktape auto-creates DNS records and TLS certificates.\n\n---\n\nYour domain must be added as a Route53 hosted zone in your AWS account first.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"cdn":{"$ref":"#/definitions/CdnConfiguration","description":"#### Put a CDN (CloudFront) in front of this API for caching and lower latency worldwide."},"alarms":{"description":"#### Alarms for this API Gateway (merged with global alarms from the Stacktape Console).","type":"array","items":{"$ref":"#/definitions/HttpApiGatewayAlarm"}},"disabledGlobalAlarms":{"description":"#### Global alarm names to exclude from this API Gateway.","type":"array","items":{"type":"string"}}},"additionalProperties":false},"HttpApiAccessLogsConfig":{"type":"object","properties":{"disabled":{"description":"#### Disable access logging.","default":false,"type":"boolean"},"format":{"description":"#### Log format. Logs include: requestId, IP, method, status, protocol, responseLength.","default":"JSON","enum":["CLF","CSV","JSON","XML"],"type":"string"},"retentionDays":{"description":"#### How many days to keep logs.","default":30,"enum":[1,120,14,150,180,1827,3,30,365,3653,400,5,545,60,7,731,90],"type":"number"},"logForwarding":{"description":"#### Forward logs to an external service (Datadog, Highlight.io, or any HTTP endpoint).\n\n---\n\nUses Kinesis Data Firehose (~$0.03/GB). Failed deliveries go to a backup S3 bucket.","anyOf":[{"$ref":"#/definitions/HttpEndpointLogForwarding"},{"$ref":"#/definitions/HighlightLogForwarding"},{"$ref":"#/definitions/DatadogLogForwarding"}]}},"additionalProperties":false},"Bucket":{"description":"#### S3 storage bucket for files, images, backups, or any binary data.\n\n---\n\nPay only for what you store and transfer. Highly durable (99.999999999%).","type":"object","properties":{"type":{"type":"string","const":"bucket"},"properties":{"$ref":"#/definitions/BucketProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"BucketProps":{"type":"object","properties":{"directoryUpload":{"$ref":"#/definitions/DirectoryUpload","description":"#### Sync a local directory to this bucket on every deploy.\n\n---\n\n> **Warning:** Replaces all existing bucket contents. Don't use for buckets\n> with user-uploaded or application-generated files."},"accessibility":{"$ref":"#/definitions/BucketAccessibility","description":"#### Who can read/write to this bucket: `private` (default), `public-read`, or `public-read-write`."},"cors":{"$ref":"#/definitions/BucketCorsConfig","description":"#### CORS settings for browser-based access to the bucket."},"versioning":{"description":"#### Keep previous versions of overwritten/deleted objects. Helps recover from mistakes.","type":"boolean"},"encryption":{"description":"#### Encrypt stored objects at rest (AES-256).","type":"boolean"},"lifecycleRules":{"description":"#### Auto-delete or move objects to cheaper storage classes over time.\n\n---\n\nUse to control storage costs: expire old files, archive infrequently accessed data,\nor clean up incomplete uploads.","type":"array","items":{"anyOf":[{"$ref":"#/definitions/Expiration"},{"$ref":"#/definitions/NonCurrentVersionExpiration"},{"$ref":"#/definitions/ClassTransition"},{"$ref":"#/definitions/NonCurrentVersionClassTransition"},{"$ref":"#/definitions/AbortIncompleteMultipartUpload"}]}},"enableEventBusNotifications":{"description":"#### Send events (object created, deleted, etc.) to EventBridge for event-driven workflows.","default":false,"type":"boolean"},"cdn":{"$ref":"#/definitions/BucketCdnConfiguration","description":"#### Put a CDN (CloudFront) in front of this bucket for faster downloads and lower bandwidth costs."}},"additionalProperties":false},"DirectoryUpload":{"type":"object","properties":{"directoryPath":{"description":"#### Path to the local directory to upload (relative to project root).\n\n---\n\nThe bucket will mirror this directory exactly — existing files not in the directory are deleted.","type":"string"},"fileOptions":{"description":"#### Set HTTP headers or tags on files matching specific patterns.","type":"array","items":{"$ref":"#/definitions/DirectoryUploadFilter"}},"excludeFilesPatterns":{"description":"#### Glob patterns for files to skip during upload (relative to `directoryPath`).","type":"array","items":{"type":"string"}},"headersPreset":{"$ref":"#/definitions/SupportedHeaderPreset","description":"#### Preset for HTTP caching headers, optimized for your frontend framework.\n\n---\n\n- **`single-page-app`**: HTML never cached, hashed assets cached forever. For React/Vue/Angular SPAs.\n- **`static-website`**: CDN-cached, never browser-cached. For generic static sites.\n- **`astro-static-website`** / **`sveltekit-static-website`** / **`nuxt-static-website`**: Framework-specific\n  caching (hashed build assets cached forever, HTML always fresh).\n\nOverride individual files with `fileOptions`."},"disableS3TransferAcceleration":{"description":"#### Disable faster uploads via S3 Transfer Acceleration. Saves a small per-GB cost.","default":false,"type":"boolean"}},"additionalProperties":false,"required":["directoryPath"]},"DirectoryUploadFilter":{"type":"object","properties":{"includePattern":{"description":"#### Glob pattern for files this rule applies to (e.g., `*.html`, `assets/**`).","type":"string"},"excludePattern":{"description":"#### Glob pattern for files to exclude even if they match `includePattern`.","type":"string"},"headers":{"description":"#### HTTP headers (e.g., `Cache-Control`) for matching files. Forwarded through CDN to the browser.","type":"array","items":{"$ref":"#/definitions/KeyValuePair"}},"tags":{"description":"#### Tags for matching files. Can be used to target files with `lifecycleRules`.","type":"array","items":{"$ref":"#/definitions/KeyValuePair"}}},"additionalProperties":false,"required":["includePattern"]},"KeyValuePair":{"type":"object","properties":{"key":{"description":"#### Key","type":"string"},"value":{"description":"#### Value","type":"string"}},"additionalProperties":false,"required":["key","value"]},"SupportedHeaderPreset":{"enum":["astro-static-website","gatsby-static-website","nuxt-static-website","single-page-app","static-website","sveltekit-static-website"],"type":"string"},"BucketAccessibility":{"type":"object","properties":{"accessibilityMode":{"description":"#### Configures pre-defined accessibility modes for the bucket.\n\n---\n\nThis allows you to easily configure the most common access patterns.\n\nAvailable modes:\n- `public-read-write`: Everyone can read from and write to the bucket.\n- `public-read`: Everyone can read from the bucket. Only compute resources and entities with sufficient IAM permissions can write to it.\n- `private` (default): Only compute resources and entities with sufficient IAM permissions can read from or write to the bucket.\n\nFor functions, batch jobs, and container workloads, you can grant the required IAM permissions using the `allowsAccessTo` or `iamRoleStatements` properties in their respective configurations.","default":"private","enum":["private","public-read","public-read-write"],"type":"string"},"accessPolicyStatements":{"description":"#### Advanced access configuration that leverages IAM policy statements.\n\n---\n\nThis gives you fine-grained access control over the bucket.","type":"array","items":{"$ref":"#/definitions/BucketPolicyIamRoleStatement"}}},"additionalProperties":false,"required":["accessibilityMode"]},"BucketPolicyIamRoleStatement":{"type":"object","properties":{"Principal":{},"Sid":{"description":"#### Optional identifier for this statement (for readability).","type":"string"},"Effect":{"description":"#### Whether to allow or deny the specified actions.","default":"Allow","type":"string"},"Action":{"description":"#### AWS actions to allow or deny (e.g., `s3:GetObject`, `sqs:SendMessage`).","type":"array","items":{"type":"string"}},"Condition":{"description":"#### Conditions under which this statement applies (e.g., IP restrictions, tag-based access)."},"Resource":{"description":"#### ARNs of the AWS resources this statement applies to. Use `\"*\"` for all resources.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["Principal","Resource"]},"BucketCorsConfig":{"type":"object","properties":{"enabled":{"description":"#### Enable CORS. When `true` with no rules, uses permissive defaults (`*` origins, all methods).","type":"boolean"},"corsRules":{"description":"#### Custom CORS rules. First matching rule wins for each preflight request.","type":"array","items":{"$ref":"#/definitions/BucketCorsRule"}}},"additionalProperties":false,"required":["enabled"]},"BucketCorsRule":{"type":"object","properties":{"allowedOrigins":{"description":"#### Allowed origins (e.g., `https://example.com`). Use `*` for any.","type":"array","items":{"type":"string"}},"allowedHeaders":{"description":"#### Allowed request headers.","type":"array","items":{"type":"string"}},"allowedMethods":{"description":"#### Allowed HTTP methods.","type":"array","items":{"enum":["*","DELETE","GET","HEAD","PATCH","POST","PUT"],"type":"string"}},"exposedResponseHeaders":{"description":"#### Response headers accessible to browser JavaScript.","type":"array","items":{"type":"string"}},"maxAge":{"description":"#### How long (seconds) browsers can cache preflight responses.","type":"number"}},"additionalProperties":false},"Expiration":{"type":"object","properties":{"type":{"type":"string","const":"expiration"},"properties":{"$ref":"#/definitions/ExpirationProps"}},"additionalProperties":false,"required":["properties","type"]},"ExpirationProps":{"type":"object","properties":{"daysAfterUpload":{"description":"#### Delete objects this many days after upload.","type":"number"},"prefix":{"description":"#### Only apply this rule to objects with this key prefix (e.g., `logs/`, `uploads/`).","type":"string"},"tags":{"description":"#### Only apply this rule to objects with these tags.","type":"array","items":{"$ref":"#/definitions/KeyValuePair"}}},"additionalProperties":false,"required":["daysAfterUpload"]},"NonCurrentVersionExpiration":{"type":"object","properties":{"type":{"type":"string","const":"non-current-version-expiration"},"properties":{"$ref":"#/definitions/NonCurrentVersionExpirationProps"}},"additionalProperties":false,"required":["properties","type"]},"NonCurrentVersionExpirationProps":{"type":"object","properties":{"daysAfterVersioned":{"description":"#### Delete old versions this many days after they become non-current. Requires `versioning: true`.","type":"number"},"prefix":{"description":"#### Only apply this rule to objects with this key prefix (e.g., `logs/`, `uploads/`).","type":"string"},"tags":{"description":"#### Only apply this rule to objects with these tags.","type":"array","items":{"$ref":"#/definitions/KeyValuePair"}}},"additionalProperties":false,"required":["daysAfterVersioned"]},"ClassTransition":{"type":"object","properties":{"type":{"type":"string","const":"class-transition"},"properties":{"$ref":"#/definitions/ClassTransitionProps"}},"additionalProperties":false,"required":["properties","type"]},"ClassTransitionProps":{"type":"object","properties":{"daysAfterUpload":{"description":"#### Move objects to a cheaper storage class this many days after upload.","type":"number"},"storageClass":{"description":"#### Target storage class. Cheaper classes have higher retrieval costs/latency.\n\n---\n\n- `STANDARD_IA` / `ONEZONE_IA`: Infrequent access, instant retrieval.\n- `INTELLIGENT_TIERING`: AWS auto-moves between tiers based on access patterns.\n- `GLACIER`: Archive, minutes to hours for retrieval.\n- `DEEP_ARCHIVE`: Cheapest, 12+ hours for retrieval.","enum":["DEEP_ARCHIVE","GLACIER","INTELLIGENT_TIERING","ONEZONE_IA","STANDARD_IA"],"type":"string"},"prefix":{"description":"#### Only apply this rule to objects with this key prefix (e.g., `logs/`, `uploads/`).","type":"string"},"tags":{"description":"#### Only apply this rule to objects with these tags.","type":"array","items":{"$ref":"#/definitions/KeyValuePair"}}},"additionalProperties":false,"required":["daysAfterUpload","storageClass"]},"NonCurrentVersionClassTransition":{"type":"object","properties":{"type":{"type":"string","const":"non-current-version-class-transition"},"properties":{"$ref":"#/definitions/NonCurrentVersionClassTransitionProps"}},"additionalProperties":false,"required":["properties","type"]},"NonCurrentVersionClassTransitionProps":{"type":"object","properties":{"daysAfterVersioned":{"description":"#### Move old versions to a cheaper storage class this many days after becoming non-current.","type":"number"},"storageClass":{"description":"#### Target storage class for non-current versions.","enum":["DEEP_ARCHIVE","GLACIER","INTELLIGENT_TIERING","ONEZONE_IA","STANDARD_IA"],"type":"string"},"prefix":{"description":"#### Only apply this rule to objects with this key prefix (e.g., `logs/`, `uploads/`).","type":"string"},"tags":{"description":"#### Only apply this rule to objects with these tags.","type":"array","items":{"$ref":"#/definitions/KeyValuePair"}}},"additionalProperties":false,"required":["daysAfterVersioned","storageClass"]},"AbortIncompleteMultipartUpload":{"type":"object","properties":{"type":{"type":"string","const":"abort-incomplete-multipart-upload"},"properties":{"$ref":"#/definitions/AbortIncompleteMultipartUploadProps"}},"additionalProperties":false,"required":["properties","type"]},"AbortIncompleteMultipartUploadProps":{"type":"object","properties":{"daysAfterInitiation":{"description":"#### Clean up incomplete multipart uploads after this many days. Prevents storage waste.","type":"number"},"prefix":{"description":"#### Only apply this rule to objects with this key prefix (e.g., `logs/`, `uploads/`).","type":"string"},"tags":{"description":"#### Only apply this rule to objects with these tags.","type":"array","items":{"$ref":"#/definitions/KeyValuePair"}}},"additionalProperties":false,"required":["daysAfterInitiation"]},"BucketCdnConfiguration":{"type":"object","properties":{"rewriteRoutesForSinglePageApp":{"description":"#### Rewrites incoming requests to work for a single-page application.\n\n---\n\nThe routing works as follows:\n- If the path has an extension (e.g., `.css`, `.js`, `.png`), the request is not rewritten, and the appropriate file is returned.\n- If the path does not have an extension, the request is routed to `index.html`.\n\nThis allows single-page applications to handle routing on the client side.","type":"boolean"},"disableUrlNormalization":{"description":"#### Disables URL normalization.\n\n---\n\nURL normalization is enabled by default and is useful for serving HTML files from the bucket with clean URLs.","default":false,"type":"boolean"},"enabled":{"description":"#### Enable CDN (CloudFront) for faster global delivery and lower bandwidth costs.\n\n---\n\nCaches responses at edge locations worldwide so users get content from the nearest server.\nThe CDN itself has no monthly fee — you pay per request (~$0.01/10k) and per GB transferred.","default":false,"type":"boolean"},"cachingOptions":{"$ref":"#/definitions/CdnCachingOptions","description":"#### Control how long and what gets cached at the CDN edge.\n\n---\n\nWhen the origin response has no `Cache-Control` header, defaults apply:\n- **Bucket origins**: cached for 6 months (or until invalidated on deploy).\n- **API Gateway / Load Balancer origins**: not cached."},"forwardingOptions":{"$ref":"#/definitions/CdnForwardingOptions","description":"#### Control which headers, cookies, and query params are forwarded to your origin.\n\n---\n\nBy default, all headers/cookies/query params are forwarded. Use this to restrict\nwhat reaches your app (e.g., strip cookies for static content)."},"routeRewrites":{"description":"#### Route specific URL patterns to different origins (e.g., `/api/*` → Lambda, `/assets/*` → S3).\n\n---\n\nEvaluated in order; first match wins. Unmatched requests go to the default origin.\nEach route can have its own caching and forwarding settings.","type":"array","items":{"$ref":"#/definitions/CdnRouteRewrite"}},"customDomains":{"description":"#### Custom domains (e.g., `cdn.example.com`). Stacktape auto-creates DNS records and TLS certificates.\n\n---\n\nYour domain must be added as a Route53 hosted zone in your AWS account first.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"edgeFunctions":{"$ref":"#/definitions/EdgeFunctionsConfig","description":"#### Run edge functions on CDN requests/responses (URL rewrites, auth, A/B testing).\n\n---\n\n- `onRequest`: Before cache lookup — modify the request, add auth, or return early.\n- `onResponse`: Before returning to the client — modify headers, add cookies."},"cloudfrontPriceClass":{"description":"#### Which regions the CDN serves from. Fewer regions = lower cost, but slower for distant users.\n\n---\n\n- **`PriceClass_100`**: North America + Europe. Cheapest option. Good if your users are in the US/EU.\n- **`PriceClass_200`**: Adds Asia, Middle East, Africa.\n- **`PriceClass_All`** (default): All regions worldwide, including South America and Oceania.\n\nThe CDN itself has no monthly base cost - you only pay per request and per GB transferred.\nThe price class controls which edge locations are used, and some regions cost more per request.","default":"PriceClass_All","enum":["PriceClass_100","PriceClass_200","PriceClass_All"],"type":"string"},"defaultRoutePrefix":{"description":"#### Prepend a path prefix to all requests forwarded to the origin.\n\n---\n\nE.g., with prefix `/v2`, a request for `/users` is forwarded to the origin as `/v2/users`.","type":"string"},"errorDocument":{"description":"#### Page to show for 404 errors (e.g., `/error.html`).","default":"/404.html","type":"string"},"indexDocument":{"description":"#### Page served for requests to `/`.","default":"/index.html","type":"string"},"disableInvalidationAfterDeploy":{"description":"#### Skip clearing the CDN cache after each deploy.\n\n---\n\nBy default, all cached content is flushed on every deploy so users see the latest version.\nSet to `true` if you manage cache invalidation yourself or want to keep cached content between deploys.","default":false,"type":"boolean"},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this CDN from common web exploits.","type":"string"}},"additionalProperties":false,"required":["enabled"]},"UserAuthPool":{"description":"#### A resource for managing user authentication and authorization.\n\n---\n\nA user pool is a fully managed identity provider that handles user sign-up, sign-in, and access control.\nIt provides a secure and scalable way to manage user identities for your applications.","type":"object","properties":{"type":{"type":"string","const":"user-auth-pool"},"properties":{"$ref":"#/definitions/UserAuthPoolProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"UserAuthPoolProps":{"type":"object","properties":{"allowOnlyAdminsToCreateAccount":{"description":"#### Restrict account creation to administrators\n\n---\n\nIf enabled, new users can't sign up themselves. Accounts must be created through an admin flow (for example from an internal admin tool or script),\nwhich helps prevent unwanted self-registrations.\n\nInternally this controls `AdminCreateUserConfig.AllowAdminCreateUserOnly` on the Cognito user pool\n([AWS::Cognito::UserPool](https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-resource-cognito-userpool)).","default":false,"type":"boolean"},"unusedAccountValidityDays":{"description":"#### Expire unused admin-created accounts\n\n---\n\nWhen an admin creates a user account, Cognito issues a temporary password. This setting controls how many days that temporary password\n(and the corresponding account) stays valid if the user never signs in.\n\nInternally this maps to `AdminCreateUserConfig.UnusedAccountValidityDays`.","default":31,"type":"number"},"requireEmailVerification":{"description":"#### (Reserved) Require verified emails\n\n---\n\nPresent for forward compatibility. Stacktape currently derives email / phone verification behavior from `userVerificationType`,\nnot from this flag directly.\n\nTo require email-based verification today, use `userVerificationType: 'email-link' | 'email-code'` instead.","type":"boolean"},"requirePhoneNumberVerification":{"description":"#### (Reserved) Require verified phone numbers\n\n---\n\nPresent for forward compatibility. Stacktape currently derives email / phone verification behavior from `userVerificationType`,\nnot from this flag directly.\n\nTo require SMS-based verification today, use `userVerificationType: 'sms'`.","type":"boolean"},"enableHostedUi":{"description":"#### Enable the Cognito Hosted UI\n\n---\n\nTurns on Cognito's Hosted UI – a pre-built, hosted login and registration page – so you don't have to build your own auth screens.\nThis is useful when you want to get started quickly or keep authentication logic outside of your main app.","default":false,"type":"boolean"},"hostedUiDomainPrefix":{"description":"#### Hosted UI domain prefix\n\n---\n\nSets the first part of your Hosted UI URL: `https://<prefix>.auth.<region>.amazoncognito.com`.\nPick something that matches your project or company name.","type":"string"},"hostedUiCSS":{"description":"#### Custom CSS for the Hosted UI\n\n---\n\nLets you override the default Cognito Hosted UI styling with your own CSS (colors, fonts, layouts, etc.),\nso the login experience matches the rest of your application.\n\nBehind the scenes this is applied using the `AWS::Cognito::UserPoolUICustomizationAttachment` resource.","type":"string"},"hooks":{"$ref":"#/definitions/UserPoolHooks","description":"#### Lambda triggers for the user pool\n\n---\n\nConnects AWS Lambda functions to Cognito \"hooks\" (triggers) such as pre-sign-up, post-confirmation, or token generation.\nYou can use these to enforce additional validation, enrich user profiles, migrate users from another system, and more.\n\nInternally this maps to the Cognito user pool `LambdaConfig`."},"emailConfiguration":{"$ref":"#/definitions/EmailConfiguration","description":"#### Email delivery settings\n\n---\n\nControls how Cognito sends emails (verification messages, password reset codes, admin invitations, etc.).\nYou can either use Cognito's built-in email service or plug in your own SES identity for full control over the sender.\n\nThis config is used to build the Cognito `EmailConfiguration` block\n([AWS docs](https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-resource-cognito-userpool))."},"inviteMessageConfig":{"$ref":"#/definitions/InviteMessageConfig","description":"#### Invite message overrides\n\n---\n\nCustomizes the contents of the \"invitation\" message that users receive when an administrator creates their account\n(for example, when sending a temporary password and sign-in instructions).\n\nIf you want to send custom emails through SES, you must also configure `emailConfiguration.sesAddressArn`."},"userVerificationType":{"$ref":"#/definitions/UserVerificationType","description":"#### Verification strategy\n\n---\n\nChooses how new users prove that they own their contact information:\n\n- `email-link`: Cognito emails a clickable link.\n- `email-code`: Cognito emails a short numeric code.\n- `sms`: Cognito sends a code via SMS to the user's phone number.\n- `none`: Users aren't required to verify email or phone during sign-up.\n\nStacktape uses this value to configure `AutoVerifiedAttributes` and `VerificationMessageTemplate`\non the underlying Cognito user pool."},"userVerificationMessageConfig":{"$ref":"#/definitions/UserVerificationMessageConfig","description":"#### Verification message text\n\n---\n\nLets you customize the exact email and SMS texts that Cognito sends when asking users to verify their email / phone.\nFor example, you can change subjects, body text, or the message that contains the `{####}` verification code."},"mfaConfiguration":{"$ref":"#/definitions/MfaConfiguration","description":"#### Multi-factor authentication\n\n---\n\nControls whether you use Multi‑Factor Authentication (MFA) and which second factors are allowed.\nMFA makes it much harder for attackers to access accounts even if they know a user's password.\n\nUnder the hood this config drives both the `MfaConfiguration` and `EnabledMfas` properties in Cognito\n(see \"MFA configuration\" in the\n[AWS::Cognito::UserPool docs](https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-resource-cognito-userpool))."},"passwordPolicy":{"$ref":"#/definitions/PasswordPolicy","description":"#### Password strength rules\n\n---\n\nDefines how strong user passwords must be – minimum length and whether they must include lowercase, uppercase,\nnumbers, and/or symbols – plus how long temporary passwords issued to new users remain valid.\n\nThis is applied to the Cognito `Policies.PasswordPolicy` block."},"schema":{"description":"#### Custom attributes schema\n\n---\n\nLets you define additional attributes (like `role`, `plan`, `companyId`, etc.) that are stored on each user,\nincluding their data type and validation constraints.\n\nThese translate into the Cognito user pool `Schema` entries\n([schema docs](https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-resource-cognito-userpool)).","type":"array","items":{"$ref":"#/definitions/AttributeSchema"}},"allowPhoneNumberAsUserName":{"description":"#### Allow phone numbers as usernames\n\n---\n\nIf enabled (the default), users can sign in using their phone number in addition to any traditional username.\nTurning this off means phone numbers can still be stored, but can't be used to log in.\n\nThis is implemented via Cognito's `UsernameAttributes` configuration.","default":true,"type":"boolean"},"allowEmailAsUserName":{"description":"#### Allow email addresses as usernames\n\n---\n\nIf enabled (the default), users can sign in using their email address instead of a dedicated username.\nTurning this off means emails can still be stored, but can't be used to log in directly.\n\nThis is also controlled through Cognito `UsernameAttributes`.","default":true,"type":"boolean"},"accessTokenValiditySeconds":{"description":"#### Access token lifetime\n\n---\n\nControls how long an access token issued by Cognito stays valid after login. Shorter lifetimes reduce the window\nin which a stolen token can be abused, at the cost of more frequent refreshes.\n\nThis value is passed to the user pool client as `AccessTokenValidity`.","type":"number"},"idTokenValiditySeconds":{"description":"#### ID token lifetime\n\n---\n\nControls how long an ID token (which contains user profile and claims) is accepted before clients must obtain a new one.\n\nThis is set on the user pool client as `IdTokenValidity`.","type":"number"},"refreshTokenValidityDays":{"description":"#### Refresh token lifetime\n\n---\n\nSets for how many days a refresh token can be used to obtain new access / ID tokens without requiring the user to sign in again.\nLonger lifetimes mean fewer re-authentications, but keep sessions alive for longer.\n\nThis value is used as `RefreshTokenValidity` on the Cognito user pool client.","type":"number"},"allowedOAuthFlows":{"description":"#### OAuth flows\n\n---\n\nSpecifies which OAuth 2.0 flows the user pool client is allowed to use:\n\n- `code`: Authorization Code flow (recommended for web apps and backends).\n- `implicit`: Implicit flow (legacy browser-only flow).\n- `client_credentials`: Server‑to‑server (no end user) machine credentials.\n\nThese values populate `AllowedOAuthFlows` on the Cognito user pool client\n([AWS::Cognito::UserPoolClient](https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-resource-cognito-userpoolclient)).","type":"array","items":{"$ref":"#/definitions/AllowedOauthFlow"}},"allowedOAuthScopes":{"description":"#### OAuth scopes\n\n---\n\nLists which scopes clients can request when using OAuth (for example `email`, `openid`, `profile`).\nScopes control which user information and permissions your app receives in tokens.\n\nThese values are passed to the user pool client as `AllowedOAuthScopes`.","type":"array","items":{"type":"string"}},"callbackURLs":{"description":"#### OAuth callback URLs\n\n---\n\nThe allowed URLs where Cognito is permitted to redirect users after successful authentication.\nThese must exactly match the URLs registered with your frontend / backend, otherwise the redirect will fail.\n\nMapped into `CallbackURLs` and `DefaultRedirectURI` on the user pool client.","type":"array","items":{"type":"string"}},"logoutURLs":{"description":"#### OAuth logout URLs\n\n---\n\nThe URLs Cognito can redirect users to after they log out of the Hosted UI or end their session.\nMust also be explicitly configured so that sign-out redirects don't fail.\n\nThese populate the `LogoutURLs` list on the user pool client.","type":"array","items":{"type":"string"}},"identityProviders":{"description":"#### External identity providers\n\n---\n\nAllows users to sign in with third‑party identity providers like Google, Facebook, Login with Amazon, OIDC, SAML, or Sign in with Apple.\nEach entry configures one external provider (client ID/secret, attribute mapping, requested scopes, and advanced provider‑specific options).\n\nUnder the hood Stacktape creates separate `AWS::Cognito::UserPoolIdentityProvider` resources and registers them\nin the user pool client's `SupportedIdentityProviders`.","type":"array","items":{"$ref":"#/definitions/IdentityProvider"}},"useFirewall":{"description":"#### Associate a WAF\n\n---\n\nLinks the user pool to a `web-app-firewall` resource, so requests to the Hosted UI and token endpoints are inspected\nby AWS WAF rules you configure in Stacktape.\n\nStacktape does this by creating a `WebACLAssociation` between the user pool and the referenced firewall.","type":"string"},"customDomain":{"$ref":"#/definitions/UserPoolCustomDomainConfiguration","description":"#### Custom Domain\n\n---\n\nConfigures a custom domain for the Cognito Hosted UI (e.g., `auth.example.com`).\n\nWhen configured, Cognito creates a CloudFront distribution to serve your custom domain.\nStacktape automatically:\n- Configures the user pool domain with your custom domain and an ACM certificate from us-east-1\n- Creates a DNS record pointing to the CloudFront distribution\n\nThe domain must be registered and verified in your Stacktape account with a valid ACM certificate in us-east-1."},"generateClientSecret":{"description":"#### Generate a client secret\n\n---\n\nAsks Cognito to generate a secret for the user pool client. Use this when you have trusted backends (like APIs or server‑side apps)\nthat can safely store a client secret and use confidential OAuth flows.\n\nThis flag controls the `GenerateSecret` property on the user pool client.","default":false,"type":"boolean"},"allowOnlyExternalIdentityProviders":{"description":"#### Force external identity providers\n\n---\n\nIf `true`, users can't sign in with a username/password against the Cognito user directory at all.\nInstead, they must always use one of the configured external identity providers (Google, SAML, etc.).\n\nInternally this removes `COGNITO` from `SupportedIdentityProviders` on the user pool client.","default":false,"type":"boolean"}},"additionalProperties":false},"UserPoolHooks":{"type":"object","properties":{"customMessage":{"description":"#### Custom message hook\n\nTriggered whenever Cognito is about to send an email or SMS (sign‑up, verification, password reset, etc.).\nLets you fully customize message contents or dynamically choose language/branding.\n\nValue must be the ARN of a Lambda function configured to handle the \"Custom Message\" trigger.","type":"string"},"postAuthentication":{"description":"#### Post-authentication hook\n\nRuns after a user has successfully authenticated. You can use this to record analytics, update last‑login timestamps,\nor block access based on additional checks.","type":"string"},"postConfirmation":{"description":"#### Post-confirmation hook\n\nRuns right after a user confirms their account (for example via email link or admin confirmation).\nThis is often used to create user records in your own database or to provision resources.","type":"string"},"preAuthentication":{"description":"#### Pre-authentication hook\n\nInvoked just before Cognito validates a user's credentials. You can use this to block sign‑in attempts\nbased on IP, device, or user state (for example, soft‑deleting an account).","type":"string"},"preSignUp":{"description":"#### Pre-sign-up hook\n\nCalled before a new user is created. Useful for validating input, auto‑confirming trusted users,\nor blocking sign‑ups that don't meet your business rules.","type":"string"},"preTokenGeneration":{"description":"#### Pre-token-generation hook\n\nRuns right before Cognito issues tokens. Lets you customize token claims (for example, adding roles or flags)\nbased on external systems or additional logic.","type":"string"},"userMigration":{"description":"#### User migration hook\n\nLets you migrate users on‑the‑fly from another user store. When someone tries to sign in but doesn't exist in Cognito,\nthis trigger can look them up elsewhere, import them, and let the sign‑in continue.","type":"string"},"createAuthChallenge":{"description":"#### Create auth challenge hook\n\nPart of Cognito's custom auth flow. This trigger is used to generate a challenge (for example sending a custom OTP)\nafter `DefineAuthChallenge` decides a challenge is needed.","type":"string"},"defineAuthChallenge":{"description":"#### Define auth challenge hook\n\nAlso part of the custom auth flow. It decides whether a user needs another challenge, has passed, or has failed,\nbased on previous challenges and responses.","type":"string"},"verifyAuthChallengeResponse":{"description":"#### Verify auth challenge response hook\n\nValidates the user's response to a custom challenge (for example, checking an OTP the user provides).","type":"string"}},"additionalProperties":false},"EmailConfiguration":{"type":"object","properties":{"sesAddressArn":{"description":"#### SES identity to send emails from\n\n---\n\nARN of an SES verified identity (email address or domain) that Cognito should use when sending emails.\nRequired when you want full control over sending (for example for MFA via `EMAIL_OTP`), because Cognito\nmust switch into `DEVELOPER` email sending mode.","type":"string"},"from":{"description":"#### From address\n\n---\n\nThe email address that appears in the \"From\" field of messages sent by Cognito (if you're using SES).\nThis address must be verified in SES if you're sending through your own identity.","type":"string"},"replyToEmailAddress":{"description":"#### Reply-to address\n\n---\n\nOptional address where replies to Cognito emails should be delivered.\nIf not set, replies go to the `from` address (or the default Cognito sender).","type":"string"}},"additionalProperties":false},"InviteMessageConfig":{"type":"object","properties":{"emailMessage":{"description":"#### Invitation email body\n\n---\n\nThe text of the email sent when an administrator creates a new user.\nYou can reference placeholders like `{username}` and `{####}` (temporary password or code) in the message.","type":"string"},"emailSubject":{"description":"#### Invitation email subject","type":"string"},"smsMessage":{"description":"#### Invitation SMS body\n\n---\n\nThe content of the SMS message sent when new users are created with a phone number.\nAs with email, you can include placeholders such as `{username}` and `{####}`.","type":"string"}},"additionalProperties":false},"UserVerificationType":{"enum":["email-code","email-link","none","sms"],"type":"string"},"UserVerificationMessageConfig":{"type":"object","properties":{"emailMessageUsingCode":{"description":"#### Email body when verifying with a code\n\nUsed when `userVerificationType` is `email-code`. The message typically contains a `{####}` placeholder\nthat Cognito replaces with a one‑time verification code.","type":"string"},"emailMessageUsingLink":{"description":"#### Email body when verifying with a link\n\nUsed when `userVerificationType` is `email-link`. Cognito replaces special markers like `{##verify your email##}`\nwith a clickable URL.","type":"string"},"emailSubjectUsingCode":{"description":"#### Email subject when verifying with a code","type":"string"},"emailSubjectUsingLink":{"description":"#### Email subject when verifying with a link","type":"string"},"smsMessage":{"description":"#### SMS verification message\n\n---\n\nText of the SMS Cognito sends when verifying a phone number (for example containing `{####}`).","type":"string"}},"additionalProperties":false},"MfaConfiguration":{"type":"object","properties":{"status":{"description":"#### MFA requirement\n\n- `OFF`: MFA is completely disabled.\n- `ON`: All users must complete MFA during sign‑in.\n- `OPTIONAL`: Users can opt in to MFA; it's recommended but not strictly required.\n\nThis value configures the Cognito `MfaConfiguration` property.","enum":["OFF","ON","OPTIONAL"],"type":"string"},"enabledTypes":{"description":"#### Enabled MFA factor types\n\n---\n\nChooses which MFA methods users can use:\n\n- `SMS`: One‑time codes are sent via text message. Requires an SNS role so Cognito can send SMS.\n- `SOFTWARE_TOKEN`: Time‑based one‑time codes from an authenticator app.\n- `EMAIL_OTP`: Codes are sent by email. AWS requires that you configure a developer email sending identity\n  (which Stacktape does when you provide `emailConfiguration.sesAddressArn`).\n\nThese values are mapped to Cognito's `EnabledMfas` setting (`SMS_MFA`, `SOFTWARE_TOKEN_MFA`, `EMAIL_OTP`),\nwhose behavior is described in\n[EnabledMfas in the AWS::Cognito::UserPool docs](https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-resource-cognito-userpool).","type":"array","items":{"enum":["EMAIL_OTP","SMS","SOFTWARE_TOKEN"],"type":"string"}}},"additionalProperties":false},"PasswordPolicy":{"type":"object","properties":{"minimumLength":{"description":"#### Minimum password length\n\nThe fewest characters a password can have. Longer passwords are generally more secure.","type":"number"},"requireLowercase":{"description":"#### Require at least one lowercase letter","type":"boolean"},"requireNumbers":{"description":"#### Require at least one number","type":"boolean"},"requireSymbols":{"description":"#### Require at least one symbol\n\nSymbols are non‑alphanumeric characters such as `!`, `@`, or `#`.","type":"boolean"},"requireUppercase":{"description":"#### Require at least one uppercase letter","type":"boolean"},"temporaryPasswordValidityDays":{"description":"#### Temporary password validity (days)\n\nHow long a temporary password issued to a new user is valid before it must be changed on first sign‑in.","type":"number"}},"additionalProperties":false},"AttributeSchema":{"type":"object","properties":{"name":{"description":"#### Attribute name\n\nThe logical name of the attribute as it appears on the user (for example `given_name`, `plan`, or `tenantId`).","type":"string"},"attributeDataType":{"description":"#### Attribute data type\n\nThe value type stored for this attribute (`String`, `Number`, etc.).\nThis is passed to Cognito's `AttributeDataType`.","type":"string"},"developerOnlyAttribute":{"description":"#### Developer-only attribute\n\nIf true, the attribute is only readable/writable by privileged backend code and not exposed to end users directly.","type":"boolean"},"mutable":{"description":"#### Mutable after sign-up\n\nControls whether the attribute can be changed after it has been initially set.","type":"boolean"},"required":{"description":"#### Required at sign-up\n\nIf true, users must supply this attribute when creating an account.","type":"boolean"},"numberMaxValue":{"description":"#### Maximum numeric value","type":"number"},"numberMinValue":{"description":"#### Minimum numeric value","type":"number"},"stringMaxLength":{"description":"#### Maximum string length","type":"number"},"stringMinLength":{"description":"#### Minimum string length","type":"number"}},"additionalProperties":false},"AllowedOauthFlow":{"enum":["client_credentials","code","implicit"],"type":"string"},"IdentityProvider":{"type":"object","properties":{"type":{"description":"#### Provider type\n\n---\n\nThe kind of external identity provider you want to integrate:\n\n- `Facebook`, `Google`, `LoginWithAmazon`, `SignInWithApple`: social identity providers.\n- `OIDC`: a generic OpenID Connect provider.\n- `SAML`: a SAML 2.0 identity provider (often used for enterprise SSO).","enum":["Facebook","Google","LoginWithAmazon","OIDC","SAML","SignInWithApple"],"type":"string"},"clientId":{"description":"#### OAuth / OIDC client ID\n\n---\n\nThe client ID (sometimes called app ID) that you obtained from the external provider's console.\nCognito presents this ID when redirecting users to the provider.","type":"string"},"clientSecret":{"description":"#### OAuth / OIDC client secret\n\n---\n\nThe client secret associated with the `clientId`, used by Cognito when exchanging authorization codes for tokens.\nThis value should be kept confidential and only configured from secure sources.","type":"string"},"attributeMapping":{"description":"#### Attribute mapping\n\n---\n\nMaps attributes from the external provider (for example `email`, `given_name`) to Cognito user pool attributes.\nKeys are Cognito attribute names, values are attribute names from the identity provider.\n\nIf not provided, Stacktape defaults to mapping `email -> email`.","type":"object","additionalProperties":{"type":"string"}},"authorizeScopes":{"description":"#### Requested scopes\n\n---\n\nAdditional OAuth scopes to request from the identity provider (for example `openid`, `email`, `profile`).\nThese control which pieces of user information and permissions your app receives in the provider's tokens.\n\nIf omitted, Stacktape uses a reasonable default per provider (see\n[AWS::Cognito::UserPoolIdentityProvider](https://docs.aws.amazon.com/AWSCloudFormation/latest/TemplateReference/aws-resource-cognito-userpoolidentityprovider)).","type":"array","items":{"type":"string"}},"providerDetails":{"$ref":"#/definitions/Record<string,any>","description":"#### Advanced provider options\n\n---\n\nLow‑level configuration passed directly into Cognito's `ProviderDetails` map.\nYou can use this to override endpoints or supply provider‑specific keys as documented by AWS,\nfor example `authorize_url`, `token_url`, `attributes_request_method`, `oidc_issuer`, and others.\n\nIn most cases you don't need to set this – Stacktape configures sensible defaults for common providers."}},"additionalProperties":false,"required":["clientId","clientSecret","type"]},"Record<string,any>":{"type":"object","additionalProperties":false},"UserPoolCustomDomainConfiguration":{"type":"object","properties":{"domainName":{"description":"#### Domain Name\n\n---\n\nFully qualified domain name for the Cognito Hosted UI (e.g., `auth.example.com`).","type":"string"},"customCertificateArn":{"description":"#### Custom Certificate ARN\n\n---\n\nARN of an ACM certificate in **us-east-1** to use for this domain.\nBy default, Stacktape uses the certificate associated with your domain in us-east-1.\n\nThe certificate must be in us-east-1 because Cognito uses CloudFront for custom domains.","type":"string"},"disableDnsRecordCreation":{"description":"#### Disable DNS Record Creation\n\n---\n\nIf `true`, Stacktape will not create a DNS record for this domain.","default":false,"type":"boolean"}},"additionalProperties":false,"required":["domainName"]},"EventBus":{"description":"#### Central event bus for decoupling services. Publish events and trigger functions, queues, or batch jobs.\n\n---\n\nUse to build event-driven architectures where producers and consumers are independent.\nFunctions, batch jobs, and other resources can subscribe to specific event patterns.","type":"object","properties":{"type":{"type":"string","const":"event-bus"},"properties":{"$ref":"#/definitions/EventBusProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"EventBusProps":{"type":"object","properties":{"eventSourceName":{"description":"#### Partner event source name. Only needed for receiving events from third-party SaaS integrations.","type":"string"},"archivation":{"$ref":"#/definitions/EventBusArchivation","description":"#### Archive events to store and replay them later. Useful for debugging, testing, or error recovery."}},"additionalProperties":false},"EventBusArchivation":{"type":"object","properties":{"enabled":{"description":"#### Enable event archiving. Disabling deletes the archive.","default":false,"type":"boolean"},"retentionDays":{"description":"#### Days to keep archived events. Omit to keep indefinitely.","type":"number"}},"additionalProperties":false,"required":["enabled"]},"Bastion":{"description":"#### Secure jump box for accessing private resources (databases, Redis, OpenSearch) in your VPC.\n\n---\n\nUses keyless SSH via AWS Systems Manager — no SSH keys to manage. Connect with `stacktape bastion:ssh`\nor create port-forwarding tunnels with `stacktape bastion:tunnel`. Costs ~$4/month (t3.micro).","type":"object","properties":{"type":{"type":"string","const":"bastion"},"properties":{"$ref":"#/definitions/BastionProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"BastionProps":{"type":"object","properties":{"instanceSize":{"description":"#### EC2 instance type. `t3.micro` is sufficient for SSH tunneling and basic admin tasks.","default":"t3.micro","type":"string"},"runCommandsAtLaunch":{"description":"#### Shell commands to run when the instance starts (as root — no `sudo` needed).\n\n---\n\nUse to install CLI tools, database clients, or other dependencies.\n**Warning:** changing this list after creation replaces the instance — any data on the old instance is lost.","type":"array","items":{"type":"string"}},"logging":{"$ref":"#/definitions/BastionLoggingConfig","description":"#### Log retention settings for system, security, and audit logs. Logs are sent to CloudWatch."}},"additionalProperties":false},"BastionLoggingConfig":{"type":"object","properties":{"messages":{"$ref":"#/definitions/BastionLogging","description":"#### System messages (`/var/log/messages`) — startup info, kernel messages, service logs.","default":"retentionDays: 30"},"secure":{"$ref":"#/definitions/BastionLogging","description":"#### Auth logs (`/var/log/secure`) — SSH login attempts, authentication events.","default":"retentionDays: 180"},"audit":{"$ref":"#/definitions/BastionLogging","description":"#### Audit logs (`/var/log/audit/audit.log`) — detailed security events from the Linux audit system.","default":"retentionDays: 365"}},"additionalProperties":false},"BastionLogging":{"type":"object","properties":{"disabled":{"description":"#### Disable this log type. Stops sending to CloudWatch.","default":false,"type":"boolean"},"retentionDays":{"description":"#### Days to keep logs in CloudWatch before automatic deletion.","enum":[1,120,14,150,180,1827,3,30,365,3653,400,5,545,60,7,731,90],"type":"number"},"logForwarding":{"description":"#### Forward logs to an external service (Datadog, Highlight.io, or any HTTP endpoint).\n\n---\n\nUses Kinesis Data Firehose (~$0.03/GB). Failed deliveries go to a backup S3 bucket.","anyOf":[{"$ref":"#/definitions/HttpEndpointLogForwarding"},{"$ref":"#/definitions/HighlightLogForwarding"},{"$ref":"#/definitions/DatadogLogForwarding"}]}},"additionalProperties":false},"DynamoDbTable":{"description":"#### Serverless NoSQL database with single-digit millisecond reads/writes at any scale.\n\n---\n\nNo servers to manage, no capacity planning needed (in on-demand mode). Pay per read/write.\nGreat for user profiles, session data, IoT data, and any key-value or document workload.","type":"object","properties":{"type":{"type":"string","const":"dynamo-db-table"},"properties":{"$ref":"#/definitions/DynamoDbTableProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"DynamoDbTableProps":{"type":"object","properties":{"primaryKey":{"$ref":"#/definitions/DynamoDbTablePrimaryKey","description":"#### The primary key that uniquely identifies each item.\n\n---\n\n- **Simple key**: Just a `partitionKey` (e.g., `userId`).\n- **Composite key**: `partitionKey` + `sortKey` (e.g., `userId` + `createdAt`).\n\n> **Cannot be changed after creation.** Every item must include the primary key attribute(s)."},"provisionedThroughput":{"$ref":"#/definitions/DynamoDbProvisionedThroughput","description":"#### Fixed-capacity mode with predictable pricing. Omit for on-demand (pay-per-request) mode.\n\n---\n\n- **On-demand** (default, no config): Pay per read/write. Best for unpredictable or variable traffic.\n- **Provisioned**: Set fixed read/write capacity. Cheaper at steady, predictable load. Can auto-scale."},"enablePointInTimeRecovery":{"description":"#### Enable continuous backups with point-in-time recovery (restore to any second in the last 35 days).\n\n---\n\nRestores always create a new table. Adds ~20% to storage cost.","type":"boolean"},"streamType":{"description":"#### Stream item changes to trigger functions or batch jobs in real time.\n\n---\n\n- `KEYS_ONLY`: Only key attributes of the changed item.\n- `NEW_IMAGE`: The full item after the change.\n- `OLD_IMAGE`: The full item before the change.\n- `NEW_AND_OLD_IMAGES`: Both before and after — useful for change tracking and auditing.","enum":["KEYS_ONLY","NEW_AND_OLD_IMAGES","NEW_IMAGE","OLD_IMAGE"],"type":"string"},"secondaryIndexes":{"description":"#### Additional indexes for querying by attributes other than the primary key.\n\n---\n\nWithout indexes, you can only query by primary key. Add a secondary index to query by\nany attribute (e.g., query orders by `status` or users by `email`).","type":"array","items":{"$ref":"#/definitions/DynamoDbTableGlobalSecondaryIndex"}},"dev":{"$ref":"#/definitions/DevModeConfig","description":"#### Dev mode: runs locally in Docker by default. Set `remote: true` to use the deployed table."}},"additionalProperties":false,"required":["primaryKey"]},"DynamoDbTablePrimaryKey":{"type":"object","properties":{"partitionKey":{"$ref":"#/definitions/DynamoDbAttribute","description":"#### The main key attribute (e.g., `userId`, `orderId`). Must be unique if no sort key is used."},"sortKey":{"$ref":"#/definitions/DynamoDbAttribute","description":"#### Optional second key for composite keys. Enables range queries and multiple items per partition key.\n\n---\n\nE.g., partition key `userId` + sort key `createdAt` lets you query all items for a user sorted by date."}},"additionalProperties":false,"required":["partitionKey"]},"DynamoDbAttribute":{"type":"object","properties":{"name":{"description":"#### Attribute name (e.g., `userId`, `email`, `createdAt`).","type":"string"},"type":{"description":"#### Attribute data type: `string`, `number`, or `binary`.","enum":["binary","number","string"],"type":"string"}},"additionalProperties":false,"required":["name","type"]},"DynamoDbProvisionedThroughput":{"type":"object","properties":{"readUnits":{"description":"#### Read capacity units per second. 1 unit = one 4 KB strongly consistent read (or two eventually consistent).\n\n---\n\nRequests exceeding this limit get throttled. Use `readScaling` to auto-adjust.","type":"number"},"writeUnits":{"description":"#### Write capacity units per second. 1 unit = one 1 KB write.\n\n---\n\nRequests exceeding this limit get throttled. Use `writeScaling` to auto-adjust.","type":"number"},"writeScaling":{"$ref":"#/definitions/DynamoDbWriteScaling","description":"#### Auto-scale write capacity based on actual usage. Scales up/down between min and max units."},"readScaling":{"$ref":"#/definitions/DynamoDbReadScaling","description":"#### Auto-scale read capacity based on actual usage. Scales up/down between min and max units."}},"additionalProperties":false,"required":["readUnits","writeUnits"]},"DynamoDbWriteScaling":{"type":"object","properties":{"minUnits":{"description":"#### Minimum write units. Capacity never scales below this.","type":"number"},"maxUnits":{"description":"#### Maximum write units. Capacity never scales above this.","type":"number"},"keepUtilizationUnder":{"description":"#### Target utilization percentage (e.g., 70). Scales up when usage exceeds this, down when it drops.","type":"number"}},"additionalProperties":false,"required":["keepUtilizationUnder","maxUnits","minUnits"]},"DynamoDbReadScaling":{"type":"object","properties":{"minUnits":{"description":"#### Minimum read units. Capacity never scales below this.","type":"number"},"maxUnits":{"description":"#### Maximum read units. Capacity never scales above this.","type":"number"},"keepUtilizationUnder":{"description":"#### Target utilization percentage (e.g., 70). Scales up when usage exceeds this, down when it drops.","type":"number"}},"additionalProperties":false,"required":["keepUtilizationUnder","maxUnits","minUnits"]},"DynamoDbTableGlobalSecondaryIndex":{"type":"object","properties":{"name":{"description":"#### Name of the index (used when querying).","type":"string"},"partitionKey":{"$ref":"#/definitions/DynamoDbAttribute","description":"#### Partition key for this index — the attribute you'll query by."},"sortKey":{"$ref":"#/definitions/DynamoDbAttribute","description":"#### Optional sort key for range queries within a partition."},"projections":{"description":"#### Extra attributes to copy into the index. Only projected attributes are available when querying.\n\n---\n\nThe table's primary key is always projected. List additional attributes you need in query results.","type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["name","partitionKey"]},"StateMachine":{"description":"#### Visual workflow engine for orchestrating Lambda functions, API calls, and other AWS services.\n\n---\n\nDefine multi-step workflows with branching, retries, parallel execution, and error handling —\nall without writing orchestration code. Pay per state transition (~$0.025/1,000 transitions).\nDefined using [Amazon States Language (ASL)](https://states-language.net/spec.html).","type":"object","properties":{"type":{"type":"string","const":"state-machine"},"properties":{"$ref":"#/definitions/StateMachineProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"StateMachineProps":{"type":"object","properties":{"definition":{"$ref":"#/definitions/StateMachineDefinition","description":"#### The workflow definition in [Amazon States Language (ASL)](https://states-language.net/spec.html)."}},"additionalProperties":false,"required":["definition"]},"StateMachineDefinition":{"type":"object","properties":{"Comment":{"description":"#### A human-readable description of the state machine.","type":"string"},"StartAt":{"description":"#### The name of the state to start the execution at.","type":"string"},"States":{"description":"#### An object containing the states of the state machine.","type":"object","additionalProperties":{"$ref":"#/definitions/State"}},"Version":{"description":"#### The version of the Amazon States Language.","type":"string"},"TimeoutSeconds":{"description":"#### The maximum time, in seconds, that a state machine can run.","type":"number"}},"additionalProperties":false,"required":["StartAt","States"]},"State":{"anyOf":[{"$ref":"#/definitions/Choice"},{"$ref":"#/definitions/Fail"},{"$ref":"#/definitions/StateMachineMap"},{"$ref":"#/definitions/Parallel"},{"$ref":"#/definitions/Pass"},{"$ref":"#/definitions/Succeed"},{"$ref":"#/definitions/Task"},{"$ref":"#/definitions/Wait"}]},"Choice":{"type":"object","properties":{"Type":{"type":"string"},"Next":{"type":"string"},"End":{"type":"boolean","const":true},"Comment":{"type":"string"},"OutputPath":{"type":"string"},"InputPath":{"type":"string"},"Choices":{"type":"array","items":{"$ref":"#/definitions/Operator"}},"Default":{"type":"string"}},"additionalProperties":false,"required":["Choices","Type"]},"Operator":{"type":"object","additionalProperties":{},"properties":{"Variable":{"type":"string"},"Next":{"type":"string"},"And":{"type":"array","items":{"$ref":"#/definitions/Operator"}},"Or":{"type":"array","items":{"$ref":"#/definitions/Operator"}},"Not":{"$ref":"#/definitions/Operator"},"BooleanEquals":{"type":"boolean"},"NumericEquals":{"type":"number"},"NumericGreaterThan":{"type":"number"},"NumericGreaterThanEquals":{"type":"number"},"NumericLessThan":{"type":"number"},"NumericLessThanEquals":{"type":"number"},"StringEquals":{"type":"string"},"StringGreaterThan":{"type":"string"},"StringGreaterThanEquals":{"type":"string"},"StringLessThan":{"type":"string"},"StringLessThanEquals":{"type":"string"},"TimestampEquals":{"type":"string"},"TimestampGreaterThan":{"type":"string"},"TimestampGreaterThanEquals":{"type":"string"},"TimestampLessThan":{"type":"string"},"TimestampLessThanEquals":{"type":"string"}}},"Fail":{"type":"object","properties":{"Type":{"type":"string"},"Comment":{"type":"string"},"OutputPath":{"type":"string"},"InputPath":{"type":"string"},"Cause":{"type":"string"},"Error":{"type":"string"}},"additionalProperties":false,"required":["Type"]},"StateMachineMap":{"type":"object","properties":{"Type":{"type":"string"},"Next":{"type":"string"},"End":{"type":"boolean","const":true},"Comment":{"type":"string"},"OutputPath":{"type":"string"},"InputPath":{"type":"string"},"ResultPath":{"type":"string"},"ItemsPath":{"type":"string"},"MaxConcurrency":{"type":"number"},"Iterator":{"$ref":"#/definitions/StpStateMachine"},"Parameters":{"type":"object","additionalProperties":{}},"Retry":{"type":"array","items":{"type":"object","additionalProperties":{},"properties":{"ErrorEquals":{"type":"array","items":{"type":"string"}},"IntervalSeconds":{"type":"number"},"MaxAttempts":{"type":"number"},"BackoffRate":{"type":"number"}},"required":["ErrorEquals"]}},"Catch":{"type":"array","items":{"type":"object","additionalProperties":{},"properties":{"ErrorEquals":{"type":"array","items":{"type":"string"}},"Next":{"type":"string"}},"required":["ErrorEquals","Next"]}}},"additionalProperties":false,"required":["Iterator","Type"]},"StpStateMachine":{"additionalProperties":false,"type":"object","properties":{"name":{"type":"string"},"type":{"type":"string","const":"state-machine"},"configParentResourceType":{"type":"string","const":"state-machine"},"nameChain":{"type":"array","items":{"type":"string"}}},"required":["configParentResourceType","name","nameChain","type"]},"Parallel":{"type":"object","properties":{"Type":{"type":"string"},"Next":{"type":"string"},"End":{"type":"boolean","const":true},"Comment":{"type":"string"},"OutputPath":{"type":"string"},"InputPath":{"type":"string"},"ResultPath":{"type":"string"},"Branches":{"type":"array","items":{"$ref":"#/definitions/StpStateMachine"}},"Retry":{"type":"array","items":{"type":"object","additionalProperties":{},"properties":{"ErrorEquals":{"type":"array","items":{"type":"string"}},"IntervalSeconds":{"type":"number"},"MaxAttempts":{"type":"number"},"BackoffRate":{"type":"number"}},"required":["ErrorEquals"]}},"Catch":{"type":"array","items":{"type":"object","additionalProperties":{},"properties":{"ErrorEquals":{"type":"array","items":{"type":"string"}},"Next":{"type":"string"}},"required":["ErrorEquals","Next"]}}},"additionalProperties":false,"required":["Branches","Type"]},"Pass":{"type":"object","properties":{"Type":{"type":"string"},"Next":{"type":"string"},"End":{"type":"boolean","const":true},"Comment":{"type":"string"},"OutputPath":{"type":"string"},"InputPath":{"type":"string"},"ResultPath":{"type":"string"},"Parameters":{"type":"object","additionalProperties":{}},"Result":{}},"additionalProperties":false,"required":["Type"]},"Succeed":{"type":"object","properties":{"Type":{"type":"string"},"Comment":{"type":"string"}},"additionalProperties":false,"required":["Type"]},"Task":{"type":"object","properties":{"Type":{"type":"string"},"Next":{"type":"string"},"End":{"type":"boolean","const":true},"Comment":{"type":"string"},"OutputPath":{"type":"string"},"InputPath":{"type":"string"},"Resource":{"anyOf":[{"type":"object","additionalProperties":{}},{"type":"string"}]},"ResultPath":{"type":"string"},"Retry":{"type":"array","items":{"type":"object","additionalProperties":{},"properties":{"ErrorEquals":{"type":"array","items":{"type":"string"}},"IntervalSeconds":{"type":"number"},"MaxAttempts":{"type":"number"},"BackoffRate":{"type":"number"}},"required":["ErrorEquals"]}},"Catch":{"type":"array","items":{"type":"object","additionalProperties":{},"properties":{"ErrorEquals":{"type":"array","items":{"type":"string"}},"Next":{"type":"string"}},"required":["ErrorEquals","Next"]}},"TimeoutSeconds":{"type":"number"},"HeartbeatSeconds":{"type":"number"},"Parameters":{"type":"object","additionalProperties":{}}},"additionalProperties":false,"required":["Resource","Type"]},"Wait":{"type":"object","properties":{"Type":{"type":"string"},"Next":{"type":"string"},"End":{"type":"boolean","const":true},"Comment":{"type":"string"},"OutputPath":{"type":"string"},"InputPath":{"type":"string"},"Seconds":{"type":"number"},"Timestamp":{"type":"string"},"SecondsPath":{"type":"string"},"TimestampPath":{"type":"string"}},"additionalProperties":false,"required":["Type"]},"MongoDbAtlasCluster":{"description":"#### Managed MongoDB database (Atlas) deployed into your AWS account and managed within your stack.\n\n---\n\nDocument database with flexible schemas — great for content management, user profiles, catalogs, and apps\nwhere your data model evolves. Starts at M2 (shared, ~$9/month) or M10 (dedicated, ~$57/month).","type":"object","properties":{"type":{"type":"string","const":"mongo-db-atlas-cluster"},"properties":{"$ref":"#/definitions/MongoDbAtlasClusterProps"}},"additionalProperties":false,"required":["properties","type"]},"MongoDbAtlasClusterProps":{"type":"object","properties":{"diskSizeGB":{"description":"#### Disk size in GB. Not available for shared tiers (M2/M5). M10+ auto-scales storage by default.","type":"number"},"clusterTier":{"description":"#### Instance size. M2/M5 = shared (cheapest). M10+ = dedicated (more features, auto-scaling, backups).","enum":["M10","M100","M140","M2","M20","M200","M200 Low-CPU (R200)","M200_NVME","M30","M300","M300 Low-CPU (R300)","M40","M40 Low-CPU (R40)","M400","M400 Low-CPU (R400)","M400_NVME","M40_NVME","M5","M50","M50 Low-CPU (R50)","M50_NVME","M60","M60 Low-CPU (R60)","M60_NVME","M700","M700 Low-CPU (R700)","M80","M80 Low-CPU (R80)","M80_NVME"],"type":"string"},"version":{"description":"#### MongoDB engine version.","default":"7.0","enum":["5.0","6.0","7.0"],"type":"string"},"numShards":{"description":"#### Number of shards. More than 1 enables sharded mode for horizontal scaling. Requires M30+.","default":1,"type":"number"},"replication":{"$ref":"#/definitions/MongoDbReplication","description":"#### Node count configuration: electable, read-only, and analytics nodes. Default: 3 electable nodes."},"enableBackups":{"description":"#### Enable daily snapshots (18:00 UTC). M10+ only — M2/M5 get automatic snapshots with different rules.","type":"boolean"},"enablePointInTimeRecovery":{"description":"#### Restore to any second within the last 7 days. Requires `enableBackups: true` and M10+.","type":"boolean"},"biConnector":{"$ref":"#/definitions/MongoDbBiConnector","description":"#### BI Connector for SQL-based access to MongoDB data. CPU-intensive — may degrade M10/M20 performance."},"autoScaling":{"$ref":"#/definitions/MongoDbAutoScaling","description":"#### Auto-scale tier and/or storage based on CPU/memory usage. Set min/max tier to control costs.\n\n---\n\nScales up when CPU or memory exceeds 75% for 1 hour. Scales down when both are below 50% for 24 hours."},"adminUserCredentials":{"$ref":"#/definitions/MongoDbAdminUserCredentials","description":"#### Admin user for direct database access (e.g., from your local machine or admin tools).\n\n---\n\nNot required for app-to-database access via `connectTo` — that's handled automatically."}},"additionalProperties":false,"required":["clusterTier"]},"MongoDbReplication":{"type":"object","properties":{"numAnalyticsNodes":{"description":"#### Read-only nodes for long-running analytics queries. Prevents impact on primary workload performance.","type":"number"},"numElectableNodes":{"description":"#### Nodes that can become primary. More = better redundancy. Must be odd.","default":3,"enum":[3,5,7],"type":"number"},"numReadOnlyNodes":{"description":"#### Read-only replica nodes for scaling read throughput.","type":"number"}},"additionalProperties":false},"MongoDbBiConnector":{"type":"object","properties":{"readPreference":{"description":"#### Which node type the BI Connector reads from. Use `analytics` to avoid impacting production queries.","enum":["analytics","primary","secondary"],"type":"string"},"enabled":{"description":"#### Enable the BI Connector for SQL-based access.","default":false,"type":"boolean"}},"additionalProperties":false,"required":["enabled"]},"MongoDbAutoScaling":{"type":"object","properties":{"minClusterTier":{"description":"#### Lowest tier the cluster can scale down to. Prevents unexpected cost increases from always scaling up.","enum":["M10","M100","M140","M20","M200","M200 Low-CPU (R200)","M200_NVME","M30","M300","M300 Low-CPU (R300)","M40","M40 Low-CPU (R40)","M400 Low-CPU (R400)","M400_NVME","M40_NVME","M50","M50 Low-CPU (R50)","M50_NVME","M60","M60 Low-CPU (R60)","M60_NVME","M700 Low-CPU (R700)","M80","M80 Low-CPU (R80)","M80_NVME"],"type":"string"},"maxClusterTier":{"description":"#### Highest tier the cluster can scale up to. Set a ceiling to control maximum costs.","enum":["M10","M100","M140","M20","M200","M200 Low-CPU (R200)","M200_NVME","M30","M300","M300 Low-CPU (R300)","M40","M40 Low-CPU (R40)","M400 Low-CPU (R400)","M400_NVME","M40_NVME","M50","M50 Low-CPU (R50)","M50_NVME","M60","M60 Low-CPU (R60)","M60_NVME","M700 Low-CPU (R700)","M80","M80 Low-CPU (R80)","M80_NVME"],"type":"string"},"disableDiskScaling":{"description":"#### Prevent automatic disk expansion. By default, storage grows when usage hits 90%. Storage never scales down.","type":"boolean"},"disableScaleDown":{"description":"#### Prevent automatic scale-down. The cluster can only scale up, never back down to a smaller tier.","type":"boolean"}},"additionalProperties":false},"MongoDbAdminUserCredentials":{"type":"object","properties":{"userName":{"description":"#### Name of the admin user","type":"string"},"password":{"description":"#### Password for the admin user","type":"string"}},"additionalProperties":false,"required":["password","userName"]},"RedisCluster":{"description":"#### In-memory data store for caching, sessions, queues, and real-time data. Sub-millisecond latency.","type":"object","properties":{"type":{"type":"string","const":"redis-cluster"},"properties":{"$ref":"#/definitions/RedisClusterProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"RedisClusterProps":{"type":"object","properties":{"enableSharding":{"description":"#### Split data across multiple shards for horizontal scaling.\n\n---\n\nEach shard has its own primary + replicas. Routing is automatic.\n\n> **Must be set at creation time** — can't be added later.\n> Requires `numReplicaNodes >= 1`. Replica count can't be changed after creation.","type":"boolean"},"numShards":{"description":"#### Number of shards (only with `enableSharding: true`).","default":1,"type":"number"},"numReplicaNodes":{"description":"#### Read replicas per shard. Increases read throughput and availability.\n\n---\n\nIf the primary fails and `enableAutomaticFailover` is on, a replica takes over.\nCan't be changed after creation for sharded clusters.","default":0,"type":"number"},"enableAutomaticFailover":{"description":"#### Auto-promote a replica to primary if the primary node fails.\n\n---\n\nRequires `numReplicaNodes >= 1`. Always enabled for sharded clusters.\n\n> Deploy replicas first, then enable failover in a separate deployment.","type":"boolean"},"instanceSize":{"description":"#### The size of each Redis node. Affects memory, performance, and cost.\n\n---\n\n**Quick guide:**\n- **`cache.t4g.micro`** (~$0.016/hr, 0.5 GB): Development, testing, low-traffic apps.\n- **`cache.t4g.small`** (~$0.032/hr, 1.37 GB): Small production apps, session stores.\n- **`cache.m7g.large`** (~$0.15/hr, 6.38 GB): Production workloads with moderate data.\n- **`cache.r7g.large`** (~$0.20/hr, 13.07 GB): Large datasets, memory-heavy caching.\n\n**Families:** `t` = burstable (cheap, variable). `m` = general purpose. `r` = memory-optimized.\nSuffix `g` = ARM/Graviton (better price-performance).\n\nThis size applies to every node (primary + replicas). You can change it later without data loss.","enum":["cache.m4.10xlarge","cache.m4.2xlarge","cache.m4.4xlarge","cache.m4.large","cache.m4.xlarge","cache.m5.12xlarge","cache.m5.24xlarge","cache.m5.2xlarge","cache.m5.4xlarge","cache.m5.large","cache.m5.xlarge","cache.m6g.12xlarge","cache.m6g.16xlarge","cache.m6g.2xlarge","cache.m6g.4xlarge","cache.m6g.8xlarge","cache.m6g.large","cache.m6g.xlarge","cache.m7g.12xlarge","cache.m7g.16xlarge","cache.m7g.2xlarge","cache.m7g.4xlarge","cache.m7g.8xlarge","cache.m7g.large","cache.m7g.xlarge","cache.r4.16xlarge","cache.r4.2xlarge","cache.r4.4xlarge","cache.r4.8xlarge","cache.r4.large","cache.r4.xlarge","cache.r5.12xlarge","cache.r5.24xlarge","cache.r5.2xlarge","cache.r5.4xlarge","cache.r5.large","cache.r5.xlarge","cache.r6g.12xlarge","cache.r6g.16xlarge","cache.r6g.2xlarge","cache.r6g.4xlarge","cache.r6g.8xlarge","cache.r6g.large","cache.r6g.xlarge","cache.r7g.12xlarge","cache.r7g.16xlarge","cache.r7g.2xlarge","cache.r7g.4xlarge","cache.r7g.8xlarge","cache.r7g.large","cache.r7g.xlarge","cache.t2.medium","cache.t2.micro","cache.t2.small","cache.t3.medium","cache.t3.micro","cache.t3.small","cache.t4g.medium","cache.t4g.micro","cache.t4g.small"],"type":"string"},"logging":{"$ref":"#/definitions/RedisLogging","description":"#### Slow query logging. Sent to CloudWatch; view with `stacktape logs`."},"automatedBackupRetentionDays":{"description":"#### Days to keep automated daily backups. Set to 0 to disable.","default":0,"type":"number"},"port":{"description":"#### Port the cluster listens on.","default":6379,"type":"number"},"defaultUserPassword":{"description":"#### Cluster password. 16-128 chars, printable ASCII only. Cannot contain `/`, `\"`, or `@`.\n\n---\n\nAll traffic is encrypted in transit. Use `$Secret()` instead of hardcoding:\n```yaml\ndefaultUserPassword: $Secret('redis.password')\n```","type":"string"},"accessibility":{"$ref":"#/definitions/RedisAccessibility","description":"#### Network access control: `vpc` (default) or `scoping-workloads-in-vpc` (most restrictive)."},"engineVersion":{"description":"#### Redis engine version.","default":"6.2","enum":["6.0","6.2","7.0","7.1"],"type":"string"},"dev":{"$ref":"#/definitions/DevModeConfig","description":"#### Dev mode: runs locally in Docker by default. Set `remote: true` to use the deployed cluster."}},"additionalProperties":false,"required":["defaultUserPassword","instanceSize"]},"RedisLogging":{"type":"object","properties":{"disabled":{"description":"#### Disable slow query logging.","default":false,"type":"boolean"},"format":{"description":"#### Log format.","default":"json","enum":["json","text"],"type":"string"},"retentionDays":{"description":"#### How many days to keep logs.","default":90,"enum":[1,120,14,150,180,1827,3,30,365,3653,400,5,545,60,7,731,90],"type":"number"},"logForwarding":{"description":"#### Forward logs to an external service (Datadog, Highlight.io, or any HTTP endpoint).\n\n---\n\nUses Kinesis Data Firehose (~$0.03/GB). Failed deliveries go to a backup S3 bucket.","anyOf":[{"$ref":"#/definitions/HttpEndpointLogForwarding"},{"$ref":"#/definitions/HighlightLogForwarding"},{"$ref":"#/definitions/DatadogLogForwarding"}]}},"additionalProperties":false},"RedisAccessibility":{"type":"object","properties":{"accessibilityMode":{"description":"#### Who can connect to this cluster.\n\n---\n\n- **`vpc`** (default): Any resource in the same VPC (functions with `joinDefaultVpc: true`, containers, batch jobs).\n- **`scoping-workloads-in-vpc`**: Only resources that list this cluster in their `connectTo`.\n\nRedis clusters don't have public IPs — you can't connect from your local machine directly.\nUse a bastion host for local access.","default":"vpc","enum":["scoping-workloads-in-vpc","vpc"],"type":"string"}},"additionalProperties":false,"required":["accessibilityMode"]},"CustomResourceInstance":{"description":"#### An instance of a `custom-resource-definition`. Pass properties to the backing Lambda function.","type":"object","properties":{"type":{"type":"string","const":"custom-resource-instance"},"properties":{"$ref":"#/definitions/CustomResourceInstanceProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"CustomResourceInstanceProps":{"type":"object","properties":{"definitionName":{"description":"#### Name of the `custom-resource-definition` in your config that provides the backing Lambda.","type":"string"},"resourceProperties":{"description":"#### Key-value pairs passed to the Lambda function during create/update/delete events.","type":"object","additionalProperties":{}}},"additionalProperties":false,"required":["definitionName","resourceProperties"]},"CustomResourceDefinition":{"description":"#### Lambda-backed provisioning logic for resources not natively supported by Stacktape/CloudFormation.\n\n---\n\nYour Lambda function runs on stack create, update, and delete events to manage external resources\n(third-party APIs, SaaS services, custom infrastructure). Pair with `custom-resource-instance` to use.","type":"object","properties":{"type":{"type":"string","const":"custom-resource-definition"},"properties":{"$ref":"#/definitions/CustomResourceDefinitionProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"CustomResourceDefinitionProps":{"type":"object","properties":{"packaging":{"$ref":"#/definitions/LambdaPackaging","description":"#### How the Lambda function code is packaged and deployed."},"environment":{"description":"#### Environment variables injected into the Lambda function. Use `$ResourceParam()` for dynamic values.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"runtime":{"$ref":"#/definitions/LambdaRuntime","description":"#### Lambda runtime. Auto-detected from file extension if not specified."},"timeout":{"description":"#### Max execution time in seconds. Max: 900.","default":10,"type":"number"},"memory":{"description":"#### Memory in MB (128–10,240). CPU scales proportionally — 1,769 MB = 1 vCPU.","type":"number"},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false,"required":["packaging"]},"LambdaPackaging":{"anyOf":[{"$ref":"#/definitions/StpBuildpackLambdaPackaging"},{"$ref":"#/definitions/CustomArtifactLambdaPackaging"}]},"StpBuildpackLambdaPackaging":{"description":"#### A zero-config buildpack that packages your code for AWS Lambda.\n\n---\n\nThe `stacktape-lambda-buildpack` automatically bundles your code and dependencies into an optimized Lambda deployment package.\n\n**Supported languages:** JavaScript, TypeScript, Python, Java, Go, Ruby, PHP, and .NET.\n\nFor JS/TS, your code is bundled into a single file. Source maps are automatically generated.\nPackages are cached based on a checksum, so unchanged code is not re-packaged.","type":"object","properties":{"type":{"type":"string","const":"stacktape-lambda-buildpack"},"properties":{"$ref":"#/definitions/StpBuildpackLambdaPackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"StpBuildpackLambdaPackagingProps":{"type":"object","properties":{"handlerFunction":{"description":"#### The name of the handler function to be executed when the Lambda is invoked.","type":"string"},"entryfilePath":{"description":"#### Path to your app's entry point, relative to the Stacktape config file.\n\n---\n\nFor JS/TS: code is bundled into a single file. Dependencies with native binaries are installed separately.\nFor Python: use `module/file.py:app` format when using `runAppAs` (WSGI/ASGI).","type":"string"},"includeFiles":{"description":"#### A glob pattern of files to explicitly include in the deployment package.\n\n---\n\nThe path is relative to your Stacktape configuration file.","type":"array","items":{"type":"string"}},"excludeFiles":{"description":"#### A glob pattern of files to explicitly exclude from the deployment package.\n\n---","type":"array","items":{"type":"string"}},"excludeDependencies":{"description":"#### A list of dependencies to exclude from the deployment package.","type":"array","items":{"type":"string"}},"languageSpecificConfig":{"description":"#### Language-specific packaging configuration.","anyOf":[{"$ref":"#/definitions/EsLanguageSpecificConfig"},{"$ref":"#/definitions/PyLanguageSpecificConfig"},{"$ref":"#/definitions/JavaLanguageSpecificConfig"},{"$ref":"#/definitions/PhpLanguageSpecificConfig"},{"$ref":"#/definitions/DotnetLanguageSpecificConfig"},{"$ref":"#/definitions/GoLanguageSpecificConfig"},{"$ref":"#/definitions/RubyLanguageSpecificConfig"}]}},"additionalProperties":false,"required":["entryfilePath"]},"CustomArtifactLambdaPackaging":{"description":"#### Uses a pre-built artifact for Lambda deployment.\n\n---\n\nWith `custom-artifact`, you provide a path to your own pre-built deployment package.\nIf the specified path is a directory or an unzipped file, Stacktape will automatically zip it.\n\nThis is useful when you have custom build processes or need full control over the packaging.","type":"object","properties":{"type":{"type":"string","const":"custom-artifact"},"properties":{"$ref":"#/definitions/CustomArtifactLambdaPackagingProps"}},"additionalProperties":false,"required":["properties","type"]},"CustomArtifactLambdaPackagingProps":{"type":"object","properties":{"packagePath":{"description":"#### The path to a pre-built deployment package.\n\n---\n\nIf the path points to a directory or a non-zip file, Stacktape will automatically zip it for you.","type":"string"},"handler":{"description":"#### The handler function to be executed when the Lambda is invoked.\n\n---\n\nThe syntax is `{{filepath}}:{{functionName}}`.\n\nExample: `my-lambda/index.js:default`","type":"string"}},"additionalProperties":false,"required":["packagePath"]},"LambdaRuntime":{"enum":["dotnet6","dotnet7","dotnet8","java11","java17","java8","java8.al2","nodejs18.x","nodejs20.x","nodejs22.x","nodejs24.x","provided.al2","provided.al2023","python3.10","python3.11","python3.12","python3.13","python3.8","python3.9","ruby3.3"],"type":"string"},"UpstashRedis":{"description":"#### Serverless Redis by Upstash — pay-per-request with no idle costs.\n\n---\n\nPerfect for Lambda-based apps where a traditional Redis cluster would be wasteful.\nAccessible over HTTPS (REST API) or standard Redis protocol. Great for caching, sessions, rate limiting.","type":"object","properties":{"type":{"type":"string","const":"upstash-redis"},"properties":{"$ref":"#/definitions/UpstashRedisProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"UpstashRedisProps":{"type":"object","properties":{"enableEviction":{"description":"#### Auto-remove old keys when memory is full. Prioritizes keys with TTL set. Enable for cache use cases.\n\n---\n\nWithout eviction, writes fail once the memory limit is reached. Enable this for caching workloads.","default":false,"type":"boolean"}},"additionalProperties":false},"DeploymentScript":{"description":"#### Run a script during deploy or delete — database migrations, seed data, cleanup tasks.\n\n---\n\nExecutes as a Lambda function. Use `after:deploy` to run migrations after resources are ready,\nor `before:delete` for cleanup. Can also be triggered manually with `stacktape deployment-script:run`.","type":"object","properties":{"type":{"type":"string","const":"deployment-script"},"properties":{"$ref":"#/definitions/DeploymentScriptProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"DeploymentScriptProps":{"type":"object","properties":{"trigger":{"description":"#### When to run: `after:deploy` (fails → rollback) or `before:delete` (fails → deletion continues).","enum":["after:deploy","before:delete"],"type":"string"},"packaging":{"$ref":"#/definitions/LambdaPackaging","description":"#### How the script code is packaged. Use `stacktape-lambda-buildpack` for auto-bundling."},"runtime":{"$ref":"#/definitions/LambdaRuntime","description":"#### Lambda runtime. Auto-detected from file extension if not specified."},"environment":{"description":"#### Environment variables injected at runtime. Use `$ResourceParam()` or `$Secret()` for dynamic values.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"parameters":{"description":"#### Structured data passed to the handler function as the event payload. Not for secrets — use `environment`.","type":"object","additionalProperties":{}},"memory":{"description":"#### Memory in MB (128–10,240). CPU scales proportionally — 1,769 MB = 1 vCPU.","type":"number"},"timeout":{"description":"#### Max execution time in seconds. Max: 900 (15 minutes).","default":10,"type":"number"},"joinDefaultVpc":{"description":"#### Connect to VPC resources (databases, Redis). **Warning:** function loses direct internet access.","type":"boolean"},"storage":{"description":"#### Ephemeral `/tmp` storage in MB (512–10,240).","default":512,"type":"number"},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false,"required":["packaging","trigger"]},"AwsCdkConstruct":{"description":"#### Embed an AWS CDK construct directly in your Stacktape stack.\n\n---\n\nEscape hatch for resources not natively supported by Stacktape. Write a CDK construct class\nin TypeScript/JavaScript and Stacktape will synthesize and deploy it as part of your stack.","type":"object","properties":{"type":{"type":"string","const":"aws-cdk-construct"},"properties":{"$ref":"#/definitions/AwsCdkConstructProps"}},"additionalProperties":false,"required":["type"]},"AwsCdkConstructProps":{"type":"object","properties":{"entryfilePath":{"description":"#### Path to the file containing your CDK construct class.\n\n---\n\nSupports `.js` and `.ts` files. The file must export a class that extends `Construct` from `aws-cdk-lib`.","type":"string"},"exportName":{"description":"#### Name of the exported construct class from the entry file.\n\n---\n\nMust match the exact export name. Use this when the file has multiple exports or uses named exports.","default":"default","type":"string"},"constructProperties":{"description":"#### Custom props passed to the construct's constructor.\n\n---\n\nThis object is forwarded as the third argument (`props`) to your construct class. Use `$ResourceParam()` and `$Secret()`\ndirectives here to pass dynamic values from other resources in your stack."}},"additionalProperties":false,"required":["entryfilePath"]},"SqsQueue":{"description":"#### Message queue for decoupling services. Producers send messages, consumers process them at their own pace.\n\n---\n\nFully managed, serverless, pay-per-message. Use for background processing, task queues, or buffering between services.","type":"object","properties":{"type":{"type":"string","const":"sqs-queue"},"properties":{"$ref":"#/definitions/SqsQueueProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"SqsQueueProps":{"type":"object","properties":{"delayMessagesSecond":{"description":"#### Delay (in seconds) before new messages become visible to consumers. Range: 0–900.\n\n---\n\nUseful for introducing a buffer, e.g., waiting for related data to be available before processing.","default":0,"type":"number"},"maxMessageSizeBytes":{"description":"#### Maximum message size in bytes. Range: 1,024 (1 KB) to 262,144 (256 KB).\n\n---\n\nMessages larger than this limit are rejected. For payloads over 256 KB, store the data in S3 and send the reference.","default":262144,"type":"number"},"messageRetentionPeriodSeconds":{"description":"#### How long unprocessed messages stay in the queue before being deleted. Range: 60s to 1,209,600s (14 days).\n\n---\n\nDefault is 4 days (345,600s). Increase if consumers might fall behind or be temporarily offline.","default":345600,"type":"number"},"longPollingSeconds":{"description":"#### Seconds the queue waits for messages before returning an empty response. Range: 0–20.\n\n---\n\nSet to `1`–`20` to enable long polling, which reduces costs by making fewer API calls.\nWith short polling (`0`), the consumer gets an immediate (often empty) response and must poll again.\n\nRecommended: `20` for most workloads — it's the most cost-effective.","default":0,"type":"number"},"visibilityTimeoutSeconds":{"description":"#### How long (seconds) a message is hidden from other consumers after being received. Range: 0–43,200 (12 hours).\n\n---\n\nAfter a consumer picks up a message, it must delete it before this timeout expires — otherwise it becomes\nvisible again and can be processed by another consumer (duplicate processing).\n\nSet this higher than your expected processing time. If your tasks take 2 minutes, use at least 150 seconds.","default":30,"type":"number"},"fifoEnabled":{"description":"#### Creates a FIFO queue that guarantees message order and exactly-once delivery.\n\n---\n\nUse when processing order matters (e.g., financial transactions, sequential workflows).\nFIFO queues have lower throughput (~300 msg/s without batching, ~3,000 with) compared to standard queues.\n\nRequires either `contentBasedDeduplication: true` or a `MessageDeduplicationId` on each message.","default":false,"type":"boolean"},"fifoHighThroughput":{"description":"#### Enables high-throughput mode for FIFO queues (up to ~70,000 msg/s per queue).\n\n---\n\nMessages are partitioned by `MessageGroupId` — order is guaranteed within each group but not across groups.\nRequires `fifoEnabled: true`.","type":"boolean"},"contentBasedDeduplication":{"description":"#### Automatically deduplicates messages based on their content (SHA-256 hash of the body).\n\n---\n\nWithin the 5-minute deduplication window, identical messages are delivered only once.\nSaves you from having to generate a unique `MessageDeduplicationId` for each message.\nRequires `fifoEnabled: true`.","type":"boolean"},"redrivePolicy":{"$ref":"#/definitions/SqsQueueRedrivePolicy","description":"#### Moves messages that fail processing too many times to a dead-letter queue for inspection.\n\n---\n\nAfter `maxReceiveCount` failed attempts, the message is automatically moved to a separate queue\nso you can investigate and reprocess it. Prevents poison messages from blocking the queue."},"alarms":{"description":"#### Additional alarms associated with this resource.\n\n---\n\nThese alarms will be merged with any alarms configured globally in the [console](https://console.stacktape.com/alarms).","type":"array","items":{"$ref":"#/definitions/SqsQueueAlarm"}},"disabledGlobalAlarms":{"description":"#### Disables globally configured alarms for this resource.\n\n---\n\nProvide a list of alarm names as configured in the [console](https://console.stacktape.com/alarms).","type":"array","items":{"type":"string"}},"policyStatements":{"description":"#### Custom access-control statements added to the queue's resource policy.\n\n---\n\nThese are merged with policies Stacktape auto-generates. Use to grant cross-account access or allow\nspecific AWS services (e.g., SNS) to send messages to this queue.","type":"array","items":{"$ref":"#/definitions/SqsQueuePolicyStatement"}},"events":{"description":"#### A list of event sources that trigger message delivery to this queue.\n\n---\n\nCurrently supports EventBridge event bus integration for delivering events directly to the queue.","type":"array","items":{"$ref":"#/definitions/SqsQueueEventBusIntegration"}}},"additionalProperties":false},"SqsQueueRedrivePolicy":{"type":"object","properties":{"targetSqsQueueName":{"description":"#### Name of another `sqs-queue` in your config to use as the dead-letter queue.","type":"string"},"targetSqsQueueArn":{"description":"#### ARN of an external SQS queue to use as the dead-letter queue. Use when the DLQ is in another stack or account.","type":"string"},"maxReceiveCount":{"description":"#### How many times a message can be received (and fail) before being moved to the dead-letter queue.\n\n---\n\nA typical starting value is `3`–`5`. Set lower for fast-failing workloads, higher for retryable transient errors.","type":"number"}},"additionalProperties":false,"required":["maxReceiveCount"]},"SqsQueueAlarm":{"type":"object","properties":{"trigger":{"$ref":"#/definitions/SqsQueueAlarmTrigger"},"evaluation":{"$ref":"#/definitions/AlarmEvaluation","description":"#### How long and how often to evaluate the metric before triggering.\n\n---\n\nControls the evaluation window (period), how many periods to look at, and how many must breach\nthe threshold to fire the alarm. Useful for filtering out short spikes."},"notificationTargets":{"description":"#### Where to send notifications when the alarm fires — Slack, MS Teams, or email.","type":"array","items":{"$ref":"#/definitions/AlarmUserIntegration"}},"description":{"description":"#### Custom alarm description used in notification messages and the AWS console.","type":"string"}},"additionalProperties":false,"required":["trigger"]},"SqsQueueAlarmTrigger":{"anyOf":[{"$ref":"#/definitions/SqsQueueReceivedMessagesCountTrigger"},{"$ref":"#/definitions/SqsQueueNotEmptyTrigger"}]},"SqsQueueReceivedMessagesCountTrigger":{"type":"object","properties":{"type":{"type":"string","const":"sqs-queue-received-messages-count"},"properties":{"$ref":"#/definitions/SqsQueueReceivedMessagesCountTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"SqsQueueReceivedMessagesCountTriggerProps":{"type":"object","properties":{"thresholdCount":{"description":"#### Fires when received message count crosses this threshold.\n\n---\n\nDefault: fires if **average** messages received per period > `thresholdCount`.\nCustomize with `statistic` and `comparisonOperator`.","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"},"statistic":{"$ref":"#/definitions/StatisticFunction","description":"#### How to aggregate metric values within each period: `avg`, `sum`, `min`, `max`, `p90`, `p95`, `p99`.","default":"avg"}},"additionalProperties":false,"required":["thresholdCount"]},"SqsQueueNotEmptyTrigger":{"type":"object","properties":{"type":{"description":"#### Fires when the SQS queue has unprocessed messages.\n\n---\n\nThe queue is considered \"not empty\" if any of these are non-zero: visible messages,\nin-flight messages, messages received, or messages sent.","type":"string","const":"sqs-queue-not-empty"}},"additionalProperties":false,"required":["type"]},"SqsQueuePolicyStatement":{"type":"object","properties":{"Effect":{"description":"#### `Allow` or `Deny` access for the specified actions and principal.","type":"string"},"Action":{"description":"#### SQS actions to allow or deny. E.g., `[\"sqs:SendMessage\"]` or `[\"sqs:*\"]`.","type":"array","items":{"type":"string"}},"Condition":{"description":"#### Optional conditions for when this statement applies (e.g., restrict by source ARN or IP range)."},"Principal":{"description":"#### Who gets access: AWS account ID, IAM ARN, or `\"*\"` for everyone. E.g., `{ \"Service\": \"sns.amazonaws.com\" }`."}},"additionalProperties":false,"required":["Action","Effect","Principal"]},"SqsQueueEventBusIntegration":{"description":"#### Routes events from an EventBridge event bus to this queue when they match a specified pattern.","type":"object","properties":{"type":{"type":"string","const":"event-bus"},"properties":{"$ref":"#/definitions/SqsQueueEventBusIntegrationProps","description":"#### Properties of the integration"}},"additionalProperties":false,"required":["properties","type"]},"SqsQueueEventBusIntegrationProps":{"type":"object","properties":{"messageGroupId":{"description":"#### Message group ID for FIFO queues. Required when the target queue has `fifoEnabled: true`.\n\n---\n\nMessages in the same group are processed in strict order. Different groups can be processed in parallel.","type":"string"},"eventBusArn":{"description":"#### The ARN of an existing event bus.\n\n---\n\nUse this to subscribe to an event bus that is not managed by your stack.\nYou must specify only one of `eventBusArn`, `eventBusName`, or `useDefaultBus`.","type":"string"},"eventBusName":{"description":"#### The name of an event bus defined in your stack's resources.\n\n---\n\nYou must specify only one of `eventBusArn`, `eventBusName`, or `useDefaultBus`.","type":"string"},"useDefaultBus":{"description":"#### Uses the default AWS event bus.\n\n---\n\nYou must specify only one of `eventBusArn`, `eventBusName`, or `useDefaultBus`.","type":"boolean"},"eventPattern":{"$ref":"#/definitions/EventBusIntegrationPattern","description":"#### A pattern to filter events from the event bus.\n\n---\n\nOnly events that match this pattern will trigger the target.\nFor details on the syntax, see the [AWS EventBridge documentation on event patterns](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-event-patterns.html)."},"onDeliveryFailure":{"$ref":"#/definitions/EventBusOnDeliveryFailure","description":"#### A destination for events that fail to be delivered to the target.\n\n---\n\nIn rare cases, an event might fail to be delivered. This property specifies an SQS queue where failed events will be sent."},"input":{"description":"#### A fixed JSON object to be passed as the event payload.\n\n---\n\nIf you need to customize the payload based on the event, use `inputTransformer` instead.\nYou can only use one of `input`, `inputPath`, or `inputTransformer`.\n\nExample:\n\n```yaml\ninput:\n  source: 'my-custom-event'\n```"},"inputPath":{"description":"#### A JSONPath expression to extract a portion of the event to pass to the target.\n\n---\n\nThis is useful for forwarding only a specific part of the event payload.\nYou can only use one of `input`, `inputPath`, or `inputTransformer`.\n\nExample:\n\n```yaml\ninputPath: '$.detail'\n```","type":"string"},"inputTransformer":{"$ref":"#/definitions/EventInputTransformer","description":"#### Customizes the event payload sent to the target.\n\n---\n\nThis allows you to extract values from the original event and use them to construct a new payload.\nYou can only use one of `input`, `inputPath`, or `inputTransformer`.\n\nExample:\n\n```yaml\ninputTransformer:\n  inputPathsMap:\n    instanceId: '$.detail.instance-id'\n    instanceState: '$.detail.state'\n  inputTemplate:\n    message: 'Instance <instanceId> is now in state <instanceState>.'\n```"}},"additionalProperties":false,"required":["eventPattern"]},"SnsTopic":{"description":"#### Pub/sub messaging: publish once, deliver to many subscribers (Lambda, SQS, email, SMS, HTTP).\n\n---\n\nServerless, pay-per-message. Use when one event needs to trigger multiple actions — e.g., order placed\ntriggers email confirmation + inventory update + analytics. Subscribers are configured on the subscriber side.","type":"object","properties":{"type":{"type":"string","const":"sns-topic"},"properties":{"$ref":"#/definitions/SnsTopicProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"SnsTopicProps":{"type":"object","properties":{"smsDisplayName":{"description":"#### Sender name shown on SMS messages sent to subscribers (e.g., \"MyApp\"). Max 11 characters.","type":"string"},"fifoEnabled":{"description":"#### Guarantees message order and exactly-once delivery. Use for financial transactions, sequential workflows.\n\n---\n\nFIFO topics can only deliver to FIFO SQS queues (not email, SMS, or HTTP).\nRequires either `contentBasedDeduplication: true` or a unique `MessageDeduplicationId` per message.","default":false,"type":"boolean"},"contentBasedDeduplication":{"description":"#### Automatically deduplicates messages based on content (SHA-256 hash) within a 5-minute window.\n\n---\n\nSaves you from generating a unique deduplication ID for each message. Requires `fifoEnabled: true`.","default":false,"type":"boolean"}},"additionalProperties":false},"HostingBucket":{"description":"#### Host a static website (React, Vue, Astro, etc.) on S3 + CloudFront CDN.\n\n---\n\nCombines S3 storage with a global CDN for fast, cheap, and scalable static site hosting.\nIncludes build step, custom domains, caching presets, and environment injection.","type":"object","properties":{"type":{"type":"string","const":"hosting-bucket"},"properties":{"$ref":"#/definitions/HostingBucketProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"HostingBucketProps":{"type":"object","properties":{"uploadDirectoryPath":{"description":"#### Path to the build output directory (e.g., `dist`, `build`, `out`).\n\n---\n\nThis folder's contents are uploaded to the bucket on every deploy.","type":"string"},"build":{"$ref":"#/definitions/HostingBucketBuild","description":"#### Build command that produces the files to upload (e.g., `npm run build`).\n\n---\n\nRuns during the packaging phase, in parallel with other resources. Bundle size is shown in deploy logs."},"dev":{"$ref":"#/definitions/HostingBucketBuild","description":"#### Dev server command for local development (e.g., `npm run dev`, `vite`).\n\n---\n\nUsed by `stacktape dev`."},"excludeFilesPatterns":{"description":"#### Glob patterns for files to skip during upload (relative to `uploadDirectoryPath`).","type":"array","items":{"type":"string"}},"hostingContentType":{"$ref":"#/definitions/SupportedHeaderPreset","description":"#### Optimizes caching and routing for your type of frontend app.\n\n---\n\n- **`single-page-app`**: For React, Vue, Angular, or any SPA built with Vite/Webpack.\n  Enables client-side routing (e.g., `/about` serves `index.html`). HTML is never browser-cached;\n  hashed assets (`.js`, `.css`) are cached forever.\n\n- **`static-website`** (default): For multi-page static sites. All files are CDN-cached\n  but never browser-cached, so users always see the latest content after a deploy.\n\n- **`astro-static-website`** / **`sveltekit-static-website`** / **`nuxt-static-website`**:\n  Framework-specific presets that cache hashed build assets (`_astro/`, `_app/`, `_nuxt/`)\n  indefinitely while keeping HTML fresh.\n\n- **`gatsby-static-website`**: Gatsby-specific caching following their recommendations.\n\nYou can override any preset's behavior using `fileOptions`.","default":"static-website"},"customDomains":{"description":"#### Custom domains (e.g., `www.example.com`). Stacktape auto-creates DNS records and TLS certificates.\n\n---\n\nYour domain must be added as a Route53 hosted zone in your AWS account first.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"disableUrlNormalization":{"description":"#### Disable clean URL normalization (e.g., `/about` → `/about.html`).","default":false,"type":"boolean"},"edgeFunctions":{"$ref":"#/definitions/EdgeFunctionsConfig","description":"#### Run edge functions on CDN requests/responses (URL rewrites, auth, A/B testing).\n\n---\n\n- `onRequest`: Before cache lookup and before forwarding to the bucket.\n- `onResponse`: Before returning the response to the client."},"errorDocument":{"description":"#### Page to show for 404 errors (e.g., `/error.html`).","type":"string"},"indexDocument":{"description":"#### Page served for requests to `/`.","default":"/index.html","type":"string"},"injectEnvironment":{"description":"#### Inject deploy-time values into HTML files as `window.STP_INJECTED_ENV.VARIABLE_NAME`.\n\n---\n\nUseful for making API URLs, User Pool IDs, and other dynamic values\navailable to your frontend JavaScript without rebuilding.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"writeDotenvFilesTo":{"description":"#### Write deploy-time values to a `.env` file in the specified directory.\n\n---\n\nMerges with existing `.env` content if the file already exists.","type":"string"},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this site. Must have `scope: cdn`.","type":"string"},"fileOptions":{"description":"#### Set HTTP headers (e.g., `Cache-Control`) for files matching specific patterns.","type":"array","items":{"$ref":"#/definitions/DirectoryUploadFilter"}},"routeRewrites":{"description":"#### Route specific URL patterns to different origins (e.g., `/api/*` → a Lambda function).\n\n---\n\nEvaluated in order; first match wins. Unmatched requests go to the bucket.","type":"array","items":{"$ref":"#/definitions/CdnRouteRewrite"}}},"additionalProperties":false,"required":["uploadDirectoryPath"]},"HostingBucketBuild":{"type":"object","properties":{"command":{"description":"#### Command to run (e.g., `npm run build`, `vite build`, `npm run dev`).","type":"string"},"workingDirectory":{"description":"#### Working directory for the command (relative to project root).","default":".","type":"string"}},"additionalProperties":false,"required":["command"]},"WebAppFirewall":{"description":"#### Protects your APIs and websites from common attacks (SQL injection, XSS, bots, DDoS).\n\n---\n\nAttach to an HTTP API Gateway, Application Load Balancer, or CDN. Comes with AWS-managed rule sets\nby default. Costs ~$5/month base + $1/million requests inspected.","type":"object","properties":{"type":{"type":"string","const":"web-app-firewall"},"properties":{"$ref":"#/definitions/WebAppFirewallProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"WebAppFirewallProps":{"type":"object","properties":{"scope":{"description":"#### `cdn` for CloudFront-attached resources, `regional` for ALBs, User Pools, or direct API Gateways.","enum":["cdn","regional"],"type":"string"},"defaultAction":{"description":"#### What happens when no rule matches a request.\n\n---\n\n- **`Allow`** (recommended): Allow all traffic, block only what rules catch.\n- **`Block`**: Block all traffic, allow only what rules explicitly permit (returns 403).","default":"Allow","enum":["Allow","Block"],"type":"string"},"rules":{"description":"#### Firewall rules: managed rule groups (AWS presets), custom rule groups, or rate-based rules.\n\n---\n\nIf omitted, Stacktape uses `AWSManagedRulesCommonRuleSet` + `AWSManagedRulesKnownBadInputsRuleSet` by default.","type":"array","items":{"anyOf":[{"$ref":"#/definitions/ManagedRuleGroup"},{"$ref":"#/definitions/CustomRuleGroup"},{"$ref":"#/definitions/RateBasedStatement"}]}},"customResponseBodies":{"$ref":"#/definitions/CustomResponseBodies","description":"#### Custom response bodies for `Block` actions. Map of key → content type + body."},"captchaImmunityTime":{"description":"#### Seconds a solved CAPTCHA stays valid before requiring re-verification.","default":300,"type":"number"},"challengeImmunityTime":{"description":"#### Seconds a solved challenge stays valid before requiring re-verification.","default":300,"type":"number"},"tokenDomains":{"description":"#### Domains accepted in WAF tokens. Enables token sharing across multiple protected websites.","type":"array","items":{"type":"string"}},"disableMetrics":{"description":"#### Disable CloudWatch metrics for the firewall.","default":false,"type":"boolean"},"sampledRequestsEnabled":{"description":"#### Save samples of matched requests for inspection in the AWS WAF console.","default":false,"type":"boolean"}},"additionalProperties":false,"required":["scope"]},"ManagedRuleGroup":{"type":"object","properties":{"type":{"type":"string","const":"managed-rule-group"},"properties":{"$ref":"#/definitions/ManagedRuleGroupProps"}},"additionalProperties":false,"required":["properties","type"]},"ManagedRuleGroupProps":{"type":"object","properties":{"vendorName":{"description":"#### Vendor name (e.g., `AWS` for AWS-managed rules).","type":"string"},"excludedRules":{"description":"#### Rules within this group to skip (by rule name). Useful for disabling false positives.","type":"array","items":{"type":"string"}},"overrideAction":{"description":"#### `None` = apply normally, `Count` = log matches without blocking (dry-run mode).","enum":["Count","None"],"type":"string"},"priority":{"description":"#### Evaluation order. Lower = evaluated first. Must be unique across all rules.","type":"number"},"name":{"type":"string"},"disableMetrics":{"description":"#### Disable CloudWatch metrics for this rule.","default":false,"type":"boolean"},"sampledRequestsEnabled":{"description":"#### Save samples of requests matching this rule for inspection in the WAF console.","default":false,"type":"boolean"}},"additionalProperties":false,"required":["name","priority","vendorName"]},"CustomRuleGroup":{"type":"object","properties":{"type":{"type":"string","const":"custom-rule-group"},"properties":{"$ref":"#/definitions/CustomRuleGroupProps"}},"additionalProperties":false,"required":["properties","type"]},"CustomRuleGroupProps":{"type":"object","properties":{"arn":{"description":"#### ARN of the custom WAF rule group.","type":"string"},"overrideAction":{"description":"#### `None` = apply normally, `Count` = log matches without blocking (dry-run mode).","enum":["Count","None"],"type":"string"},"priority":{"description":"#### Evaluation order. Lower = evaluated first. Must be unique across all rules.","type":"number"},"name":{"type":"string"},"disableMetrics":{"description":"#### Disable CloudWatch metrics for this rule.","default":false,"type":"boolean"},"sampledRequestsEnabled":{"description":"#### Save samples of requests matching this rule for inspection in the WAF console.","default":false,"type":"boolean"}},"additionalProperties":false,"required":["arn","name","priority"]},"RateBasedStatement":{"type":"object","properties":{"type":{"type":"string","const":"rate-based-rule"},"properties":{"$ref":"#/definitions/RateBasedStatementProps"}},"additionalProperties":false,"required":["properties","type"]},"RateBasedStatementProps":{"type":"object","properties":{"limit":{"description":"#### Max requests per IP in a 5-minute window. Range: 100–20,000,000. Exceeding triggers the `action`.","type":"number"},"aggregateBasedOn":{"description":"#### `IP` = direct client IP, `FORWARDED_IP` = IP from a header (e.g., `X-Forwarded-For` behind a proxy).","enum":["FORWARDED_IP","IP"],"type":"string"},"forwardedIPConfig":{"$ref":"#/definitions/ForwardedIPConfig","description":"#### Header and fallback settings when using `FORWARDED_IP` aggregation."},"action":{"description":"#### What to do when the rate limit is exceeded.\n\n---\n\n- `Block`: Return 403 (most common for rate limiting).\n- `Count`: Log only, don't block (useful for testing thresholds).\n- `Captcha`/`Challenge`: Verify the client is human.","default":"Block","enum":["Allow","Block","Captcha","Challenge","Count"],"type":"string"},"priority":{"description":"#### Evaluation order. Lower = evaluated first. Must be unique across all rules.","type":"number"},"name":{"type":"string"},"disableMetrics":{"description":"#### Disable CloudWatch metrics for this rule.","default":false,"type":"boolean"},"sampledRequestsEnabled":{"description":"#### Save samples of requests matching this rule for inspection in the WAF console.","default":false,"type":"boolean"}},"additionalProperties":false,"required":["limit","name","priority"]},"ForwardedIPConfig":{"type":"object","properties":{"fallbackBehavior":{"description":"#### What to do when the header is missing. `MATCH` = apply rule action, `NO_MATCH` = skip.","enum":["MATCH","NO_MATCH"],"type":"string"},"headerName":{"description":"#### HTTP header containing the client IP (e.g., `X-Forwarded-For`).","type":"string"}},"additionalProperties":false,"required":["fallbackBehavior","headerName"]},"CustomResponseBodies":{"type":"object","additionalProperties":{"type":"object","properties":{"contentType":{"description":"#### MIME type: `application/json`, `text/plain`, or `text/html`.","type":"string"},"content":{"description":"#### Response body content.","type":"string"}},"additionalProperties":false,"required":["content","contentType"]}},"NextjsWeb":{"description":"#### Deploy a Next.js app with SSR on AWS Lambda, static assets on S3, and a CloudFront CDN.\n\n---\n\nHandles ISR (Incremental Static Regeneration), image optimization, and middleware out of the box.\nOptionally deploy to Lambda@Edge for lower latency or enable response streaming.","type":"object","properties":{"type":{"type":"string","const":"nextjs-web"},"properties":{"$ref":"#/definitions/NextjsWebProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"NextjsWebProps":{"type":"object","properties":{"appDirectory":{"description":"#### Directory containing your `next.config.js`. For monorepos, point to the Next.js workspace.","type":"string"},"serverLambda":{"$ref":"#/definitions/NextjsServerLambdaProperties","description":"#### Customize the SSR Lambda function (memory, timeout, VPC, logging)."},"warmServerInstances":{"description":"#### Number of Lambda instances to keep warm (pre-initialized) to reduce cold starts.\n\n---\n\nA separate \"warmer\" function periodically pings the SSR Lambda. Not available with `useEdgeLambda: true`.","default":0,"type":"number"},"useEdgeLambda":{"description":"#### Run SSR at CloudFront edge locations for lower latency worldwide.\n\n---\n\n**Trade-offs:** Slower deploys, no `warmServerInstances`, no response streaming.","default":false,"type":"boolean"},"buildCommand":{"description":"#### Override the default `next build` command.","type":"string"},"dev":{"description":"#### Dev server config for `stacktape dev`. Defaults to `next dev`.","type":"object","properties":{"command":{"description":"#### Dev server command (e.g., `npm run dev`).","default":"next dev","type":"string"}},"additionalProperties":false},"fileOptions":{"description":"#### Set custom headers (e.g., `Cache-Control`) for static files matching a pattern.","type":"array","items":{"$ref":"#/definitions/DirectoryUploadFilter"}},"environment":{"description":"#### Environment variables for the SSR function. Use `$ResourceParam()` or `$Secret()` for dynamic values.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"customDomains":{"description":"#### Attach custom domains with auto-managed DNS records and TLS certificates.\n\n---\n\n**Prerequisite:** A Route 53 hosted zone for your domain must exist in your AWS account.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this app. Firewall `scope` must be `cdn`.","type":"string"},"streamingEnabled":{"description":"#### Stream SSR responses for faster Time to First Byte and up to 20 MB response size (vs 6 MB default).\n\n---\n\nNot compatible with `useEdgeLambda: true`.","default":false,"type":"boolean"},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false,"required":["appDirectory"]},"NextjsServerLambdaProperties":{"type":"object","properties":{"memory":{"description":"#### Memory in MB (128–10,240). CPU scales proportionally — 1,769 MB = 1 vCPU.","default":1024,"type":"number"},"timeout":{"description":"#### Max execution time in seconds. Max: 30.","default":30,"type":"number"},"logging":{"$ref":"#/definitions/LambdaFunctionLogging","description":"#### Logging config. Logs are sent to CloudWatch. View with `stacktape logs` or in the AWS console."},"joinDefaultVpc":{"description":"#### Connect to VPC resources (databases, Redis). **Warning:** function loses direct internet access.\n\n---\n\nS3 and DynamoDB remain accessible via auto-created VPC endpoints.","type":"boolean"}},"additionalProperties":false},"LambdaFunctionLogging":{"type":"object","properties":{"disabled":{"description":"#### Disable CloudWatch logging entirely.","default":false,"type":"boolean"},"retentionDays":{"description":"#### How many days to keep logs. Longer retention = higher storage cost.","default":180,"enum":[1,120,14,150,180,1827,3,30,365,3653,400,5,545,60,7,731,90],"type":"number"},"logForwarding":{"description":"#### Forward logs to an external service (Datadog, Highlight.io, or any HTTP endpoint).\n\n---\n\nUses Kinesis Data Firehose (~$0.03/GB). Failed deliveries go to a backup S3 bucket.","anyOf":[{"$ref":"#/definitions/HttpEndpointLogForwarding"},{"$ref":"#/definitions/HighlightLogForwarding"},{"$ref":"#/definitions/DatadogLogForwarding"}]}},"additionalProperties":false},"OpenSearchDomain":{"description":"#### Managed search and analytics engine (OpenSearch/Elasticsearch compatible).\n\n---\n\nFull-text search, log analytics, and real-time dashboards. Use for search features in your app,\ncentralized logging, or time-series data analysis. Costs start at ~$50/month (single small node).","type":"object","properties":{"type":{"type":"string","const":"open-search-domain"},"properties":{"$ref":"#/definitions/OpenSearchDomainProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"OpenSearchDomainProps":{"type":"object","properties":{"version":{"description":"#### OpenSearch engine version. Pin this to avoid surprises when the default changes.","default":"'2.17'","enum":["1.0","1.1","1.2","1.3","2.11","2.13","2.15","2.17","2.3","2.5","2.7","2.9"],"type":"string"},"clusterConfig":{"$ref":"#/definitions/OpenSearchClusterConfig","description":"#### Instance types, counts, and cluster topology (data nodes, master nodes, warm storage).\n\n---\n\nDefaults to a single `m4.large.search` node if not specified."},"storage":{"$ref":"#/definitions/OpenSearchStorage","description":"#### EBS volume size, IOPS, and throughput per data node. Only for EBS-backed instance types.\n\n---\n\n`iops` and `throughput` settings only apply to GP3 volumes."},"userPool":{"description":"#### Name of a `user-pool` resource in your config. Enables login to OpenSearch Dashboards via Cognito.","type":"string"},"logging":{"$ref":"#/definitions/OpenSearchLogConfiguration","description":"#### Error logs, search slow logs, and indexing slow logs. Sent to CloudWatch automatically."},"accessibility":{"$ref":"#/definitions/OpenSearchAccessibility","description":"#### Network access mode: public internet (default), VPC-only, or VPC with security-group scoping.\n\n---\n\nEven in `internet` mode, access requires IAM credentials. VPC modes add network-level isolation.\n**Warning:** you cannot switch between `internet` and `vpc`/`scoping-workloads-in-vpc` after creation."}},"additionalProperties":false},"OpenSearchClusterConfig":{"type":"object","properties":{"instanceType":{"description":"#### Instance type for data nodes (e.g., `t3.medium.search`, `r6g.large.search`).\n\n---\n\nData nodes store data and handle queries. For production, pair with dedicated master nodes.","type":"string"},"instanceCount":{"description":"#### Number of data nodes. More nodes = more storage capacity and query throughput.","type":"number"},"dedicatedMasterType":{"description":"#### Instance type for dedicated master nodes (e.g., `m5.large.search`). Manages cluster state, not data.\n\n---\n\nRecommended for clusters with 3+ data nodes to prevent split-brain. Use an odd count (3, 5, or 7).","type":"string"},"dedicatedMasterCount":{"description":"#### Number of dedicated master nodes. Must be odd (3, 5, or 7) for quorum.","type":"number"},"warmType":{"description":"#### Instance type for warm (UltraWarm) nodes — cheaper storage for infrequently accessed data.\n\n---\n\nData on warm nodes is still searchable but with higher query latency. Great for retaining old logs\nor time-series data at lower cost.","type":"string"},"warmCount":{"description":"#### Number of warm (UltraWarm) nodes for lower-cost storage of older data.","type":"number"},"multiAzDisabled":{"description":"#### Disable Multi-AZ replication. Not recommended — reduces availability and data durability.\n\n---\n\nMulti-AZ is auto-enabled for clusters with 2+ nodes. It distributes nodes across availability zones\nso the cluster survives an AZ outage.","default":false,"type":"boolean"},"standbyEnabled":{"description":"#### Enable Multi-AZ with a standby AZ for highest availability (99.99% SLA).\n\n---\n\nDistributes nodes across 3 AZs with one as standby. The standby takes over instantly during failures\nwithout re-balancing. Requires: version 1.3+, 3 dedicated master + data nodes, GP3/SSD instances.","default":false,"type":"boolean"}},"additionalProperties":false,"required":["instanceCount","instanceType"]},"OpenSearchStorage":{"type":"object","properties":{"size":{"description":"#### EBS volume size per data node in GiB. Min/max depends on instance type (typically 10–16,384 GiB).","type":"number"},"iops":{"description":"#### Provisioned IOPS per data node. GP3 volumes only.","default":3000,"type":"number"},"throughput":{"description":"#### Provisioned throughput per data node in MiB/s. GP3 volumes only.","default":125,"type":"number"}},"additionalProperties":false,"required":["size"]},"OpenSearchLogConfiguration":{"type":"object","properties":{"errorLogs":{"$ref":"#/definitions/OpenSearchLogRetentionSettings","description":"#### Error logs — script compilation errors, invalid queries, indexing issues, snapshot failures."},"searchSlowLogs":{"$ref":"#/definitions/OpenSearchLogRetentionSettings","description":"#### Search slow logs — queries exceeding thresholds you configure in OpenSearch index settings."},"indexSlowLogs":{"$ref":"#/definitions/OpenSearchLogRetentionSettings","description":"#### Indexing slow logs — indexing operations exceeding thresholds you configure in OpenSearch index settings."}},"additionalProperties":false},"OpenSearchLogRetentionSettings":{"type":"object","properties":{"disabled":{"description":"#### Disable this log type.","default":false,"type":"boolean"},"retentionDays":{"description":"#### Days to keep logs in CloudWatch before automatic deletion.","default":14,"enum":[1,120,14,150,180,1827,3,30,365,3653,400,5,545,60,7,731,90],"type":"number"}},"additionalProperties":false},"OpenSearchAccessibility":{"type":"object","properties":{"accessibilityMode":{"description":"#### How the domain can be reached.\n\n---\n\n- **`internet`**: Accessible from anywhere (still requires IAM credentials).\n- **`vpc`**: Only accessible from resources inside your VPC (functions with `joinDefaultVpc: true`, containers, batch jobs).\n- **`scoping-workloads-in-vpc`**: Like `vpc`, but also requires security-group access via `connectTo`.\n\n**Cannot be changed after creation** — switching between internet and VPC modes requires a new domain.","default":"internet","enum":["internet","scoping-workloads-in-vpc","vpc"],"type":"string"}},"additionalProperties":false,"required":["accessibilityMode"]},"EfsFilesystem":{"description":"#### Shared file storage that multiple containers can read/write simultaneously.\n\n---\n\nPersistent, elastic (grows/shrinks automatically), and accessible from any container in your stack\nvia `volumeMounts`. Use for shared uploads, CMS media, ML model files, or anything that needs to\nsurvive container restarts. Pay only for storage used (~$0.30/GB/month for standard access).","type":"object","properties":{"type":{"type":"string","const":"efs-filesystem"},"properties":{"$ref":"#/definitions/EfsFilesystemProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"EfsFilesystemProps":{"type":"object","properties":{"backupEnabled":{"description":"#### Enable daily automatic backups with 35-day retention. Incremental (only changes are copied).","type":"boolean"},"throughputMode":{"description":"#### How throughput scales with your workload.\n\n---\n\n- **`elastic`** (recommended): Auto-scales throughput. Best for spiky workloads (web apps, CI/CD).\n- **`provisioned`**: Fixed throughput you set via `provisionedThroughputInMibps`. Best for steady high-throughput workloads.\n- **`bursting`**: Throughput scales with storage size (50 KiB/s per GiB). Can run out of burst credits.","default":"elastic","enum":["bursting","elastic","provisioned"],"type":"string"},"provisionedThroughputInMibps":{"description":"#### Guaranteed throughput in MiB/s. Required when `throughputMode` is `provisioned`.\n\n---\n\nE.g., `100` = 100 MiB/s. Additional fees apply based on the provisioned amount. Can be changed anytime.","type":"number"}},"additionalProperties":false},"KinesisStream":{"description":"#### Real-time data stream for ingesting high-volume events (logs, clickstreams, IoT, analytics).\n\n---\n\nContinuously captures data from many producers. Consumers (Lambda functions, etc.) process records in order.\nUse when you need real-time processing with sub-second latency, not just async messaging (use SQS for that).","type":"object","properties":{"type":{"type":"string","const":"kinesis-stream"},"properties":{"$ref":"#/definitions/KinesisStreamProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["type"]},"KinesisStreamProps":{"type":"object","properties":{"capacityMode":{"description":"#### How the stream scales.\n\n---\n\n- **`ON_DEMAND`**: Auto-scales, pay per GB. Recommended for most use cases.\n- **`PROVISIONED`**: You choose a fixed number of shards (1 MB/s write, 2 MB/s read each). More predictable costs.","default":"ON_DEMAND","enum":["ON_DEMAND","PROVISIONED"],"type":"string"},"shardCount":{"description":"#### Number of shards. Only used when `capacityMode` is `PROVISIONED`.\n\n---\n\nEach shard: 1 MB/s write (1,000 records/s), 2 MB/s read (shared across consumers).","default":1,"type":"number"},"retentionPeriodHours":{"description":"#### How long records stay in the stream (hours). Range: 24–8,760 (365 days). Beyond 24h costs extra.","default":24,"type":"number"},"encryption":{"$ref":"#/definitions/KinesisStreamEncryption","description":"#### Encrypt data at rest using a KMS key."},"enableEnhancedFanOut":{"description":"#### Give each consumer its own dedicated 2 MB/s read throughput (instead of sharing).\n\n---\n\nUse when you have multiple consumers reading from the same stream and need low latency.\nEnhanced fan-out consumers are auto-created when a Lambda uses `autoCreateConsumer: true`.","default":false,"type":"boolean"}},"additionalProperties":false},"KinesisStreamEncryption":{"type":"object","properties":{"enabled":{"description":"#### Enable server-side encryption.","default":false,"type":"boolean"},"kmsKeyArn":{"description":"#### ARN of your own KMS key. If omitted, uses the AWS-managed `alias/aws/kinesis` key (no extra cost).","type":"string"}},"additionalProperties":false,"required":["enabled"]},"LambdaFunction":{"description":"#### A serverless compute resource that runs your code in response to events.\n\n---\n\nLambda functions are short-lived, stateless, and scale automatically. You only pay for the compute time you consume.","type":"object","properties":{"type":{"type":"string","const":"function"},"properties":{"$ref":"#/definitions/LambdaFunctionProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"LambdaFunctionProps":{"type":"object","properties":{"packaging":{"$ref":"#/definitions/LambdaPackaging","description":"#### How your code is built and packaged for deployment.\n\n---\n\n- **`stacktape-lambda-buildpack`** (recommended): Point to your source file and Stacktape builds,\n  bundles, and uploads it automatically.\n- **`custom-artifact`**: Provide a pre-built zip file. Stacktape handles the upload."},"events":{"description":"#### What triggers this function: HTTP requests, file uploads, queues, schedules, etc.\n\n---\n\nStacktape auto-configures permissions for each trigger.\nThe event payload your function receives depends on the trigger type.","type":"array","items":{"anyOf":[{"$ref":"#/definitions/ApplicationLoadBalancerIntegration"},{"$ref":"#/definitions/KafkaTopicIntegration"},{"$ref":"#/definitions/SnsIntegration"},{"$ref":"#/definitions/SqsIntegration"},{"$ref":"#/definitions/KinesisIntegration"},{"$ref":"#/definitions/DynamoDbIntegration"},{"$ref":"#/definitions/S3Integration"},{"$ref":"#/definitions/ScheduleIntegration"},{"$ref":"#/definitions/AlarmIntegration"},{"$ref":"#/definitions/CloudwatchLogIntegration"},{"$ref":"#/definitions/HttpApiIntegration"},{"$ref":"#/definitions/EventBusIntegration"}]}},"environment":{"description":"#### Environment variables available to the function at runtime.\n\n---\n\nVariables from `connectTo` (e.g., `STP_MY_DATABASE_CONNECTION_STRING`) are added automatically.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"runtime":{"$ref":"#/definitions/LambdaRuntime","description":"#### The language runtime (e.g., `nodejs22.x`, `python3.13`).\n\n---\n\nAuto-detected from your source file extension when using `stacktape-lambda-buildpack`.\nOverride only if you need a specific version."},"architecture":{"description":"#### Processor architecture: `x86_64` (default) or `arm64` (Graviton, ~20% cheaper).\n\n---\n\n`arm64` is cheaper per GB-second and often faster. Works with most code out of the box.\nIf using `stacktape-lambda-buildpack`, Stacktape builds for the selected architecture automatically.\nWith `custom-artifact`, you must pre-compile for the target architecture.","default":"x86_64","enum":["arm64","x86_64"],"type":"string"},"memory":{"description":"#### Memory in MB (128 - 10,240). Also determines CPU power.\n\n---\n\nLambda scales CPU proportionally to memory: 1,769 MB = 1 vCPU, 3,538 MB = 2 vCPUs, etc.\nIf your function is slow, increasing memory gives it more CPU, which often makes it faster\nand cheaper overall (less execution time).","type":"number"},"timeout":{"description":"#### Max execution time in seconds. Function is killed if it exceeds this.\n\n---\n\nMaximum: 900 seconds (15 minutes). For longer tasks, use a `batch-job` or `worker-service`.","default":10,"type":"number"},"joinDefaultVpc":{"description":"#### Connects the function to your VPC so it can reach databases, Redis, and other VPC-only resources.\n\n---\n\n**You usually don't need to set this manually.** Stacktape will tell you if a resource in your `connectTo`\nrequires it (e.g., a database with `accessibilityMode: 'vpc'`, or any Redis cluster).\n\n**Tradeoff:** The function loses direct internet access. It can still reach S3 and DynamoDB\n(Stacktape auto-creates VPC endpoints), but calls to external APIs (Stripe, OpenAI, etc.) will fail.\nIf you need both VPC access and internet, use a `web-service` or `worker-service` instead.\n\nRequired when using `volumeMounts` (EFS).","default":false,"type":"boolean"},"tags":{"description":"#### Additional tags for this function (on top of stack-level tags). Max 50.","type":"array","items":{"$ref":"#/definitions/CloudformationTag"}},"destinations":{"$ref":"#/definitions/LambdaFunctionDestinations","description":"#### Route async invocation results to another service (SQS, SNS, EventBus, or another function).\n\n---\n\nUseful for building event-driven workflows: send successful results to one destination\nand failures to another for error handling."},"logging":{"$ref":"#/definitions/LambdaFunctionLogging","description":"#### Logging configuration (retention, forwarding).\n\n---\n\nLogs (`stdout`/`stderr`) are auto-sent to CloudWatch. View with `stacktape logs` or in the Stacktape Console."},"provisionedConcurrency":{"description":"#### Eliminates cold starts by keeping function instances warm and ready.\n\n---\n\nWhen a function hasn't been called recently, the first request can take 1-5+ seconds (\"cold start\").\nThis setting pre-warms the specified number of instances so they respond instantly.\n\n**When to use:** User-facing APIs, web/mobile backends, or any function where response time matters.\nSkip this for background jobs, cron tasks, or data pipelines.\n\n**Cost:** You pay for each provisioned instance even when idle. Also increases deploy time by ~2-5 minutes.","type":"number"},"reservedConcurrency":{"description":"#### Cap the maximum number of concurrent instances for this function.\n\n---\n\nReserves this many execution slots exclusively for this function — other functions can't use them,\nand this function can't scale beyond it. **No additional cost.**\n\nCommon uses:\n- Prevent overwhelming a database with too many connections\n- Guarantee capacity for critical functions\n- Throttle expensive downstream API calls","type":"number"},"layers":{"description":"#### Lambda Layer ARNs to attach (shared libraries, custom runtimes, etc.).\n\n---\n\nLayers are zip archives with additional code/data mounted into the function.\nProvide the layer ARN (e.g., from AWS console or another stack). Max 5 layers per function.","type":"array","items":{"type":"string"}},"deployment":{"$ref":"#/definitions/LambdaDeploymentConfig","description":"#### Gradual traffic shifting for safe deployments.\n\n---\n\nInstead of switching all traffic to the new version instantly, shift it gradually\n(canary or linear). If issues arise, traffic rolls back automatically."},"alarms":{"description":"#### Alarms for this function (merged with global alarms from the Stacktape Console).","type":"array","items":{"$ref":"#/definitions/LambdaAlarm"}},"disabledGlobalAlarms":{"description":"#### Global alarm names to exclude from this function.","type":"array","items":{"type":"string"}},"url":{"$ref":"#/definitions/LambdaUrlConfig","description":"#### Give this function its own HTTPS URL (no API Gateway needed).\n\n---\n\nSimpler and cheaper than an API Gateway for single-function endpoints.\nURL format: `https://{id}.lambda-url.{region}.on.aws`"},"cdn":{"$ref":"#/definitions/CdnConfiguration","description":"#### Put a CDN (CloudFront) in front of this function for caching and lower latency.\n\n---\n\nCaches responses at edge locations worldwide. Reduces function invocations and bandwidth costs."},"storage":{"description":"#### Size of the `/tmp` directory in MB (512 - 10,240). Ephemeral per invocation.\n\n---\n\nIncrease if your function downloads/processes large files temporarily.","default":512,"type":"number"},"volumeMounts":{"description":"#### Persistent EFS storage shared across invocations and functions.\n\n---\n\nUnlike `/tmp`, EFS data persists indefinitely and can be shared across multiple functions.\nRequires `joinDefaultVpc: true` (Stacktape will remind you if you forget).","type":"array","items":{"$ref":"#/definitions/LambdaEfsMount"}},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false,"required":["packaging"]},"KafkaTopicIntegration":{"description":"#### Triggers a function when new messages are available in a Kafka topic.","type":"object","properties":{"type":{"type":"string","const":"kafka-topic"},"properties":{"$ref":"#/definitions/KafkaTopicIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"KafkaTopicIntegrationProps":{"type":"object","properties":{"customKafkaConfiguration":{"$ref":"#/definitions/CustomKafkaEventSource","description":"#### The details of your Kafka cluster.\n\n---\n\nSpecifies the bootstrap servers and topic name."},"batchSize":{"description":"#### The maximum number of records to process in a single batch.\n\n---\n\nThe function will be invoked with up to this many records. Maximum is 10,000.","default":100,"type":"number"},"maxBatchWindowSeconds":{"description":"#### The maximum time (in seconds) to wait before invoking the function with a batch of records.\n\n---\n\nThe function will be triggered when either the `batchSize` is reached or this time window expires.\nMaximum is 300 seconds.","default":0.5,"type":"number"}},"additionalProperties":false},"CustomKafkaEventSource":{"type":"object","properties":{"bootstrapServers":{"description":"#### A list of `host:port` addresses for your Kafka brokers.","type":"array","items":{"type":"string"}},"topicName":{"description":"#### The name of the Kafka topic to consume messages from.","type":"string"},"authentication":{"description":"#### The authentication method for connecting to the Kafka cluster.\n\n---\n\n- `SASL`: Authenticate using a username and password (PLAIN or SCRAM).\n- `MTLS`: Authenticate using a client-side TLS certificate.","anyOf":[{"$ref":"#/definitions/KafkaSASLAuth"},{"$ref":"#/definitions/KafkaMTLSAuth"}]}},"additionalProperties":false,"required":["authentication","bootstrapServers","topicName"]},"KafkaSASLAuth":{"type":"object","properties":{"type":{"description":"#### The SASL authentication protocol.\n\n---\n\n- `BASIC_AUTH`: SASL/PLAIN\n- `SASL_SCRAM_256_AUTH`: SASL SCRAM-256\n- `SASL_SCRAM_512_AUTH`: SASL SCRAM-512","enum":["BASIC_AUTH","SASL_SCRAM_256_AUTH","SASL_SCRAM_512_AUTH"],"type":"string"},"properties":{"$ref":"#/definitions/KafkaSASLAuthProps","description":"#### Properties of authentication method"}},"additionalProperties":false,"required":["properties","type"]},"KafkaSASLAuthProps":{"type":"object","properties":{"authenticationSecretArn":{"description":"#### The ARN of a secret containing the Kafka credentials.\n\n---\n\nThe secret must be a JSON object with `username` and `password` keys.\nYou can create secrets using the `stacktape secret:create` command.","type":"string"}},"additionalProperties":false,"required":["authenticationSecretArn"]},"KafkaMTLSAuth":{"type":"object","properties":{"type":{"description":"#### The authentication protocol.\n\n---\n\n`MTLS`: Mutual TLS authentication.","type":"string","const":"MTLS"},"properties":{"$ref":"#/definitions/KafkaMTLSAuthProps","description":"#### Properties of authentication method"}},"additionalProperties":false,"required":["properties","type"]},"KafkaMTLSAuthProps":{"type":"object","properties":{"clientCertificate":{"description":"#### The ARN of a secret containing the client certificate.\n\n---\n\nThis secret should contain the certificate chain (X.509 PEM), private key (PKCS#8 PEM), and an optional private key password.\nYou can create secrets using the `stacktape secret:create` command.","type":"string"},"serverRootCaCertificate":{"description":"#### The ARN of a secret containing the server's root CA certificate.\n\n---\n\nYou can create secrets using the `stacktape secret:create` command.","type":"string"}},"additionalProperties":false,"required":["clientCertificate"]},"AlarmIntegration":{"type":"object","properties":{"type":{"type":"string","const":"cloudwatch-alarm"},"properties":{"$ref":"#/definitions/AlarmIntegrationProps"}},"additionalProperties":false,"required":["properties","type"]},"AlarmIntegrationProps":{"type":"object","properties":{"alarmName":{"description":"#### The name of the alarm (defined in the `alarms` section) that will trigger the function.","type":"string"}},"additionalProperties":false,"required":["alarmName"]},"LambdaFunctionDestinations":{"type":"object","properties":{"onSuccess":{"description":"#### ARN to receive the result when the function succeeds (SQS, SNS, EventBus, or Lambda ARN).","type":"string"},"onFailure":{"description":"#### ARN to receive error details when the function fails. Useful for dead-letter processing.","type":"string"}},"additionalProperties":false},"LambdaDeploymentConfig":{"type":"object","properties":{"strategy":{"description":"#### How traffic shifts from the old version to the new one.\n\n---\n\n- **Canary**: Send 10% of traffic first, then all traffic after a wait period.\n- **Linear**: Shift 10% of traffic at regular intervals.\n- **AllAtOnce**: Instant switch (no gradual rollout).","enum":["AllAtOnce","Canary10Percent10Minutes","Canary10Percent15Minutes","Canary10Percent30Minutes","Canary10Percent5Minutes","Linear10PercentEvery10Minutes","Linear10PercentEvery1Minute","Linear10PercentEvery2Minutes","Linear10PercentEvery3Minutes"],"type":"string"},"beforeAllowTrafficFunction":{"description":"#### Function to run before traffic shifting begins (e.g., smoke tests).\n\n---\n\nMust signal success/failure to CodeDeploy. If it fails, the deployment rolls back.","type":"string"},"afterTrafficShiftFunction":{"description":"#### Function to run after all traffic has shifted (e.g., post-deploy validation).\n\n---\n\nMust signal success/failure to CodeDeploy.","type":"string"}},"additionalProperties":false,"required":["strategy"]},"LambdaAlarm":{"type":"object","properties":{"trigger":{"$ref":"#/definitions/LambdaAlarmTrigger"},"evaluation":{"$ref":"#/definitions/AlarmEvaluation","description":"#### How long and how often to evaluate the metric before triggering.\n\n---\n\nControls the evaluation window (period), how many periods to look at, and how many must breach\nthe threshold to fire the alarm. Useful for filtering out short spikes."},"notificationTargets":{"description":"#### Where to send notifications when the alarm fires — Slack, MS Teams, or email.","type":"array","items":{"$ref":"#/definitions/AlarmUserIntegration"}},"description":{"description":"#### Custom alarm description used in notification messages and the AWS console.","type":"string"}},"additionalProperties":false,"required":["trigger"]},"LambdaAlarmTrigger":{"anyOf":[{"$ref":"#/definitions/LambdaErrorRateTrigger"},{"$ref":"#/definitions/LambdaDurationTrigger"}]},"LambdaErrorRateTrigger":{"type":"object","properties":{"type":{"type":"string","const":"lambda-error-rate"},"properties":{"$ref":"#/definitions/LambdaErrorRateTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"LambdaErrorRateTriggerProps":{"type":"object","properties":{"thresholdPercent":{"description":"#### Fires when the percentage of failed Lambda invocations exceeds this value.","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"}},"additionalProperties":false,"required":["thresholdPercent"]},"LambdaDurationTrigger":{"type":"object","properties":{"type":{"type":"string","const":"lambda-duration"},"properties":{"$ref":"#/definitions/LambdaDurationTriggerProps"}},"additionalProperties":false,"required":["properties","type"]},"LambdaDurationTriggerProps":{"type":"object","properties":{"thresholdMilliseconds":{"description":"#### Fires when Lambda execution time exceeds this value (ms).\n\n---\n\nDefault: fires if **average** duration > threshold. Customize with `statistic` and `comparisonOperator`.","type":"number"},"comparisonOperator":{"$ref":"#/definitions/ComparisonOperator","description":"#### How to compare the metric value against the threshold.","default":"GreaterThanThreshold"},"statistic":{"$ref":"#/definitions/StatisticFunction","description":"#### How to aggregate metric values within each period: `avg`, `sum`, `min`, `max`, `p90`, `p95`, `p99`.","default":"avg"}},"additionalProperties":false,"required":["thresholdMilliseconds"]},"LambdaUrlConfig":{"type":"object","properties":{"enabled":{"description":"#### Enable the function URL.","type":"boolean"},"cors":{"$ref":"#/definitions/LambdaUrlCorsConfig","description":"#### CORS settings for the function URL. Overrides any CORS headers from the function itself."},"authMode":{"description":"#### Who can call this URL.\n\n---\n\n- `NONE` — public, anyone can call it.\n- `AWS_IAM` — only authenticated AWS users/roles with invoke permission.","default":"NONE","enum":["AWS_IAM","NONE"],"type":"string"},"responseStreamEnabled":{"description":"#### Stream the response progressively instead of buffering the entire response.\n\n---\n\nImproves Time to First Byte and increases max response size from 6 MB to 20 MB.\nRequires using the AWS streaming handler pattern in your code.","type":"boolean"}},"additionalProperties":false,"required":["enabled"]},"LambdaUrlCorsConfig":{"type":"object","properties":{"enabled":{"description":"#### Enable CORS. When `true` with no other settings, uses permissive defaults (`*` for origins and methods).","type":"boolean"},"allowedOrigins":{"description":"#### Allowed origins (e.g., `https://example.com`). Use `*` for any origin.","default":["*"],"type":"array","items":{"type":"string"}},"allowedHeaders":{"description":"#### Allowed request headers (e.g., `Content-Type`, `Authorization`).","type":"array","items":{"type":"string"}},"allowedMethods":{"description":"#### Allowed HTTP methods (e.g., `GET`, `POST`).","type":"array","items":{"$ref":"#/definitions/HttpMethod"}},"allowCredentials":{"description":"#### Allow cookies and credentials in cross-origin requests.","type":"boolean"},"exposedResponseHeaders":{"description":"#### Response headers accessible to browser JavaScript.","type":"array","items":{"type":"string"}},"maxAge":{"description":"#### How long (seconds) browsers can cache preflight responses.","type":"number"}},"additionalProperties":false,"required":["enabled"]},"LambdaEfsMount":{"type":"object","properties":{"type":{"description":"#### The type of the volume mount.","type":"string","const":"efs"},"properties":{"$ref":"#/definitions/LambdaEfsMountProps","description":"#### Properties for the EFS volume mount."}},"additionalProperties":false,"required":["properties","type"]},"LambdaEfsMountProps":{"type":"object","properties":{"efsFilesystemName":{"description":"#### Name of the `efs-filesystem` resource defined in your config.","type":"string"},"rootDirectory":{"description":"#### Subdirectory within the EFS filesystem to mount. Omit for full access.","default":"/","type":"string"},"mountPath":{"description":"#### Path inside the function where the volume appears. Must start with `/mnt/` (e.g., `/mnt/data`).","type":"string"}},"additionalProperties":false,"required":["efsFilesystemName","mountPath"]},"EdgeLambdaFunction":{"description":"#### Lambda function that runs at CDN edge locations for request/response manipulation.\n\n---\n\nRuns on CloudFront events (viewer request, origin request, etc.) to modify headers, rewrite URLs,\nimplement A/B testing, or add auth checks at the edge. Referenced from CDN `edgeFunctions` config.","type":"object","properties":{"type":{"type":"string","const":"edge-lambda-function"},"properties":{"$ref":"#/definitions/EdgeLambdaFunctionProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"EdgeLambdaFunctionProps":{"type":"object","properties":{"packaging":{"$ref":"#/definitions/LambdaPackaging","description":"#### How the function code is packaged and deployed."},"runtime":{"description":"#### Lambda runtime. Auto-detected from file extension. Edge functions support Node.js and Python only.","enum":["nodejs18.x","nodejs20.x","nodejs22.x","nodejs24.x","python3.10","python3.11","python3.12","python3.13","python3.8","python3.9"],"type":"string"},"memory":{"description":"#### Memory in MB. Max depends on event type: viewer events = 128 MB, origin events = 10,240 MB.","default":128,"type":"number"},"timeout":{"description":"#### Max execution time in seconds. Viewer events: max 5s. Origin events: max 30s.","default":3,"type":"number"},"connectTo":{"description":"#### Grant access to other resources in your stack (IAM permissions only — no env vars or VPC access).\n\n---\n\nEdge Lambda functions **cannot** use environment variables or connect to VPC resources.\n`connectTo` only sets up IAM permissions (e.g., S3 bucket access, DynamoDB, SES).","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Custom IAM policy statements for fine-grained AWS permissions beyond what `connectTo` provides.","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}},"logging":{"$ref":"#/definitions/LambdaFunctionLogging","description":"#### Logging config. Logs are sent to CloudWatch **in the region where the function executed** (not your stack region)."}},"additionalProperties":false,"required":["packaging"]},"AstroWeb":{"description":"#### Deploy an Astro SSR app with Lambda for server rendering, S3 for static assets, and CloudFront CDN.\n\n---\n\nFor static-only Astro sites, use `hosting-bucket` with `hostingContentType: 'astro-static-website'` instead.","type":"object","properties":{"type":{"type":"string","const":"astro-web"},"properties":{"$ref":"#/definitions/AstroWebProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"AstroWebProps":{"type":"object","properties":{"appDirectory":{"description":"#### Directory containing your `astro.config.mjs`. For monorepos, point to the Astro workspace.","default":".","type":"string"},"buildCommand":{"description":"#### Override the default `astro build` command.","type":"string"},"environment":{"description":"#### Environment variables for the SSR function. Use `$ResourceParam()` or `$Secret()` for dynamic values.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"customDomains":{"description":"#### Attach custom domains with auto-managed DNS records and TLS certificates.\n\n---\n\n**Prerequisite:** A Route 53 hosted zone for your domain must exist in your AWS account.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"serverLambda":{"$ref":"#/definitions/AstroWebServerLambdaConfig","description":"#### Customize the SSR Lambda function (memory, timeout, VPC, logging)."},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this app. Firewall `scope` must be `cdn`.","type":"string"},"dev":{"$ref":"#/definitions/AstroWebDevConfig","description":"#### Dev server config for `stacktape dev`. Defaults to `astro dev`."},"fileOptions":{"description":"#### Set custom headers (e.g., `Cache-Control`) for static files matching a pattern.","type":"array","items":{"$ref":"#/definitions/DirectoryUploadFilter"}},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false},"AstroWebServerLambdaConfig":{"type":"object","properties":{"memory":{"description":"#### Memory in MB (128–10,240). CPU scales proportionally — 1,769 MB = 1 vCPU.","default":1024,"type":"number"},"timeout":{"description":"#### Max execution time in seconds. Max: 30.","default":30,"type":"number"},"joinDefaultVpc":{"description":"#### Connect to VPC resources (databases, Redis). **Warning:** function loses direct internet access.","type":"boolean"},"logging":{"$ref":"#/definitions/LambdaFunctionLogging","description":"#### Logging config. Logs are sent to CloudWatch. View with `stacktape logs` or in the AWS console."}},"additionalProperties":false},"AstroWebDevConfig":{"type":"object","properties":{"command":{"description":"#### Override the default `astro dev` command (e.g., `npm run dev`).","type":"string"},"workingDirectory":{"description":"#### Working directory for the dev command, relative to project root.","type":"string"}},"additionalProperties":false},"NuxtWeb":{"description":"#### Deploy a Nuxt SSR app with Lambda (Nitro aws-lambda preset), S3 for static assets, and CloudFront CDN.\n\n---\n\nFor static-only Nuxt sites, use `hosting-bucket` with `hostingContentType: 'nuxt-static-website'` instead.","type":"object","properties":{"type":{"type":"string","const":"nuxt-web"},"properties":{"$ref":"#/definitions/NuxtWebProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"NuxtWebProps":{"type":"object","properties":{"appDirectory":{"description":"#### Directory containing your `nuxt.config.ts`. For monorepos, point to the Nuxt workspace.","default":".","type":"string"},"buildCommand":{"description":"#### Override the default `nuxt build` command.","type":"string"},"environment":{"description":"#### Environment variables for the SSR function. Use `$ResourceParam()` or `$Secret()` for dynamic values.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"customDomains":{"description":"#### Attach custom domains with auto-managed DNS records and TLS certificates.\n\n---\n\n**Prerequisite:** A Route 53 hosted zone for your domain must exist in your AWS account.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"serverLambda":{"$ref":"#/definitions/SsrWebServerLambdaConfig","description":"#### Customize the SSR Lambda function (memory, timeout, VPC, logging)."},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this app. Firewall `scope` must be `cdn`.","type":"string"},"dev":{"$ref":"#/definitions/SsrWebDevConfig","description":"#### Dev server config for `stacktape dev`. Defaults to `nuxt dev`."},"fileOptions":{"description":"#### Set custom headers (e.g., `Cache-Control`) for static files matching a pattern.","type":"array","items":{"$ref":"#/definitions/DirectoryUploadFilter"}},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false},"SsrWebServerLambdaConfig":{"description":"Server Lambda configuration shared by all SSR web resources","type":"object","properties":{"memory":{"description":"#### Memory in MB (128–10,240). CPU scales proportionally — 1,769 MB = 1 vCPU.","default":1024,"type":"number"},"timeout":{"description":"#### Max execution time in seconds. Max: 30.","default":30,"type":"number"},"joinDefaultVpc":{"description":"#### Connect to VPC resources (databases, Redis). **Warning:** function loses direct internet access.","type":"boolean"},"logging":{"$ref":"#/definitions/LambdaFunctionLogging","description":"#### Logging config. Logs are sent to CloudWatch. View with `stacktape logs` or in the AWS console."}},"additionalProperties":false},"SsrWebDevConfig":{"description":"Dev server configuration shared by all SSR web resources","type":"object","properties":{"command":{"description":"#### Override the default dev server command (e.g., `npm run dev`).","type":"string"},"workingDirectory":{"description":"#### Working directory for the dev command, relative to project root.","type":"string"}},"additionalProperties":false},"SvelteKitWeb":{"description":"#### Deploy a SvelteKit SSR app with Lambda (AWS adapter), S3 for static assets, and CloudFront CDN.\n\n---\n\nFor static-only SvelteKit sites, use `hosting-bucket` with `hostingContentType: 'sveltekit-static-website'` instead.","type":"object","properties":{"type":{"type":"string","const":"sveltekit-web"},"properties":{"$ref":"#/definitions/SvelteKitWebProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"SvelteKitWebProps":{"type":"object","properties":{"appDirectory":{"description":"#### Directory containing your `svelte.config.js`. For monorepos, point to the SvelteKit workspace.","default":".","type":"string"},"buildCommand":{"description":"#### Override the default `vite build` command.","type":"string"},"environment":{"description":"#### Environment variables for the SSR function. Use `$ResourceParam()` or `$Secret()` for dynamic values.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"customDomains":{"description":"#### Attach custom domains with auto-managed DNS records and TLS certificates.\n\n---\n\n**Prerequisite:** A Route 53 hosted zone for your domain must exist in your AWS account.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"serverLambda":{"$ref":"#/definitions/SsrWebServerLambdaConfig","description":"#### Customize the SSR Lambda function (memory, timeout, VPC, logging)."},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this app. Firewall `scope` must be `cdn`.","type":"string"},"dev":{"$ref":"#/definitions/SsrWebDevConfig","description":"#### Dev server config for `stacktape dev`. Defaults to `vite dev`."},"fileOptions":{"description":"#### Set custom headers (e.g., `Cache-Control`) for static files matching a pattern.","type":"array","items":{"$ref":"#/definitions/DirectoryUploadFilter"}},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false},"SolidStartWeb":{"description":"#### Deploy a SolidStart SSR app with Lambda (AWS adapter), S3 for static assets, and CloudFront CDN.","type":"object","properties":{"type":{"type":"string","const":"solidstart-web"},"properties":{"$ref":"#/definitions/SolidStartWebProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"SolidStartWebProps":{"type":"object","properties":{"appDirectory":{"description":"#### Directory containing your `app.config.ts`. For monorepos, point to the SolidStart workspace.","default":".","type":"string"},"buildCommand":{"description":"#### Override the default `vinxi build` command.","type":"string"},"environment":{"description":"#### Environment variables for the SSR function. Use `$ResourceParam()` or `$Secret()` for dynamic values.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"customDomains":{"description":"#### Attach custom domains with auto-managed DNS records and TLS certificates.\n\n---\n\n**Prerequisite:** A Route 53 hosted zone for your domain must exist in your AWS account.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"serverLambda":{"$ref":"#/definitions/SsrWebServerLambdaConfig","description":"#### Customize the SSR Lambda function (memory, timeout, VPC, logging)."},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this app. Firewall `scope` must be `cdn`.","type":"string"},"dev":{"$ref":"#/definitions/SsrWebDevConfig","description":"#### Dev server config for `stacktape dev`. Defaults to `vinxi dev`."},"fileOptions":{"description":"#### Set custom headers (e.g., `Cache-Control`) for static files matching a pattern.","type":"array","items":{"$ref":"#/definitions/DirectoryUploadFilter"}},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false},"TanStackWeb":{"description":"#### Deploy a TanStack Start SSR app with Lambda (Nitro aws-lambda preset), S3 for static assets, and CloudFront CDN.","type":"object","properties":{"type":{"type":"string","const":"tanstack-web"},"properties":{"$ref":"#/definitions/TanStackWebProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"TanStackWebProps":{"type":"object","properties":{"appDirectory":{"description":"#### Directory containing your `app.config.ts`. For monorepos, point to the TanStack Start workspace.","default":".","type":"string"},"buildCommand":{"description":"#### Override the default `vinxi build` command.","type":"string"},"environment":{"description":"#### Environment variables for the SSR function. Use `$ResourceParam()` or `$Secret()` for dynamic values.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"customDomains":{"description":"#### Attach custom domains with auto-managed DNS records and TLS certificates.\n\n---\n\n**Prerequisite:** A Route 53 hosted zone for your domain must exist in your AWS account.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"serverLambda":{"$ref":"#/definitions/SsrWebServerLambdaConfig","description":"#### Customize the SSR Lambda function (memory, timeout, VPC, logging)."},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this app. Firewall `scope` must be `cdn`.","type":"string"},"dev":{"$ref":"#/definitions/SsrWebDevConfig","description":"#### Dev server config for `stacktape dev`. Defaults to `vinxi dev`."},"fileOptions":{"description":"#### Set custom headers (e.g., `Cache-Control`) for static files matching a pattern.","type":"array","items":{"$ref":"#/definitions/DirectoryUploadFilter"}},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false},"RemixWeb":{"description":"#### Deploy a Remix SSR app with Lambda for server rendering, S3 for static assets, and CloudFront CDN.","type":"object","properties":{"type":{"type":"string","const":"remix-web"},"properties":{"$ref":"#/definitions/RemixWebProps"},"overrides":{"description":"#### Escape hatch to modify the underlying CloudFormation resources Stacktape creates.\n\n---\n\nUse dot-notation paths to override specific properties on any child resource.\nFind resource logical IDs with `stacktape stack-info --detailed`.\n\n```yaml\noverrides:\n  MyDbInstance:\n    Properties.StorageEncrypted: true\n```","type":"object","additionalProperties":{"type":"object","additionalProperties":{}}}},"additionalProperties":false,"required":["properties","type"]},"RemixWebProps":{"type":"object","properties":{"appDirectory":{"description":"#### Directory containing your `vite.config.ts` (or `remix.config.js`). For monorepos, point to the Remix workspace.","default":".","type":"string"},"buildCommand":{"description":"#### Override the default `remix vite:build` command.","type":"string"},"environment":{"description":"#### Environment variables for the SSR function. Use `$ResourceParam()` or `$Secret()` for dynamic values.","type":"array","items":{"$ref":"#/definitions/EnvironmentVar"}},"customDomains":{"description":"#### Attach custom domains with auto-managed DNS records and TLS certificates.\n\n---\n\n**Prerequisite:** A Route 53 hosted zone for your domain must exist in your AWS account.","type":"array","items":{"$ref":"#/definitions/DomainConfiguration"}},"serverLambda":{"$ref":"#/definitions/SsrWebServerLambdaConfig","description":"#### Customize the SSR Lambda function (memory, timeout, VPC, logging)."},"useFirewall":{"description":"#### Name of a `web-app-firewall` resource to protect this app. Firewall `scope` must be `cdn`.","type":"string"},"dev":{"$ref":"#/definitions/SsrWebDevConfig","description":"#### Dev server config for `stacktape dev`. Defaults to `remix vite:dev`."},"fileOptions":{"description":"#### Set custom headers (e.g., `Cache-Control`) for static files matching a pattern.","type":"array","items":{"$ref":"#/definitions/DirectoryUploadFilter"}},"connectTo":{"description":"#### Give this resource access to other resources in your stack.\n\n---\n\nList the names of resources this workload needs to communicate with. Stacktape automatically:\n- **Grants IAM permissions** (e.g., S3 read/write, SQS send/receive)\n- **Opens network access** (security group rules for databases, Redis)\n- **Injects environment variables** with connection details: `STP_[RESOURCE_NAME]_[PARAM]`\n\nExample: `connectTo: [\"myDatabase\", \"myBucket\"]` gives this workload full access to both\nresources and injects `STP_MY_DATABASE_CONNECTION_STRING`, `STP_MY_BUCKET_NAME`, etc.\n\n---\n\n#### What each resource type provides:\n\n**`Bucket`** — read/write/delete objects → `NAME`, `ARN`\n\n**`DynamoDbTable`** — CRUD + scan/query → `NAME`, `ARN`, `STREAM_ARN`\n\n**`RelationalDatabase`** — network access + connection details → `CONNECTION_STRING`, `HOST`, `PORT`.\nAurora also gets `READER_CONNECTION_STRING`, `READER_HOST`.\n\n**`MongoDbAtlasCluster`** — temporary credential-less access → `CONNECTION_STRING`\n\n**`RedisCluster`** — network access → `HOST`, `READER_HOST`, `PORT`\n\n**`Function`** — invoke permission → `ARN`\n\n**`BatchJob`** — submit/list/terminate → `JOB_DEFINITION_ARN`, `STATE_MACHINE_ARN`\n\n**`EventBus`** — publish events → `ARN`\n\n**`UserAuthPool`** — full control → `ID`, `CLIENT_ID`, `ARN`\n\n**`SqsQueue`** — send/receive/delete → `ARN`, `NAME`, `URL`\n\n**`SnsTopic`** — publish/subscribe → `ARN`, `NAME`\n\n**`UpstashRedis`** → `HOST`, `PORT`, `PASSWORD`, `REST_TOKEN`, `REST_URL`, `REDIS_URL`\n\n**`PrivateService`** → `ADDRESS`\n\n**`aws:ses`** — full SES email sending permissions","type":"array","items":{"type":"string"}},"iamRoleStatements":{"description":"#### Raw IAM policy statements for permissions not covered by `connectTo`.\n\n---\n\nAdded as a separate policy alongside auto-generated permissions. Use this for\naccessing AWS services directly (e.g., Rekognition, Textract, Bedrock).","type":"array","items":{"$ref":"#/definitions/StpIamRoleStatement"}}},"additionalProperties":false},"default":{"type":"object","properties":{"Type":{"type":"string"},"DependsOn":{"anyOf":[{"type":"array","items":{"type":"string"}},{"$ref":"#/definitions/IntrinsicFunction"},{"type":"string"}]},"Properties":{"type":"object","additionalProperties":{}},"Metadata":{"type":"object","additionalProperties":{}},"CreationPolicy":{"$ref":"#/definitions/CreationPolicy"},"DeletionPolicy":{"$ref":"#/definitions/DeletionPolicy"},"UpdatePolicy":{"$ref":"#/definitions/UpdatePolicy"},"Condition":{"$ref":"#/definitions/Value<string>"}},"additionalProperties":false,"required":["Type"]},"IntrinsicFunction":{"type":"object","properties":{"name":{"type":"string"},"payload":{}},"additionalProperties":false,"required":["name","payload"]},"CreationPolicy":{"type":"object","properties":{"AutoScalingCreationPolicy":{"type":"object","properties":{"MinSuccessfulInstancesPercent":{"$ref":"#/definitions/Value<number>"}},"additionalProperties":false},"ResourceSignal":{"type":"object","properties":{"Count":{"$ref":"#/definitions/Value<number>"},"Timeout":{"$ref":"#/definitions/Value<string>"}},"additionalProperties":false}},"additionalProperties":false},"Value<number>":{"anyOf":[{"$ref":"#/definitions/IntrinsicFunction"},{"type":"number"}]},"Value<string>":{"anyOf":[{"$ref":"#/definitions/IntrinsicFunction"},{"type":"string"}]},"DeletionPolicy":{"enum":["Delete","Retain","Snapshot"],"type":"string"},"UpdatePolicy":{"type":"object","properties":{"AutoScalingReplacingUpdate":{"type":"object","properties":{"WillReplace":{"$ref":"#/definitions/Value<boolean>"}},"additionalProperties":false},"AutoScalingRollingUpdate":{"type":"object","properties":{"MaxBatchSize":{"$ref":"#/definitions/Value<number>"},"MinInstancesInService":{"$ref":"#/definitions/Value<number>"},"MinSuccessfulInstancesPercent":{"$ref":"#/definitions/Value<number>"},"PauseTime":{"$ref":"#/definitions/Value<string>"},"SuspendProcesses":{"$ref":"#/definitions/List<string>"},"WaitOnResourceSignals":{"$ref":"#/definitions/Value<boolean>"}},"additionalProperties":false},"AutoScalingScheduledAction":{"type":"object","properties":{"IgnoreUnmodifiedGroupSizeProperties":{"$ref":"#/definitions/Value<boolean>"}},"additionalProperties":false},"CodeDeployLambdaAliasUpdate":{"type":"object","properties":{"AfterAllowTrafficHook":{"$ref":"#/definitions/Value<string>"},"ApplicationName":{"$ref":"#/definitions/Value<string>"},"BeforeAllowTrafficHook":{"$ref":"#/definitions/Value<string>"},"DeploymentGroupName":{"$ref":"#/definitions/Value<string>"}},"additionalProperties":false,"required":["AfterAllowTrafficHook","ApplicationName","BeforeAllowTrafficHook","DeploymentGroupName"]}},"additionalProperties":false},"Value<boolean>":{"anyOf":[{"$ref":"#/definitions/IntrinsicFunction"},{"type":"boolean"}]},"List<string>":{"anyOf":[{"type":"array","items":{"type":"string"}},{"$ref":"#/definitions/IntrinsicFunction"}]}},"$schema":"http://json-schema.org/draft-07/schema#"}
