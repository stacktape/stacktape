---
title: 'Configuration'
order: 2
---

# Configuration

Stacktape configuration defines your infrastructure. You can use TypeScript (recommended), YAML, or JSON.

## TypeScript (Recommended)

```ts
// stacktape.ts
import { defineConfig, LambdaFunction, HttpApiGateway } from 'stacktape';

export default defineConfig(({ stage }) => {
  const api = new HttpApiGateway({ cors: { enabled: true } });

  const handler = new LambdaFunction({
    packaging: {
      type: 'stacktape-lambda-buildpack',
      properties: { entryfilePath: './src/handler.ts' }
    }
  });

  return { resources: { api, handler } };
});
```

**Benefits:** Type safety, autocomplete, conditional logic based on stage.

## YAML

```yaml
# stacktape.yml
resources:
  api:
    type: http-api-gateway
    properties:
      cors:
        enabled: true

  handler:
    type: function
    properties:
      packaging:
        type: stacktape-lambda-buildpack
        properties:
          entryfilePath: ./src/handler.ts
```

## Key Directives

Directives are special functions (prefixed with `$`) for dynamic values:

| Directive                             | Purpose                              | Example                        |
| ------------------------------------- | ------------------------------------ | ------------------------------ |
| `$Secret('name')`                     | Reference AWS Secrets Manager secret | `$Secret('db-password')`       |
| `$ResourceParam('resource', 'param')` | Get value from another resource      | `$ResourceParam('api', 'url')` |
| `$Stage()`                            | Current stage name                   | `$Stage()` → `production`      |
| `$Region()`                           | Current AWS region                   | `$Region()` → `us-east-1`      |

### Example: Using Secrets

```yaml
resources:
  database:
    type: relational-database
    properties:
      credentials:
        masterUserPassword: $Secret('db-password')
```

Create the secret first:

```bash
stacktape secret:create --region us-east-1
```

## Connecting Resources

The `connectTo` property automatically handles permissions, credentials, and networking:

```yaml
resources:
  database:
    type: relational-database
    properties:
      engine:
        type: postgres

  api:
    type: function
    properties:
      connectTo:
        - database # Gets DB credentials as env vars
```

Your function receives environment variables:

- `STP_DATABASE_CONNECTION_STRING`
- `STP_DATABASE_HOST`, `STP_DATABASE_PORT`, etc.

## Stages

Stages create isolated environments:

```bash
stacktape deploy --stage dev --region us-east-1      # Development
stacktape deploy --stage staging --region us-east-1  # Staging
stacktape deploy --stage prod --region us-east-1     # Production
```

Each stage has completely separate resources. Use stages in your config:

```ts
export default defineConfig(({ stage }) => ({
  resources: {
    database: new RelationalDatabase({
      primaryInstance: {
        instanceSize: stage === 'prod' ? 'db.t4g.medium' : 'db.t4g.micro'
      }
    })
  }
}));
```

## Learn More

- [TypeScript Configuration](/configuration/typescript-config) - Full TypeScript guide
- [YAML Configuration](/configuration/yaml-config) - Full YAML guide
- [Directives Reference](/configuration/directives) - All available directives
- [Connecting Resources](/configuration/connecting-resources) - Deep dive into connectTo
