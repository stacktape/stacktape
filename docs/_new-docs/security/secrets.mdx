---
title: 'Secrets'
order: 2
---

# Secrets

Secrets allow you to securely store and manage credentials, API keys, database passwords, and other sensitive information. Secrets are stored in your AWS account using [AWS Secrets Manager](https://aws.amazon.com/secrets-manager/).

## When to Use

**Use secrets for:**

- Database passwords
- API keys for third-party services
- OAuth client secrets
- Encryption keys
- Any sensitive configuration that shouldn't be in source control

**Don't use secrets for:**

- Non-sensitive configuration (use environment variables)
- Large files or binary data (use S3)
- Frequently changing values (secrets require redeployment)

## Managing Secrets

Secrets can be stored as simple strings (e.g., `mypassword`) or JSON objects (e.g., `{"username": "admin", "password": "secret"}`).

### Creating a Secret

```bash
stacktape secret:create --region eu-west-1
```

You'll be prompted for the secret name and value. If a secret with the same name exists, you'll be asked if you want to update it.

### Getting a Secret Value

```bash
stacktape secret:get --region eu-west-1
```

### Deleting a Secret

```bash
stacktape secret:delete --region eu-west-1
```

## Referencing Secrets

Use the `$Secret()` directive to inject secret values into your configuration:


```ts
import { defineConfig } from 'stacktape';

export default defineConfig({
  resources: {
    api: {
      type: 'function',
      properties: {
        packaging: {
          type: 'stacktape-lambda-buildpack',
          properties: {
            entryfilePath: 'src/handler.ts'
          }
        },
        environment: [
          {
            name: 'DATABASE_PASSWORD',
            value: '$Secret(\'my-db-password\')'
          },
          // For JSON secrets, access specific keys
          {
            name: 'API_KEY',
            value: '$Secret(\'my-api-credentials\', \'$.apiKey\')'
          }
        ]
      }
    }
  }
});
```


### JSON Path Syntax

For JSON secrets, use JSONPath to extract specific values:

```ts
// Secret value: {"username": "admin", "password": "secret123", "host": "db.example.com"}

'$Secret(\'db-credentials\', \'$.username\')'; // Returns: "admin"
'$Secret(\'db-credentials\', \'$.password\')'; // Returns: "secret123"
```

## Common Patterns

### Database Credentials


```ts
import { defineConfig } from 'stacktape';

export default defineConfig({
  resources: {
    database: {
      type: 'relational-database',
      properties: {
        engine: {
          type: 'postgres',
          properties: {
            version: '16.6'
          }
        },
        credentials: {
          masterUserPassword: '$Secret(\'db-master-password\')'
        }
      }
    },

    api: {
      type: 'function',
      properties: {
        packaging: {
          type: 'stacktape-lambda-buildpack',
          properties: {
            entryfilePath: 'src/handler.ts'
          }
        },
        environment: [
          {
            name: 'DB_PASSWORD',
            value: '$Secret(\'db-master-password\')'
          }
        ],
        connectTo: ['database']
      }
    }

}
});

```


### Third-Party API Keys


```ts
import { defineConfig } from 'stacktape';

export default defineConfig({
  resources: {
    paymentProcessor: {
      type: 'function',
      properties: {
        packaging: {
          type: 'stacktape-lambda-buildpack',
          properties: {
            entryfilePath: 'src/payments.ts'
          }
        },
        environment: [
          {
            name: 'STRIPE_SECRET_KEY',
            value: '$Secret(\'stripe-api-key\')'
          },
          {
            name: 'SENDGRID_API_KEY',
            value: '$Secret(\'sendgrid-api-key\')'
          }
        ]
      }
    }
  }
});
```



## Important Notes

<Warning>

If you update a secret, deployed stacks continue using the old value. You must **redeploy** to use the new value.

</Warning>

- Secret names can be up to 512 characters
- Secret values can be up to 65,536 bytes
- Secrets are region-specific - create them in the same region as your stack

## Pricing

- **$0.40** per secret per month
- **$0.05** per 10,000 API calls

For detailed pricing, see [AWS Secrets Manager Pricing](https://aws.amazon.com/secrets-manager/pricing/).
