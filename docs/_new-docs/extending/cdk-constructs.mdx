---
title: 'CDK Constructs'
order: 3
---

# CDK Constructs

AWS Cloud Development Kit (CDK) constructs are reusable cloud components that can be added to your Stacktape configuration. Constructs can represent a single AWS resource or a complex, multi-resource abstraction.

## When to Use

- Need a complex, reusable infrastructure component
- Want to use existing constructs from the [Construct Hub](https://constructs.dev/)
- Building custom infrastructure patterns to share across projects

## How It Works

1. Create a construct in TypeScript/JavaScript
2. Reference it in your Stacktape config
3. The construct's resources are deployed alongside your Stacktape resources

## Basic Example

### 1. Create the Construct

```ts
// constructs/monitoring.ts
import { Construct } from 'constructs';
import * as cloudwatch from 'aws-cdk-lib/aws-cloudwatch';
import * as sns from 'aws-cdk-lib/aws-sns';
import * as actions from 'aws-cdk-lib/aws-cloudwatch-actions';

export class MonitoringConstruct extends Construct {
  public readonly alertTopic: sns.Topic;

  constructor(scope: Construct, id: string, props: { email: string }) {
    super(scope, id);

    // Create SNS topic for alerts
    this.alertTopic = new sns.Topic(this, 'AlertTopic', {
      displayName: 'Application Alerts'
    });

    // Subscribe email
    new sns.Subscription(this, 'EmailSubscription', {
      topic: this.alertTopic,
      protocol: sns.SubscriptionProtocol.EMAIL,
      endpoint: props.email
    });

    // Create dashboard
    new cloudwatch.Dashboard(this, 'Dashboard', {
      dashboardName: 'app-dashboard'
    });
  }
}
```

### 2. Reference in Config


```ts
import { defineConfig } from 'stacktape';

export default defineConfig({
  resources: {
    api: {
      type: 'function',
      properties: {
        packaging: {
          type: 'stacktape-lambda-buildpack',
          properties: {
            entryfilePath: 'src/handler.ts'
          }
        }
      }
    }
  },

cdkConstructs: {
monitoring: {
constructPath: './constructs/monitoring.ts',
constructName: 'MonitoringConstruct',
properties: {
email: 'alerts@mycompany.com'
}
}
}
});

```


## CDK Construct Configuration

```ts
cdkConstructs: {
  constructName: {
    // Path to your construct file
    constructPath: './constructs/my-construct.ts',

    // Name of the exported construct class
    constructName: 'MyConstruct',

    // Props passed to the construct constructor
    properties: {
      // Any props your construct accepts
    }
  }
}
```

## Installing CDK Dependencies

Install the CDK libraries you need:

```bash
bun add aws-cdk-lib constructs
```

For specific service constructs:

```bash
bun add @aws-cdk/aws-lambda-nodejs @aws-cdk/aws-apigateway
```

## Using Third-Party Constructs

Constructs from the [Construct Hub](https://constructs.dev/) can be used directly:

```bash
bun add @aws-solutions-constructs/aws-lambda-dynamodb
```

```ts
// constructs/api-with-db.ts
import { Construct } from 'constructs';
import { LambdaToDynamoDB } from '@aws-solutions-constructs/aws-lambda-dynamodb';

export class ApiWithDatabase extends Construct {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    new LambdaToDynamoDB(this, 'LambdaDynamoDB', {
      lambdaFunctionProps: {
        runtime: lambda.Runtime.NODEJS_20_X,
        handler: 'index.handler',
        code: lambda.Code.fromAsset('lambda')
      }
    });
  }
}
```

## Accessing Construct Outputs

Export values from your construct to use in Stacktape resources:

### In the Construct

```ts
import { CfnOutput } from 'aws-cdk-lib';

export class MyConstruct extends Construct {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    const bucket = new s3.Bucket(this, 'Bucket');

    // Export values as CloudFormation outputs
    new CfnOutput(this, 'BucketName', {
      value: bucket.bucketName,
      exportName: 'MyBucketName'
    });

    new CfnOutput(this, 'BucketArn', {
      value: bucket.bucketArn,
      exportName: 'MyBucketArn'
    });
  }
}
```

### In Stacktape Config

```ts
{
  myFunction: {
    type: 'function',
    properties: {
      packaging: {
        type: 'stacktape-lambda-buildpack',
        properties: { entryfilePath: 'src/handler.ts' }
      },
      environment: [
        {
          name: 'BUCKET_NAME',
          value: '$CfImport(\'MyBucketName\')'
        }
      ]
    }
  }
}
```

## Common Construct Patterns

### VPC with Networking

```ts
import { Construct } from 'constructs';
import * as ec2 from 'aws-cdk-lib/aws-ec2';

export class NetworkingConstruct extends Construct {
  public readonly vpc: ec2.Vpc;

  constructor(scope: Construct, id: string) {
    super(scope, id);

    this.vpc = new ec2.Vpc(this, 'VPC', {
      maxAzs: 2,
      natGateways: 1,
      subnetConfiguration: [
        {
          name: 'Public',
          subnetType: ec2.SubnetType.PUBLIC,
          cidrMask: 24
        },
        {
          name: 'Private',
          subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS,
          cidrMask: 24
        }
      ]
    });
  }
}
```

### S3 with Lifecycle Rules

```ts
import { Construct } from 'constructs';
import * as s3 from 'aws-cdk-lib/aws-s3';
import { Duration } from 'aws-cdk-lib';

export class StorageConstruct extends Construct {
  constructor(scope: Construct, id: string, props: { bucketName: string }) {
    super(scope, id);

    new s3.Bucket(this, 'Bucket', {
      bucketName: props.bucketName,
      versioned: true,
      lifecycleRules: [
        {
          id: 'delete-old-versions',
          noncurrentVersionExpiration: Duration.days(30)
        },
        {
          id: 'transition-to-glacier',
          transitions: [
            {
              storageClass: s3.StorageClass.GLACIER,
              transitionAfter: Duration.days(90)
            }
          ]
        }
      ]
    });
  }
}
```

## Best Practices

1. **Keep constructs focused** - One construct = one purpose
2. **Use props for configuration** - Make constructs reusable
3. **Export useful values** - Use `CfnOutput` for values other resources need
4. **Version your constructs** - If sharing across projects, publish as npm packages
5. **Test constructs** - CDK has testing utilities for infrastructure tests

## Limitations

- Only TypeScript/JavaScript constructs supported
- Construct resources don't integrate with Stacktape's `connectTo`
- IAM permissions between Stacktape and CDK resources need manual setup
- Some CDK features (like context lookups) may not work

## Resources

- [AWS CDK Documentation](https://docs.aws.amazon.com/cdk/)
- [Construct Hub](https://constructs.dev/) - Find pre-built constructs
- [CDK Patterns](https://cdkpatterns.com/) - Common architecture patterns
